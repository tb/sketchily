svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}};svgedit.getReverseNS=function(){var a={};$.each(this.NS,function(J,p){a[p]=J.toLowerCase()});return a};(function(){var a=jQuery.fn.attr;jQuery.fn.attr=function(J,p){var c,f=this.length;if(!f)return a.apply(this,arguments);for(c=0;c<f;++c){var n=this[c];if(n.namespaceURI==="http://www.w3.org/2000/svg"){if(p!==undefined)n.setAttribute(J,p);else if($.isArray(J)){f=J.length;for(var i={};f--;){var m=J[f];if((c=n.getAttribute(m))||c==="0")c=isNaN(c)?c:c-0;i[m]=c}return i}if(typeof J==="object")for(i in J)n.setAttribute(i,J[i]);else{if((c=n.getAttribute(J))||c==="0")c=isNaN(c)?c:c-0;return c}}else return a.apply(this,
arguments)}return this}})();jQuery&&function(){var a=$(window),J=$(document);$.extend($.fn,{contextMenu:function(p,c){if(p.menu==undefined)return false;if(p.inSpeed==undefined)p.inSpeed=150;if(p.outSpeed==undefined)p.outSpeed=75;if(p.inSpeed==0)p.inSpeed=-1;if(p.outSpeed==0)p.outSpeed=-1;$(this).each(function(){var f=$(this),n=$(f).offset(),i=$("#"+p.menu);i.addClass("contextMenu");$(this).bind("mousedown",function(m){$(this).mouseup(function(k){var z=$(this);z.unbind("mouseup");if(m.button===2||p.allowLeft||m.ctrlKey&&svgedit.browser.isMac()){k.stopPropagation();
$(".contextMenu").hide();if(f.hasClass("disabled"))return false;var s=k.pageX,E=k.pageY;k=a.width()-i.width();var A=a.height()-i.height();if(s>k-15)s=k-15;if(E>A-30)E=A-30;J.unbind("click");i.css({top:E,left:s}).fadeIn(p.inSpeed);i.find("A").mouseover(function(){i.find("LI.hover").removeClass("hover");$(this).parent().addClass("hover")}).mouseout(function(){i.find("LI.hover").removeClass("hover")});J.keypress(function(h){switch(h.keyCode){case 38:if(i.find("LI.hover").length){i.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");
i.find("LI.hover").length||i.find("LI:last").addClass("hover")}else i.find("LI:last").addClass("hover");break;case 40:if(i.find("LI.hover").length==0)i.find("LI:first").addClass("hover");else{i.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");i.find("LI.hover").length||i.find("LI:first").addClass("hover")}break;case 13:i.find("LI.hover A").trigger("click");break;case 27:J.trigger("click")}});i.find("A").unbind("mouseup");i.find("LI:not(.disabled) A").mouseup(function(){J.unbind("click").unbind("keypress");
$(".contextMenu").hide();c&&c($(this).attr("href").substr(1),$(z),{x:s-n.left,y:E-n.top,docX:s,docY:E});return false});setTimeout(function(){J.click(function(){J.unbind("click").unbind("keypress");i.fadeOut(p.outSpeed);return false})},0)}})});if($.browser.mozilla)$("#"+p.menu).each(function(){$(this).css({MozUserSelect:"none"})});else $.browser.msie?$("#"+p.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return false})}):$("#"+p.menu).each(function(){$(this).bind("mousedown.disableTextSelect",
function(){return false})});$(f).add($("UL.contextMenu")).bind("contextmenu",function(){return false})});return $(this)},disableContextMenuItems:function(p){if(p==undefined){$(this).find("LI").addClass("disabled");return $(this)}$(this).each(function(){if(p!=undefined)for(var c=p.split(","),f=0;f<c.length;f++)$(this).find('A[href="'+c[f]+'"]').parent().addClass("disabled")});return $(this)},enableContextMenuItems:function(p){if(p==undefined){$(this).find("LI.disabled").removeClass("disabled");return $(this)}$(this).each(function(){if(p!=
undefined)for(var c=p.split(","),f=0;f<c.length;f++)$(this).find('A[href="'+c[f]+'"]').parent().removeClass("disabled")});return $(this)},disableContextMenu:function(){$(this).each(function(){$(this).addClass("disabled")});return $(this)},enableContextMenu:function(){$(this).each(function(){$(this).removeClass("disabled")});return $(this)},destroyContextMenu:function(){$(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")});return $(this)}})}(jQuery);(function(){if(!svgedit.browser)svgedit.browser={};var a=svgedit.NS,J=!!document.createElementNS&&!!document.createElementNS(a.SVG,"svg").createSVGRect;svgedit.browser.supportsSvg=function(){return J};if(svgedit.browser.supportsSvg()){var p=navigator.userAgent,c=document.createElementNS(a.SVG,"svg"),f=!!window.opera,n=p.indexOf("AppleWebKit")>=0,i=p.indexOf("Gecko/")>=0,m=p.indexOf("MSIE")>=0,k=p.indexOf("Chrome/")>=0,z=p.indexOf("Windows")>=0,s=p.indexOf("Macintosh")>=0,E="ontouchstart"in window,
A=!!c.querySelector,h=!!document.evaluate,u=function(){var ba=document.createElementNS(a.SVG,"path");ba.setAttribute("d","M0,0 10,10");var ia=ba.pathSegList;ba=ba.createSVGPathSegLinetoAbs(5,5);try{ia.replaceItem(ba,0);return true}catch(Pa){}return false}(),t=function(){var ba=document.createElementNS(a.SVG,"path");ba.setAttribute("d","M0,0 10,10");var ia=ba.pathSegList;ba=ba.createSVGPathSegLinetoAbs(5,5);try{ia.insertItemBefore(ba,0);return true}catch(Pa){}return false}(),v=function(){var ba=document.createElementNS(a.SVG,
"svg"),ia=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(ba);ia.setAttribute("x",5);ba.appendChild(ia);var Pa=document.createElementNS(a.SVG,"text");Pa.textContent="a";ia.appendChild(Pa);ia=Pa.getStartPositionOfChar(0).x;document.documentElement.removeChild(ba);return ia===0}(),r=function(){var ba=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(ba);var ia=document.createElementNS(a.SVG,"path");ia.setAttribute("d","M0,0 C0,0 10,10 10,0");ba.appendChild(ia);
ia=ia.getBBox();document.documentElement.removeChild(ba);return ia.height>4&&ia.height<5}(),O=function(){var ba=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(ba);var ia=document.createElementNS(a.SVG,"path");ia.setAttribute("d","M0,0 10,0");var Pa=document.createElementNS(a.SVG,"path");Pa.setAttribute("d","M5,0 15,0");var Ca=document.createElementNS(a.SVG,"g");Ca.appendChild(ia);Ca.appendChild(Pa);ba.appendChild(Ca);ia=Ca.getBBox();document.documentElement.removeChild(ba);
return ia.width==15}(),Z=function(){var ba=document.createElementNS(a.SVG,"rect");ba.setAttribute("x",0.1);(ba=ba.cloneNode(false).getAttribute("x").indexOf(",")==-1)||$.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\nPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.');return ba}(),ka=function(){var ba=document.createElementNS(a.SVG,"rect");ba.setAttribute("style","vector-effect:non-scaling-stroke");return ba.style.vectorEffect===
"non-scaling-stroke"}(),ea=function(){var ba=document.createElementNS(a.SVG,"rect").transform.baseVal,ia=c.createSVGTransform();ba.appendItem(ia);return ba.getItem(0)==ia}();svgedit.browser.isOpera=function(){return f};svgedit.browser.isWebkit=function(){return n};svgedit.browser.isGecko=function(){return i};svgedit.browser.isIE=function(){return m};svgedit.browser.isChrome=function(){return k};svgedit.browser.isWindows=function(){return z};svgedit.browser.isMac=function(){return s};svgedit.browser.isTouch=
function(){return E};svgedit.browser.supportsSelectors=function(){return A};svgedit.browser.supportsXpath=function(){return h};svgedit.browser.supportsPathReplaceItem=function(){return u};svgedit.browser.supportsPathInsertItemBefore=function(){return t};svgedit.browser.supportsPathBBox=function(){return r};svgedit.browser.supportsHVLineContainerBBox=function(){return O};svgedit.browser.supportsGoodTextCharPos=function(){return v};svgedit.browser.supportsEditableText=function(){return f};svgedit.browser.supportsGoodDecimals=
function(){return Z};svgedit.browser.supportsNonScalingStroke=function(){return ka};svgedit.browser.supportsNativeTransformLists=function(){return ea}}else window.location="browser-not-supported.html"})();(function(){if(!svgedit.transformlist)svgedit.transformlist={};var a=document.createElementNS(svgedit.NS.SVG,"svg"),J={};svgedit.transformlist.SVGTransformList=function(p){this._elem=p||null;this._xforms=[];this._update=function(){var c="";a.createSVGMatrix();var f;for(f=0;f<this.numberOfItems;++f){var n=this._list.getItem(f);c=c;n=n;var i=n.matrix,m="";switch(n.type){case 1:m="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+")";break;case 2:m="translate("+i.e+","+i.f+")";break;case 3:m=i.a==i.d?"scale("+
i.a+")":"scale("+i.a+","+i.d+")";break;case 4:var k=0;m=0;if(n.angle!=0){k=1-i.a;m=(k*i.f+i.b*i.e)/(k*k+i.b*i.b);k=(i.e-i.b*m)/k}m="rotate("+n.angle+" "+k+","+m+")"}c=c+(m+" ")}this._elem.setAttribute("transform",c)};this._list=this;this._init=function(){var c=this._elem.getAttribute("transform");if(c)for(var f=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,n=true;n;){n=c.match(f);c=c.replace(f,"");if(n&&n[1]){var i=n[1].split(/\s*\(/),m=i[0];i=i[1].match(/\s*(.*?)\s*\)/);i[1]=i[1].replace(/(\d)-/g,
"$1 -");var k=i[1].split(/[, ]+/),z="abcdef".split(""),s=a.createSVGMatrix();$.each(k,function(h,u){k[h]=parseFloat(u);if(m=="matrix")s[z[h]]=k[h]});i=a.createSVGTransform();var E="set"+m.charAt(0).toUpperCase()+m.slice(1),A=m=="matrix"?[s]:k;if(m=="scale"&&A.length==1)A.push(A[0]);else if(m=="translate"&&A.length==1)A.push(0);else m=="rotate"&&A.length==1&&A.push(0,0);i[E].apply(i,A);this._list.appendItem(i)}}};this._removeFromOtherLists=function(c){if(c){var f=false,n;for(n in J){var i=J[n],m,k;
m=0;for(k=i._xforms.length;m<k;++m)if(i._xforms[m]==c){f=true;i.removeItem(m);break}if(f)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(c){this.numberOfItems=1;this._removeFromOtherLists(c);this._xforms=[c]};this.getItem=function(c){if(c<this.numberOfItems&&c>=0)return this._xforms[c];throw{code:1};};this.insertItemBefore=function(c,f){var n=null;if(f>=0)if(f<this.numberOfItems){this._removeFromOtherLists(c);n=Array(this.numberOfItems+
1);var i;for(i=0;i<f;++i)n[i]=this._xforms[i];n[i]=c;var m;for(m=i+1;i<this.numberOfItems;++m,++i)n[m]=this._xforms[i];this.numberOfItems++;this._xforms=n;n=c;this._list._update()}else n=this._list.appendItem(c);return n};this.replaceItem=function(c,f){var n=null;if(f<this.numberOfItems&&f>=0){this._removeFromOtherLists(c);n=this._xforms[f]=c;this._list._update()}return n};this.removeItem=function(c){if(c<this.numberOfItems&&c>=0){var f=this._xforms[c],n=Array(this.numberOfItems-1),i;for(i=0;i<c;++i)n[i]=
this._xforms[i];for(c=i;c<this.numberOfItems-1;++c,++i)n[c]=this._xforms[i+1];this.numberOfItems--;this._xforms=n;this._list._update();return f}throw{code:1};};this.appendItem=function(c){this._removeFromOtherLists(c);this._xforms.push(c);this.numberOfItems++;this._list._update();return c}};svgedit.transformlist.resetListMap=function(){J={}};svgedit.transformlist.removeElementFromListMap=function(p){p.id&&J[p.id]&&delete J[p.id]};svgedit.transformlist.getTransformList=function(p){if(!svgedit.browser.supportsNativeTransformLists()){var c=
p.id||"temp",f=J[c];if(!f||c==="temp"){J[c]=new svgedit.transformlist.SVGTransformList(p);J[c]._init();f=J[c]}return f}if(p.transform)return p.transform.baseVal;if(p.gradientTransform)return p.gradientTransform.baseVal;if(p.patternTransform)return p.patternTransform.baseVal;return null}})();(function(){if(!svgedit.math)svgedit.math={};var a=document.createElementNS(svgedit.NS.SVG,"svg");svgedit.math.transformPoint=function(J,p,c){return{x:c.a*J+c.c*p+c.e,y:c.b*J+c.d*p+c.f}};svgedit.math.isIdentity=function(J){return J.a===1&&J.b===0&&J.c===0&&J.d===1&&J.e===0&&J.f===0};svgedit.math.matrixMultiply=function(){for(var J=arguments,p=J.length,c=J[p-1];p-- >1;)c=J[p-1].multiply(c);if(Math.abs(c.a)<1.0E-14)c.a=0;if(Math.abs(c.b)<1.0E-14)c.b=0;if(Math.abs(c.c)<1.0E-14)c.c=0;if(Math.abs(c.d)<
1.0E-14)c.d=0;if(Math.abs(c.e)<1.0E-14)c.e=0;if(Math.abs(c.f)<1.0E-14)c.f=0;return c};svgedit.math.hasMatrixTransform=function(J){if(!J)return false;for(var p=J.numberOfItems;p--;){var c=J.getItem(p);if(c.type==1&&!svgedit.math.isIdentity(c.matrix))return true}return false};svgedit.math.transformBox=function(J,p,c,f,n){var i=svgedit.math.transformPoint,m=i(J,p,n),k=i(J+c,p,n),z=i(J,p+f,n);J=i(J+c,p+f,n);p=Math.min(m.x,k.x,z.x,J.x);c=Math.min(m.y,k.y,z.y,J.y);return{tl:m,tr:k,bl:z,br:J,aabox:{x:p,
y:c,width:Math.max(m.x,k.x,z.x,J.x)-p,height:Math.max(m.y,k.y,z.y,J.y)-c}}};svgedit.math.transformListToTransform=function(J,p,c){if(J==null)return a.createSVGTransformFromMatrix(a.createSVGMatrix());p=p||0;c=c||J.numberOfItems-1;p=parseInt(p,10);c=parseInt(c,10);if(p>c){var f=c;c=p;p=f}f=a.createSVGMatrix();for(p=p;p<=c;++p){var n=p>=0&&p<J.numberOfItems?J.getItem(p).matrix:a.createSVGMatrix();f=svgedit.math.matrixMultiply(f,n)}return a.createSVGTransformFromMatrix(f)};svgedit.math.getMatrix=function(J){J=
svgedit.transformlist.getTransformList(J);return svgedit.math.transformListToTransform(J).matrix};svgedit.math.snapToAngle=function(J,p,c,f){var n=Math.PI/4;c=c-J;var i=f-p;f=Math.sqrt(c*c+i*i);n=Math.round(Math.atan2(i,c)/n)*n;return{x:J+f*Math.cos(n),y:p+f*Math.sin(n),a:n}};svgedit.math.rectsIntersect=function(J,p){return p.x<J.x+J.width&&p.x+p.width>J.x&&p.y<J.y+J.height&&p.y+p.height>J.y}})();(function(){if(!svgedit.units)svgedit.units={};var a=svgedit.NS,J=["x","x1","cx","rx","width"],p=["y","y1","cy","ry","height"],c=["r","radius"].concat(J,p),f,n={};svgedit.units.init=function(m){f=m;m=document.createElementNS(a.SVG,"svg");document.body.appendChild(m);var k=document.createElementNS(a.SVG,"rect");k.setAttribute("width","1em");k.setAttribute("height","1ex");k.setAttribute("x","1in");m.appendChild(k);k=k.getBBox();document.body.removeChild(m);m=k.x;n={em:k.width,ex:k.height,"in":m,cm:m/
2.54,mm:m/25.4,pt:m/72,pc:m/6,px:1,"%":0}};svgedit.units.getTypeMap=function(){return n};svgedit.units.shortFloat=function(m){var k=f.getRoundDigits();if(!isNaN(m))return+(+m).toFixed(k);if($.isArray(m))return svgedit.units.shortFloat(m[0])+","+svgedit.units.shortFloat(m[1]);return parseFloat(m).toFixed(k)-0};svgedit.units.convertUnit=function(m,k){k=k||f.getBaseUnit();return svgedit.units.shortFloat(m/n[k])};svgedit.units.setUnitAttr=function(m,k,z){m.setAttribute(k,z)};var i={line:["x1","x2","y1",
"y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(m){var k=m.tagName,z=f.getBaseUnit();if(k=i[k]){var s=k.length,E;for(E=0;E<s;E++){var A=k[E],h=m.getAttribute(A);if(h)isNaN(h)||m.setAttribute(A,h/n[z]+z)}}};svgedit.units.convertToNum=function(m,k){if(!isNaN(k))return k-0;var z;if(k.substr(-1)==="%"){z=
k.substr(0,k.length-1)/100;var s=f.getWidth(),E=f.getHeight();if(J.indexOf(m)>=0)return z*s;if(p.indexOf(m)>=0)return z*E;return z*Math.sqrt(s*s+E*E)/Math.sqrt(2)}s=k.substr(-2);z=k.substr(0,k.length-2);return z*n[s]};svgedit.units.isValidUnit=function(m,k,z){var s=false;if(c.indexOf(m)>=0)if(isNaN(k)){k=k.toLowerCase();$.each(n,function(h){if(!s)if(RegExp("^-?[\\d\\.]+"+h+"$").test(k))s=true})}else s=true;else if(m=="id"){m=false;try{var E=f.getElement(k);m=E==null||E===z}catch(A){}return m}return s=
true}})();(function(a){function J(k){if(svgedit.browser.supportsHVLineContainerBBox())try{return k.getBBox()}catch(z){}var s=$.data(k,"ref"),E=null,A;if(s){A=$(s).children().clone().attr("visibility","hidden");$(m).append(A);E=A.filter("line, path")}else E=$(k).find("line, path");var h=false;if(E.length){E.each(function(){var u=this.getBBox();if(!u.width||!u.height)h=true});if(h){k=s?A:$(k).children();k=getStrokedBBox(k)}else k=k.getBBox()}else k=k.getBBox();s&&A.remove();return k}if(!svgedit.utilities)svgedit.utilities=
{};var p=svgedit.NS,c="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),f=null,n=null,i=null,m=null;svgedit.utilities.init=function(k){f=k;n=k.getDOMDocument();i=k.getDOMContainer();m=k.getSVGRoot()};svgedit.utilities.toXml=function(k){return k.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#x27;")};svgedit.utilities.fromXml=function(k){return $("<p/>").html(k).text()};svgedit.utilities.encode64=
function(k){k=svgedit.utilities.encodeUTF8(k);if(window.btoa)return window.btoa(k);var z=[];z.length=Math.floor((k.length+2)/3)*4;var s,E,A,h,u,t,v=0,r=0;do{s=k.charCodeAt(v++);E=k.charCodeAt(v++);A=k.charCodeAt(v++);h=s>>2;s=(s&3)<<4|E>>4;u=(E&15)<<2|A>>6;t=A&63;if(isNaN(E))u=t=64;else if(isNaN(A))t=64;z[r++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);z[r++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(s);z[r++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(u);
z[r++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t)}while(v<k.length);return z.join("")};svgedit.utilities.decode64=function(k){if(window.atob)return window.atob(k);var z="",s,E,A="",h,u="",t=0;k=k.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(k.charAt(t++));E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(k.charAt(t++));h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(k.charAt(t++));
u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(k.charAt(t++));s=s<<2|E>>4;E=(E&15)<<4|h>>2;A=(h&3)<<6|u;z+=String.fromCharCode(s);if(h!=64)z+=String.fromCharCode(E);if(u!=64)z+=String.fromCharCode(A)}while(t<k.length);return unescape(z)};svgedit.utilities.encodeUTF8=function(k){if(k===null||k===a)return"";k=String(k);var z="",s,E,A=0;s=E=0;A=k.length;var h;for(h=0;h<A;h++){var u=k.charCodeAt(h),t=null;if(u<128)E++;else if(u>127&&u<2048)t=String.fromCharCode(u>>6|192,
u&63|128);else if((u&63488)!=55296)t=String.fromCharCode(u>>12|224,u>>6&63|128,u&63|128);else{if((u&64512)!=55296)throw new RangeError("Unmatched trail surrogate at "+h);t=k.charCodeAt(++h);if((t&64512)!=56320)throw new RangeError("Unmatched lead surrogate at "+(h-1));u=((u&1023)<<10)+(t&1023)+65536;t=String.fromCharCode(u>>18|240,u>>12&63|128,u>>6&63|128,u&63|128)}if(t!==null){if(E>s)z+=k.slice(s,E);z+=t;s=E=h+1}}if(E>s)z+=k.slice(s,A);return z};svgedit.utilities.convertToXMLReferences=function(k){var z,
s="";for(z=0;z<k.length;z++){var E=k.charCodeAt(z);if(E<128)s+=k[z];else if(E>127)s+="&#"+E+";"}return s};svgedit.utilities.text2xml=function(k){if(k.indexOf("<svg:svg")>=0)k=k.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns");var z,s;try{s=window.DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM");s.async=false}catch(E){throw Error("XML Parser could not be instantiated");}try{z=s.loadXML?s.loadXML(k)?s:false:s.parseFromString(k,"text/xml")}catch(A){throw Error("Error parsing XML string");
}return z};svgedit.utilities.bboxToObj=function(k){return{x:k.x,y:k.y,width:k.width,height:k.height}};svgedit.utilities.walkTree=function(k,z){if(k&&k.nodeType==1){z(k);for(var s=k.childNodes.length;s--;)svgedit.utilities.walkTree(k.childNodes.item(s),z)}};svgedit.utilities.walkTreePost=function(k,z){if(k&&k.nodeType==1){for(var s=k.childNodes.length;s--;)svgedit.utilities.walkTree(k.childNodes.item(s),z);z(k)}};svgedit.utilities.getUrlFromAttr=function(k){if(k){if(k.indexOf('url("')===0)return k.substring(5,
k.indexOf('"',6));if(k.indexOf("url('")===0)return k.substring(5,k.indexOf("'",6));if(k.indexOf("url(")===0)return k.substring(4,k.indexOf(")"))}return null};svgedit.utilities.getHref=function(k){return k.getAttributeNS(p.XLINK,"href")};svgedit.utilities.setHref=function(k,z){k.setAttributeNS(p.XLINK,"xlink:href",z)};svgedit.utilities.findDefs=function(){var k=f.getSVGContent(),z=k.getElementsByTagNameNS(p.SVG,"defs");if(z.length>0)z=z[0];else{z=k.ownerDocument.createElementNS(p.SVG,"defs");k.firstChild?
k.insertBefore(z,k.firstChild.nextSibling):k.appendChild(z)}return z};svgedit.utilities.getPathBBox=function(k){var z=k.pathSegList,s=z.numberOfItems;k=[[],[]];var E=z.getItem(0),A=[E.x,E.y];for(E=0;E<s;E++){var h=z.getItem(E);if(h.x!==a){k[0].push(A[0]);k[1].push(A[1]);if(h.x1){var u=[h.x1,h.y1],t=[h.x2,h.y2],v=[h.x,h.y],r;for(r=0;r<2;r++){h=function(ba){return Math.pow(1-ba,3)*A[r]+3*Math.pow(1-ba,2)*ba*u[r]+3*(1-ba)*Math.pow(ba,2)*t[r]+Math.pow(ba,3)*v[r]};var O=6*A[r]-12*u[r]+6*t[r],Z=-3*A[r]+
9*u[r]-9*t[r]+3*v[r],ka=3*u[r]-3*A[r];if(Z==0){if(O!=0){O=-ka/O;0<O&&O<1&&k[r].push(h(O))}}else{ka=Math.pow(O,2)-4*ka*Z;if(!(ka<0)){var ea=(-O+Math.sqrt(ka))/(2*Z);0<ea&&ea<1&&k[r].push(h(ea));O=(-O-Math.sqrt(ka))/(2*Z);0<O&&O<1&&k[r].push(h(O))}}}A=v}else{k[0].push(h.x);k[1].push(h.y)}}}z=Math.min.apply(null,k[0]);s=Math.max.apply(null,k[0])-z;E=Math.min.apply(null,k[1]);k=Math.max.apply(null,k[1])-E;return{x:z,y:E,width:s,height:k}};svgedit.utilities.getBBox=function(k){var z=k||f.geSelectedElements()[0];
if(k.nodeType!=1)return null;k=null;var s=z.nodeName;switch(s){case "text":if(z.textContent===""){z.textContent="a";k=z.getBBox();z.textContent=""}else try{k=z.getBBox()}catch(E){}break;case "path":if(svgedit.browser.supportsPathBBox())try{k=z.getBBox()}catch(A){}else k=svgedit.utilities.getPathBBox(z);break;case "g":case "a":k=J(z);break;default:if(s==="use")k=J(z,true);if(s==="use"||s==="foreignObject"&&svgedit.browser.isWebkit()){k||(k=z.getBBox());s={};s.width=k.width;s.height=k.height;s.x=k.x+
parseFloat(z.getAttribute("x")||0);s.y=k.y+parseFloat(z.getAttribute("y")||0);k=s}else if(~c.indexOf(s))try{k=z.getBBox()}catch(h){z=$(z).closest("foreignObject");if(z.length)try{k=z[0].getBBox()}catch(u){k=null}else k=null}}if(k)k=svgedit.utilities.bboxToObj(k);return k};svgedit.utilities.getRotationAngle=function(k,z){var s=k||f.getSelectedElements()[0];s=svgedit.transformlist.getTransformList(s);if(!s)return 0;var E=s.numberOfItems,A;for(A=0;A<E;++A){var h=s.getItem(A);if(h.type==4)return z?h.angle*
Math.PI/180:h.angle}return 0};svgedit.utilities.getRefElem=function(k){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(k).substr(1))};svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(k){return m.querySelector("#"+k)}:svgedit.browser.supportsXpath()?function(k){return n.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+k+'"]',i,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:function(k){return $(m).find("[id="+k+"]")[0]};svgedit.utilities.assignAttributes=
function(k,z,s,E){s||(s=0);svgedit.browser.isOpera()||m.suspendRedraw(s);for(var A in z)if(s=A.substr(0,4)==="xml:"?p.XML:A.substr(0,6)==="xlink:"?p.XLINK:null)k.setAttributeNS(s,A,z[A]);else E?svgedit.units.setUnitAttr(k,A,z[A]):k.setAttribute(A,z[A]);svgedit.browser.isOpera()||m.unsuspendRedraw(null)};svgedit.utilities.cleanupElement=function(k){var z=m.suspendRedraw(60),s={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt",
"stroke-opacity":1,"stroke-width":1,rx:0,ry:0},E;for(E in s){var A=s[E];k.getAttribute(E)==A&&k.removeAttribute(E)}m.unsuspendRedraw(z)};svgedit.utilities.snapToGrid=function(k){var z=f.getSnappingStep(),s=f.getBaseUnit();if(s!=="px")z*=svgedit.units.getTypeMap()[s];return k=Math.round(k/z)*z};svgedit.utilities.preg_quote=function(k,z){return String(k).replace(RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(z||"")+"-]","g"),"\\$&")};svgedit.utilities.executeAfterLoads=function(k,z,s){return function(){function E(){s.apply(null,
A)}var A=arguments;window[k]?E():z.reduceRight(function(h,u){return function(){$.getScript(u,h)}},E)()}};svgedit.utilities.buildCanvgCallback=function(k){return svgedit.utilities.executeAfterLoads("canvg",["canvg/rgbcolor.js","canvg/canvg.js"],k)};svgedit.utilities.buildJSPDFCallback=function(k){return svgedit.utilities.executeAfterLoads("RGBColor",["canvg/rgbcolor.js"],function(){var z=[];if(!RGBColor||RGBColor.ok===a)z.push("canvg/rgbcolor.js");svgedit.utilities.executeAfterLoads("jsPDF",z.concat("jspdf/underscore-min.js",
"jspdf/jspdf.min.js","jspdf/jspdf.plugin.svgToPdf.js"),k)()})}})();(function(){if(!svgedit.sanitize)svgedit.sanitize={};var a=svgedit.NS,J=svgedit.getReverseNS(),p={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask",
"opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin",
"stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display",
"fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id",
"class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity",
"stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id",
"r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class",
"clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures",
"spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],
mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing",
"width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},c={};$.each(p,function(f,n){var i={};$.each(n,function(m,k){if(k.indexOf(":")>=0){var z=k.split(":");i[z[1]]=a[z[0].toUpperCase()]}else i[k]=k=="xmlns"?a.XMLNS:null});c[f]=i});svgedit.sanitize.sanitizeSvg=function(f){if(f.nodeType==3){f.nodeValue=f.nodeValue.replace(/^\s+|\s+$/g,"");f.nodeValue.length===0&&f.parentNode.removeChild(f)}if(f.nodeType==1){var n=
f.parentNode;if(f.ownerDocument&&n){var i=p[f.nodeName],m=c[f.nodeName],k;if(typeof i!=="undefined"){var z=[];for(k=f.attributes.length;k--;){var s=f.attributes.item(k),E=s.nodeName,A=s.localName,h=s.namespaceURI;if(!(m.hasOwnProperty(A)&&h==m[A]&&h!=a.XMLNS)&&!(h==a.XMLNS&&J[s.value])){E.indexOf("se:")===0&&z.push([E,s.value]);f.removeAttributeNS(h,A)}if(svgedit.browser.isGecko())switch(E){case "transform":case "gradientTransform":case "patternTransform":A=s.value.replace(/(\d)-/g,"$1 -");f.setAttribute(E,
A)}if(E=="style"){s=s.value.split(";");for(E=s.length;E--;){h=s[E].split(":");A=$.trim(h[0]);h=$.trim(h[1]);i.indexOf(A)>=0&&f.setAttribute(A,h)}f.removeAttribute("style")}}$.each(z,function(u,t){f.setAttributeNS(a.SE,t[0],t[1])});if((k=svgedit.utilities.getHref(f))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(f.nodeName)>=0)if(k[0]!="#"){svgedit.utilities.setHref(f,"");f.removeAttributeNS(a.XLINK,"href")}if(f.nodeName=="use"&&!svgedit.utilities.getHref(f))n.removeChild(f);
else{$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(u,t){var v=f.getAttribute(t);if(v)if((v=svgedit.utilities.getUrlFromAttr(v))&&v[0]!=="#"){f.setAttribute(t,"");f.removeAttribute(t)}});for(k=f.childNodes.length;k--;)svgedit.sanitize.sanitizeSvg(f.childNodes.item(k))}}else{for(i=[];f.hasChildNodes();)i.push(n.insertBefore(f.firstChild,f));n.removeChild(f);for(k=i.length;k--;)svgedit.sanitize.sanitizeSvg(i[k])}}}}})();(function(){if(!svgedit.history)svgedit.history={};svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(a,J,p,c){this.elem=a;this.text=c?"Move "+a.tagName+" to "+c:"Move "+a.tagName;this.oldNextSibling=J;this.oldParent=p;this.newNextSibling=a.nextSibling;this.newParent=a.parentNode};svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"};
svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type;svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.MoveElementCommand.prototype.unapply=
function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.InsertElementCommand=function(a,J){this.elem=a;this.text=J||"Create "+a.tagName;this.parent=a.parentNode;this.nextSibling=this.elem.nextSibling};svgedit.history.InsertElementCommand.type=
function(){return"svgedit.history.InsertElementCommand"};svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type;svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text};svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.RemoveElementCommand=function(a,J,p,c){this.elem=a;this.text=c||"Delete "+a.tagName;
this.nextSibling=J;this.parent=p;svgedit.transformlist.removeElementFromListMap(a)};svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"};svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type;svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);
svgedit.transformlist.removeElementFromListMap(this.elem);this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.nextSibling==null&&window.console&&console.log("Error: reference element was lost");
this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.ChangeElementCommand=function(a,J,p){this.elem=a;this.text=p?"Change "+a.tagName+" "+p:"Change "+a.tagName;this.newValues={};this.oldValues=J;for(var c in J)this.newValues[c]=c=="#text"?a.textContent:c=="#href"?svgedit.utilities.getHref(a):a.getAttribute(c)};svgedit.history.ChangeElementCommand.type=
function(){return"svgedit.history.ChangeElementCommand"};svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type;svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text};svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var J=false,p;for(p in this.newValues){if(this.newValues[p])if(p=="#text")this.elem.textContent=this.newValues[p];else p=="#href"?
svgedit.utilities.setHref(this.elem,this.newValues[p]):this.elem.setAttribute(p,this.newValues[p]);else if(p=="#text")this.elem.textContent="";else{this.elem.setAttribute(p,"");this.elem.removeAttribute(p)}if(p=="transform")J=true}if(!J)if(J=svgedit.utilities.getRotationAngle(this.elem)){p=elem.getBBox();J=["rotate(",J," ",p.x+p.width/2,",",p.y+p.height/2,")"].join("");J!=elem.getAttribute("transform")&&elem.setAttribute("transform",J)}a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this);return true};svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var J=false,p;for(p in this.oldValues){if(this.oldValues[p])if(p=="#text")this.elem.textContent=this.oldValues[p];else p=="#href"?svgedit.utilities.setHref(this.elem,this.oldValues[p]):this.elem.setAttribute(p,this.oldValues[p]);else if(p=="#text")this.elem.textContent="";else this.elem.removeAttribute(p);if(p=="transform")J=true}if(!J)if(J=
svgedit.utilities.getRotationAngle(this.elem)){p=elem.getBBox();J=["rotate(",J," ",p.x+p.width/2,",",p.y+p.height/2,")"].join("");J!=elem.getAttribute("transform")&&elem.setAttribute("transform",J)}svgedit.transformlist.removeElementFromListMap(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command";
this.stack=[]};svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"};svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type;svgedit.history.BatchCommand.prototype.getText=function(){return this.text};svgedit.history.BatchCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var J,p=this.stack.length;for(J=0;J<p;++J)this.stack[J].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var J;for(J=this.stack.length-1;J>=0;J--)this.stack[J].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],J=this.stack.length;J--;)for(var p=this.stack[J].elements(),c=p.length;c--;)a.indexOf(p[c])==-1&&a.push(p[c]);return a};svgedit.history.BatchCommand.prototype.addSubCommand=
function(a){this.stack.push(a)};svgedit.history.BatchCommand.prototype.isEmpty=function(){return this.stack.length===0};svgedit.history.UndoManager=function(a){this.handler_=a||null;this.undoStackPointer=0;this.undoStack=[];this.undoChangeStackPointer=-1;this.undoableChangeStack=[]};svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[];this.undoStackPointer=0};svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer};svgedit.history.UndoManager.prototype.getRedoStackSize=
function(){return this.undoStack.length-this.undoStackPointer};svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""};svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""};svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)};
svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)};svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0)this.undoStack=this.undoStack.splice(0,this.undoStackPointer);this.undoStack.push(a);this.undoStackPointer=this.undoStack.length};svgedit.history.UndoManager.prototype.beginUndoableChange=
function(a,J){for(var p=++this.undoChangeStackPointer,c=J.length,f=Array(c),n=Array(c);c--;){var i=J[c];if(i!=null){n[c]=i;f[c]=i.getAttribute(a)}}this.undoableChangeStack[p]={attrName:a,oldValues:f,elements:n}};svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,J=this.undoableChangeStack[a],p=J.elements.length,c=J.attrName,f=new svgedit.history.BatchCommand("Change "+c);p--;){var n=J.elements[p];if(n!=null){var i={};i[c]=J.oldValues[p];i[c]!=
n.getAttribute(c)&&f.addSubCommand(new svgedit.history.ChangeElementCommand(n,i,c))}}this.undoableChangeStack[a]=null;return f}})();var svgedit=svgedit||{};
(function(){if(!svgedit.coords)svgedit.coords={};var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],J=null;svgedit.coords.init=function(p){J=p};svgedit.coords.remapElement=function(p,c,f){var n,i,m=function(u,t){return svgedit.math.transformPoint(u,t,f)},k=J.getGridSnapping()&&p.parentNode.parentNode.localName==="svg",z=function(){var u;if(k)for(u in c)c[u]=svgedit.utilities.snapToGrid(c[u]);svgedit.utilities.assignAttributes(p,c,1E3,true)},s=svgedit.utilities.getBBox(p);
for(n=0;n<2;n++){i=n===0?"fill":"stroke";var E=p.getAttribute(i);if(E&&E.indexOf("url(")===0)if(f.a<0||f.d<0){E=svgedit.utilities.getRefElem(E).cloneNode(true);if(f.a<0){var A=E.getAttribute("x1"),h=E.getAttribute("x2");E.setAttribute("x1",-(A-1));E.setAttribute("x2",-(h-1))}if(f.d<0){A=E.getAttribute("y1");h=E.getAttribute("y2");E.setAttribute("y1",-(A-1));E.setAttribute("y2",-(h-1))}E.id=J.getDrawing().getNextId();svgedit.utilities.findDefs().appendChild(E);p.setAttribute(i,"url(#"+E.id+")")}}n=
p.tagName;if(n==="g"||n==="text"||n=="tspan"||n==="use")if(f.a==1&&f.b==0&&f.c==0&&f.d==1&&(f.e!=0||f.f!=0)){i=svgedit.math.transformListToTransform(p).matrix;i=svgedit.math.matrixMultiply(i.inverse(),f,i);c.x=parseFloat(c.x)+i.e;c.y=parseFloat(c.y)+i.f}else{i=svgedit.transformlist.getTransformList(p);E=svgroot.createSVGTransform();E.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(i).matrix,f));i.clear();i.appendItem(E)}switch(n){case "foreignObject":case "rect":case "image":if(n===
"image"&&(f.a<0||f.d<0)){i=svgedit.transformlist.getTransformList(p);E=svgroot.createSVGTransform();E.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(i).matrix,f));i.clear();i.appendItem(E)}else{E=m(c.x,c.y);c.width=f.a*c.width;c.height=f.d*c.height;c.x=E.x+Math.min(0,c.width);c.y=E.y+Math.min(0,c.height);c.width=Math.abs(c.width);c.height=Math.abs(c.height)}z();break;case "ellipse":m=m(c.cx,c.cy);c.cx=m.x;c.cy=m.y;c.rx=f.a*c.rx;c.ry=f.d*c.ry;c.rx=Math.abs(c.rx);c.ry=Math.abs(c.ry);
z();break;case "circle":m=m(c.cx,c.cy);c.cx=m.x;c.cy=m.y;m=svgedit.math.transformBox(s.x,s.y,s.width,s.height,f);c.r=Math.min((m.tr.x-m.tl.x)/2,(m.bl.y-m.tl.y)/2);if(c.r)c.r=Math.abs(c.r);z();break;case "line":E=m(c.x1,c.y1);A=m(c.x2,c.y2);c.x1=E.x;c.y1=E.y;c.x2=A.x;c.y2=A.y;case "text":case "tspan":case "use":z();break;case "g":(m=$(p).data("gsvg"))&&svgedit.utilities.assignAttributes(m,c,1E3,true);break;case "polyline":case "polygon":z=c.points.length;for(n=0;n<z;++n){i=c.points[n];i=m(i.x,i.y);
c.points[n].x=i.x;c.points[n].y=i.y}z=c.points.length;m="";for(n=0;n<z;++n){i=c.points[n];m+=i.x+","+i.y+" "}p.setAttribute("points",m);break;case "path":i=p.pathSegList;z=i.numberOfItems;c.d=[];for(n=0;n<z;++n){s=i.getItem(n);c.d[n]={type:s.pathSegType,x:s.x,y:s.y,x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,r1:s.r1,r2:s.r2,angle:s.angle,largeArcFlag:s.largeArcFlag,sweepFlag:s.sweepFlag}}z=c.d.length;n=c.d[0];h=m(n.x,n.y);c.d[0].x=h.x;c.d[0].y=h.y;for(n=1;n<z;++n){s=c.d[n];i=s.type;if(i%2==0){i=m(s.x!=undefined?
s.x:h.x,s.y!=undefined?s.y:h.y);E=m(s.x1,s.y1);A=m(s.x2,s.y2);s.x=i.x;s.y=i.y;s.x1=E.x;s.y1=E.y;s.x2=A.x;s.y2=A.y}else{s.x=f.a*s.x;s.y=f.d*s.y;s.x1=f.a*s.x1;s.y1=f.d*s.y1;s.x2=f.a*s.x2;s.y2=f.d*s.y2}s.r1=f.a*s.r1;s.r2=f.d*s.r2}m="";z=c.d.length;for(n=0;n<z;++n){s=c.d[n];i=s.type;m+=a[i];switch(i){case 13:case 12:m+=s.x+" ";break;case 15:case 14:m+=s.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:m+=s.x+","+s.y+" ";break;case 7:case 6:m+=s.x1+","+s.y1+" "+s.x2+","+s.y2+" "+s.x+","+s.y+" ";
break;case 9:case 8:m+=s.x1+","+s.y1+" "+s.x+","+s.y+" ";break;case 11:case 10:m+=s.r1+","+s.r2+" "+s.angle+" "+ +s.largeArcFlag+" "+ +s.sweepFlag+" "+s.x+","+s.y+" ";break;case 17:case 16:m+=s.x2+","+s.y2+" "+s.x+","+s.y+" "}}p.setAttribute("d",m)}}})();svgedit=svgedit||{};
(function(){if(!svgedit.recalculate)svgedit.recalculate={};var a=svgedit.NS,J;svgedit.recalculate.init=function(p){J=p};svgedit.recalculate.updateClipPath=function(p,c,f){p=getRefElem(p).firstChild;var n=svgedit.transformlist.getTransformList(p),i=J.getSVGRoot().createSVGTransform();i.setTranslate(c,f);n.appendItem(i);svgedit.recalculate.recalculateDimensions(p)};svgedit.recalculate.recalculateDimensions=function(p){if(p==null)return null;if(p.nodeName=="svg"&&navigator.userAgent.indexOf("Firefox/20")>=0)return null;
var c=J.getSVGRoot(),f=svgedit.transformlist.getTransformList(p),n;if(f&&f.numberOfItems>0){for(n=f.numberOfItems;n--;){var i=f.getItem(n);if(i.type===0)f.removeItem(n);else if(i.type===1)svgedit.math.isIdentity(i.matrix)&&f.removeItem(n);else i.type===4&&i.angle===0&&f.removeItem(n)}if(f.numberOfItems===1&&svgedit.utilities.getRotationAngle(p))return null}if(!f||f.numberOfItems==0){p.setAttribute("transform","");p.removeAttribute("transform");return null}if(f){n=f.numberOfItems;for(var m=[];n--;){i=
f.getItem(n);if(i.type===1)m.push([i.matrix,n]);else if(m.length)m=[]}if(m.length===2){n=c.createSVGTransformFromMatrix(svgedit.math.matrixMultiply(m[1][0],m[0][0]));f.removeItem(m[0][1]);f.removeItem(m[1][1]);f.insertItemBefore(n,m[1][1])}n=f.numberOfItems;if(n>=2&&f.getItem(n-2).type===1&&f.getItem(n-1).type===2){m=c.createSVGTransform();i=svgedit.math.matrixMultiply(f.getItem(n-2).matrix,f.getItem(n-1).matrix);m.setMatrix(i);f.removeItem(n-2);f.removeItem(n-2);f.appendItem(m)}}switch(p.tagName){case "line":case "polyline":case "polygon":case "path":break;
default:if(f.numberOfItems===1&&f.getItem(0).type===1||f.numberOfItems===2&&f.getItem(0).type===1&&f.getItem(0).type===4)return null}var k=$(p).data("gsvg");n=new svgedit.history.BatchCommand("Transform");var z={},s=null;i=[];switch(p.tagName){case "line":i=["x1","y1","x2","y2"];break;case "circle":i=["cx","cy","r"];break;case "ellipse":i=["cx","cy","rx","ry"];break;case "foreignObject":case "rect":case "image":i=["width","height","x","y"];break;case "use":case "text":case "tspan":i=["x","y"];break;
case "polygon":case "polyline":s={};s.points=p.getAttribute("points");m=p.points;var E=m.numberOfItems;z.points=Array(E);var A;for(A=0;A<E;++A){var h=m.getItem(A);z.points[A]={x:h.x,y:h.y}}break;case "path":s={};s.d=p.getAttribute("d");z.d=p.getAttribute("d")}if(i.length){z=$(p).attr(i);$.each(z,function(db,ua){z[db]=svgedit.units.convertToNum(db,ua)})}else if(k)z={x:$(k).attr("x")||0,y:$(k).attr("y")||0};if(s==null){s=$.extend(true,{},z);$.each(s,function(db,ua){s[db]=svgedit.units.convertToNum(db,
ua)})}s.transform=J.getStartTransform()||"";if(p.tagName=="g"&&!k||p.tagName=="a"){m=svgedit.utilities.getBBox(p);var u={x:m.x+m.width/2,y:m.y+m.height/2},t=svgedit.math.transformPoint(m.x+m.width/2,m.y+m.height/2,svgedit.math.transformListToTransform(f).matrix);i=c.createSVGMatrix();if(m=svgedit.utilities.getRotationAngle(p)){A=m*Math.PI/180;E=Math.abs(A)>1.0E-10?Math.sin(A)/(1-Math.cos(A)):2/A;for(A=0;A<f.numberOfItems;++A){i=f.getItem(A);if(i.type==4){i=i.matrix;u.y=(E*i.e+i.f)/2;u.x=(i.e-E*i.f)/
2;f.removeItem(A);break}}}A=i=k=0;var v=f.numberOfItems;if(v)var r=f.getItem(0).matrix;if(v>=3&&f.getItem(v-2).type==3&&f.getItem(v-3).type==2&&f.getItem(v-1).type==2){A=3;var O=f.getItem(v-3).matrix,Z=f.getItem(v-2).matrix,ka=f.getItem(v-1).matrix;E=p.childNodes;for(h=E.length;h--;){var ea=E.item(h);i=k=0;if(ea.nodeType==1){var ba=svgedit.transformlist.getTransformList(ea);if(ba){i=svgedit.math.transformListToTransform(ba).matrix;k=svgedit.utilities.getRotationAngle(ea);var ia=J.getStartTransform(),
Pa=[];J.setStartTransform(ea.getAttribute("transform"));if(k||svgedit.math.hasMatrixTransform(ba)){var Ca=c.createSVGTransform();Ca.setMatrix(svgedit.math.matrixMultiply(O,Z,ka,i));ba.clear();ba.appendItem(Ca);Pa.push(Ca)}else{k=svgedit.math.matrixMultiply(i.inverse(),ka,i);Ca=c.createSVGMatrix();Ca.e=-k.e;Ca.f=-k.f;i=svgedit.math.matrixMultiply(Ca.inverse(),i.inverse(),O,Z,ka,i,k.inverse());var eb=c.createSVGTransform(),Hb=c.createSVGTransform(),mb=c.createSVGTransform();eb.setTranslate(k.e,k.f);
Hb.setScale(i.a,i.d);mb.setTranslate(Ca.e,Ca.f);ba.appendItem(mb);ba.appendItem(Hb);ba.appendItem(eb);Pa.push(mb);Pa.push(Hb);Pa.push(eb)}n.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));J.setStartTransform(ia)}}}f.removeItem(v-1);f.removeItem(v-2);f.removeItem(v-3)}else if(v>=3&&f.getItem(v-1).type==1){A=3;i=svgedit.math.transformListToTransform(f).matrix;Ca=c.createSVGTransform();Ca.setMatrix(i);f.clear();f.appendItem(Ca)}else if((v==1||v>1&&f.getItem(1).type!=3)&&f.getItem(0).type==
2){A=2;k=svgedit.math.transformListToTransform(f).matrix;f.removeItem(0);i=svgedit.math.transformListToTransform(f).matrix.inverse();i=svgedit.math.matrixMultiply(i,k);k=i.e;i=i.f;if(k!=0||i!=0){E=p.childNodes;h=E.length;for(v=[];h--;){ea=E.item(h);if(ea.nodeType==1){if(ea.getAttribute("clip-path")){ia=ea.getAttribute("clip-path");if(v.indexOf(ia)===-1){svgedit.recalculate.updateClipPath(ia,k,i);v.push(ia)}}ia=J.getStartTransform();J.setStartTransform(ea.getAttribute("transform"));if(ba=svgedit.transformlist.getTransformList(ea)){O=
c.createSVGTransform();O.setTranslate(k,i);ba.numberOfItems?ba.insertItemBefore(O,0):ba.appendItem(O);n.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));ba=p.getElementsByTagNameNS(a.SVG,"use");ea="#"+ea.id;for(O=ba.length;O--;){Z=ba.item(O);if(ea==svgedit.utilities.getHref(Z)){ka=c.createSVGTransform();ka.setTranslate(-k,-i);svgedit.transformlist.getTransformList(Z).insertItemBefore(ka,0);n.addSubCommand(svgedit.recalculate.recalculateDimensions(Z))}}J.setStartTransform(ia)}}}v=[];J.setStartTransform(ia)}}else if(v==
1&&f.getItem(0).type==1&&!m){A=1;i=f.getItem(0).matrix;E=p.childNodes;for(h=E.length;h--;){ea=E.item(h);if(ea.nodeType==1){ia=J.getStartTransform();J.setStartTransform(ea.getAttribute("transform"));if(ba=svgedit.transformlist.getTransformList(ea)){k=svgedit.math.matrixMultiply(i,svgedit.math.transformListToTransform(ba).matrix);v=c.createSVGTransform();v.setMatrix(k);ba.clear();ba.appendItem(v,0);n.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));J.setStartTransform(ia);ia=ea.getAttribute("stroke-width");
ea.getAttribute("stroke")!=="none"&&!isNaN(ia)&&ea.setAttribute("stroke-width",ia*((Math.abs(k.a)+Math.abs(k.d))/2))}}}f.clear()}else{if(m){c=c.createSVGTransform();c.setRotate(m,t.x,t.y);f.numberOfItems?f.insertItemBefore(c,0):f.appendItem(c)}f.numberOfItems==0&&p.removeAttribute("transform");return null}if(A==2){if(m){t={x:u.x+r.e,y:u.y+r.f};c=c.createSVGTransform();c.setRotate(m,t.x,t.y);f.numberOfItems?f.insertItemBefore(c,0):f.appendItem(c)}}else if(A==3){i=svgedit.math.transformListToTransform(f).matrix;
r=c.createSVGTransform();r.setRotate(m,u.x,u.y);r=r.matrix;u=c.createSVGTransform();u.setRotate(m,t.x,t.y);t=u.matrix.inverse();ia=i.inverse();t=svgedit.math.matrixMultiply(ia,t,r,i);k=t.e;i=t.f;if(k!=0||i!=0){E=p.childNodes;for(h=E.length;h--;){ea=E.item(h);if(ea.nodeType==1){ia=J.getStartTransform();J.setStartTransform(ea.getAttribute("transform"));ba=svgedit.transformlist.getTransformList(ea);O=c.createSVGTransform();O.setTranslate(k,i);ba.numberOfItems?ba.insertItemBefore(O,0):ba.appendItem(O);
n.addSubCommand(svgedit.recalculate.recalculateDimensions(ea));J.setStartTransform(ia)}}}if(m)f.numberOfItems?f.insertItemBefore(u,0):f.appendItem(u)}}else{m=svgedit.utilities.getBBox(p);if(!m&&p.tagName!="path")return null;i=c.createSVGMatrix();if(k=svgedit.utilities.getRotationAngle(p)){u={x:m.x+m.width/2,y:m.y+m.height/2};t=svgedit.math.transformPoint(m.x+m.width/2,m.y+m.height/2,svgedit.math.transformListToTransform(f).matrix);A=k*Math.PI/180;E=Math.abs(A)>1.0E-10?Math.sin(A)/(1-Math.cos(A)):
2/A;for(A=0;A<f.numberOfItems;++A){i=f.getItem(A);if(i.type==4){i=i.matrix;u.y=(E*i.e+i.f)/2;u.x=(i.e-E*i.f)/2;f.removeItem(A);break}}}A=0;v=f.numberOfItems;if(!svgedit.browser.isWebkit())if((r=p.getAttribute("fill"))&&r.indexOf("url(")===0){r=getRefElem(r);ia="pattern";if(r.tagName!==ia)ia="gradient";if(r.getAttribute(ia+"Units")==="userSpaceOnUse"){i=svgedit.math.transformListToTransform(f).matrix;m=svgedit.transformlist.getTransformList(r);m=svgedit.math.transformListToTransform(m).matrix;i=svgedit.math.matrixMultiply(i,
m);m="matrix("+[i.a,i.b,i.c,i.d,i.e,i.f].join(",")+")";r.setAttribute(ia+"Transform",m)}}if(v>=3&&f.getItem(v-2).type==3&&f.getItem(v-3).type==2&&f.getItem(v-1).type==2){A=3;i=svgedit.math.transformListToTransform(f,v-3,v-1).matrix;f.removeItem(v-1);f.removeItem(v-2);f.removeItem(v-3)}else if(v==4&&f.getItem(v-1).type==1){A=3;i=svgedit.math.transformListToTransform(f).matrix;Ca=c.createSVGTransform();Ca.setMatrix(i);f.clear();f.appendItem(Ca);i=c.createSVGMatrix()}else if((v==1||v>1&&f.getItem(1).type!=
3)&&f.getItem(0).type==2){A=2;r=f.getItem(0).matrix;ia=svgedit.math.transformListToTransform(f,1).matrix;m=ia.inverse();i=svgedit.math.matrixMultiply(m,r,ia);f.removeItem(0)}else if(v==1&&f.getItem(0).type==1&&!k){i=svgedit.math.transformListToTransform(f).matrix;switch(p.tagName){case "line":z=$(p).attr(["x1","y1","x2","y2"]);case "polyline":case "polygon":z.points=p.getAttribute("points");if(z.points){m=p.points;E=m.numberOfItems;z.points=Array(E);for(A=0;A<E;++A){h=m.getItem(A);z.points[A]={x:h.x,
y:h.y}}}case "path":z.d=p.getAttribute("d");A=1;f.clear()}}else{A=4;if(k){c=c.createSVGTransform();c.setRotate(k,t.x,t.y);f.numberOfItems?f.insertItemBefore(c,0):f.appendItem(c)}f.numberOfItems==0&&p.removeAttribute("transform");return null}if(A==1||A==2||A==3)svgedit.coords.remapElement(p,z,i);if(A==2){if(k){svgedit.math.hasMatrixTransform(f)||(t={x:u.x+i.e,y:u.y+i.f});c=c.createSVGTransform();c.setRotate(k,t.x,t.y);f.numberOfItems?f.insertItemBefore(c,0):f.appendItem(c)}if(p.tagName=="text"){E=
p.childNodes;for(h=E.length;h--;){ea=E.item(h);if(ea.tagName=="tspan"){c={x:$(ea).attr("x")||0,y:$(ea).attr("y")||0};svgedit.coords.remapElement(ea,c,i)}}}}else if(A==3&&k){i=svgedit.math.transformListToTransform(f).matrix;r=c.createSVGTransform();r.setRotate(k,u.x,u.y);r=r.matrix;u=c.createSVGTransform();u.setRotate(k,t.x,t.y);t=u.matrix.inverse();ia=i.inverse();t=svgedit.math.matrixMultiply(ia,t,r,i);svgedit.coords.remapElement(p,z,t);if(k)f.numberOfItems?f.insertItemBefore(u,0):f.appendItem(u)}}f.numberOfItems==
0&&p.removeAttribute("transform");n.addSubCommand(new svgedit.history.ChangeElementCommand(p,s));return n}})();(function(){if(!svgedit.select)svgedit.select={};var a,J,p,c=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(f,n){this.id=f;this.selectedElement=n;this.locked=true;this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}});this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}}));this.gripCoords={nw:null,
n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.reset(this.selectedElement)};svgedit.select.Selector.prototype.reset=function(f){this.locked=true;this.selectedElement=f;this.resize();this.selectorGroup.setAttribute("display","inline")};svgedit.select.Selector.prototype.updateGripCursors=function(f){var n,i=[];f=Math.round(f/45);if(f<0)f+=8;for(n in p.selectorGrips)i.push(n);for(;f>0;){i.push(i.shift());f--}f=0;for(n in p.selectorGrips){p.selectorGrips[n].setAttribute("style","cursor:"+i[f]+
"-resize");f++}};svgedit.select.Selector.prototype.showGrips=function(f){p.selectorGripsGroup.setAttribute("display",f?"inline":"none");var n=this.selectedElement;this.hasGrips=f;if(n&&f){this.selectorGroup.appendChild(p.selectorGripsGroup);this.updateGripCursors(svgedit.utilities.getRotationAngle(n))}};svgedit.select.Selector.prototype.resize=function(){var f=this.selectorRect,n=p,i=n.selectorGrips,m=this.selectedElement,k=m.getAttribute("stroke-width"),z=a.currentZoom(),s=1/z;if(m.getAttribute("stroke")!==
"none"&&!isNaN(k))s+=k/2;var E=m.tagName;if(E==="text")s+=2/z;k=svgedit.transformlist.getTransformList(m);k=svgedit.math.transformListToTransform(k).matrix;k.e*=z;k.f*=z;var A=svgedit.utilities.getBBox(m);if(E==="g"&&!$.data(m,"gsvg"))if(E=a.getStrokedBBox(m.childNodes))A=E;E=A.x;var h=A.y,u=A.width;A=A.height;s*=z;z=svgedit.math.transformBox(E*z,h*z,u*z,A*z,k);k=z.aabox;E=k.x-s;h=k.y-s;u=k.width+s*2;var t=k.height+s*2;k=E+u/2;A=h+t/2;if(m=svgedit.utilities.getRotationAngle(m)){E=a.svgRoot().createSVGTransform();
E.setRotate(-m,k,A);E=E.matrix;z.tl=svgedit.math.transformPoint(z.tl.x,z.tl.y,E);z.tr=svgedit.math.transformPoint(z.tr.x,z.tr.y,E);z.bl=svgedit.math.transformPoint(z.bl.x,z.bl.y,E);z.br=svgedit.math.transformPoint(z.br.x,z.br.y,E);E=z.tl;u=E.x;t=E.y;var v=E.x,r=E.y;E=Math.min;h=Math.max;u=E(u,E(z.tr.x,E(z.bl.x,z.br.x)))-s;t=E(t,E(z.tr.y,E(z.bl.y,z.br.y)))-s;v=h(v,h(z.tr.x,h(z.bl.x,z.br.x)))+s;r=h(r,h(z.tr.y,h(z.bl.y,z.br.y)))+s;E=u;h=t;u=v-u;t=r-t}s=a.svgRoot().suspendRedraw(100);f.setAttribute("d",
"M"+E+","+h+" L"+(E+u)+","+h+" "+(E+u)+","+(h+t)+" "+E+","+(h+t)+"z");this.selectorGroup.setAttribute("transform",m?"rotate("+[m,k,A].join(",")+")":"");this.gripCoords={nw:[E,h],ne:[E+u,h],sw:[E,h+t],se:[E+u,h+t],n:[E+u/2,h],w:[E,h+t/2],e:[E+u,h+t/2],s:[E+u/2,h+t]};for(var O in this.gripCoords){f=this.gripCoords[O];i[O].setAttribute("cx",f[0]);i[O].setAttribute("cy",f[1])}n.rotateGripConnector.setAttribute("x1",E+u/2);n.rotateGripConnector.setAttribute("y1",h);n.rotateGripConnector.setAttribute("x2",
E+u/2);n.rotateGripConnector.setAttribute("y2",h-c*5);n.rotateGrip.setAttribute("cx",E+u/2);n.rotateGrip.setAttribute("cy",h-c*5);a.svgRoot().unsuspendRedraw(s)};svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null;this.selectors=[];this.selectorMap={};this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.rotateGrip=this.rotateGripConnector=this.selectorGripsGroup=null;this.initGroup()};svgedit.select.SelectorManager.prototype.initGroup=
function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup);this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}});this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}});this.selectorParentGroup.appendChild(this.selectorGripsGroup);a.svgRoot().appendChild(this.selectorParentGroup);this.selectorMap={};this.selectors=[];this.rubberBandBox=null;for(var f in this.selectorGrips){var n=
a.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+f,fill:"#22C",r:c,style:"cursor:"+f+"-resize","stroke-width":2,"pointer-events":"all"}});$.data(n,"dir",f);$.data(n,"type","resize");this.selectorGrips[f]=this.selectorGripsGroup.appendChild(n)}this.rotateGripConnector=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}}));this.rotateGrip=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"circle",
attr:{id:"selectorGrip_rotate",fill:"lime",r:c,stroke:"#22C","stroke-width":2,style:"cursor:url("+J.imgPath+"rotate.png) 12 12, auto;"}}));$.data(this.rotateGrip,"type","rotate");if(!$("#canvasBackground").length){f=J.dimensions;f=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:f[0],height:f[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}});n=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,
stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});f.appendChild(n);a.svgRoot().insertBefore(f,a.svgContent())}};svgedit.select.SelectorManager.prototype.requestSelector=function(f){if(f==null)return null;var n,i=this.selectors.length;if(typeof this.selectorMap[f.id]=="object"){this.selectorMap[f.id].locked=true;return this.selectorMap[f.id]}for(n=0;n<i;++n)if(this.selectors[n]&&!this.selectors[n].locked){this.selectors[n].locked=true;this.selectors[n].reset(f);this.selectorMap[f.id]=this.selectors[n];
return this.selectors[n]}this.selectors[i]=new svgedit.select.Selector(i,f);this.selectorParentGroup.appendChild(this.selectors[i].selectorGroup);this.selectorMap[f.id]=this.selectors[i];return this.selectors[i]};svgedit.select.SelectorManager.prototype.releaseSelector=function(f){if(f!=null){var n,i=this.selectors.length,m=this.selectorMap[f.id];for(n=0;n<i;++n)if(this.selectors[n]&&this.selectors[n]==m){m.locked==false&&console.log("WARNING! selector was released but was already unlocked");delete this.selectorMap[f.id];
m.locked=false;m.selectedElement=null;m.showGrips(false);try{m.selectorGroup.setAttribute("display","none")}catch(k){}break}}};svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){if(!this.rubberBandBox)this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":0.15,stroke:"#22C","stroke-width":0.5,display:"none",style:"pointer-events:none"}}));return this.rubberBandBox};svgedit.select.init=function(f,
n){J=f;a=n;p=new svgedit.select.SelectorManager};svgedit.select.getSelectorManager=function(){return p}})();(function(){if(!svgedit.draw)svgedit.draw={};var a=svgedit.NS,J="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),p={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},c=p.LET_DOCUMENT_DECIDE;svgedit.draw.Layer=function(f,n){this.name_=f;this.group_=n};svgedit.draw.Layer.prototype.getName=function(){return this.name_};svgedit.draw.Layer.prototype.getGroup=function(){return this.group_};svgedit.draw.randomizeIds=function(f,n){c=f===false?
p.NEVER_RANDOMIZE:p.ALWAYS_RANDOMIZE;if(c==p.ALWAYS_RANDOMIZE&&!n.getNonce())n.setNonce(Math.floor(Math.random()*100001));else c==p.NEVER_RANDOMIZE&&n.getNonce()&&n.clearNonce()};svgedit.draw.Drawing=function(f,n){if(!f||!f.tagName||!f.namespaceURI||f.tagName!="svg"||f.namespaceURI!=a.SVG)throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=f;this.obj_num=0;this.idPrefix=n||"svg_";this.releasedNums=[];this.all_layers=[];this.current_layer=null;this.nonce_=
"";var i=this.svgElem_.getAttributeNS(a.SE,"nonce");if(i&&c!=p.NEVER_RANDOMIZE)this.nonce_=i;else c==p.ALWAYS_RANDOMIZE&&this.setNonce(Math.floor(Math.random()*100001))};svgedit.draw.Drawing.prototype.getElem_=function(f){if(this.svgElem_.querySelector)return this.svgElem_.querySelector("#"+f);return $(this.svgElem_).find("[id="+f+"]")[0]};svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_};svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_};svgedit.draw.Drawing.prototype.setNonce=
function(f){this.svgElem_.setAttributeNS(a.XMLNS,"xmlns:se",a.SE);this.svgElem_.setAttributeNS(a.SE,"se:nonce",f);this.nonce_=f};svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""};svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num};svgedit.draw.Drawing.prototype.getNextId=function(){var f=this.obj_num,n=false;if(this.releasedNums.length>0){this.obj_num=this.releasedNums.pop();n=true}else this.obj_num++;
for(var i=this.getId();this.getElem_(i);){if(n){this.obj_num=f;n=false}this.obj_num++;i=this.getId()}if(n)this.obj_num=f;return i};svgedit.draw.Drawing.prototype.releaseId=function(f){var n=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if(typeof f!=="string"||f.indexOf(n)!==0)return false;f=parseInt(f.substr(n.length),10);if(typeof f!=="number"||f<=0||this.releasedNums.indexOf(f)!=-1)return false;this.releasedNums.push(f);return true};svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length};
svgedit.draw.Drawing.prototype.hasLayer=function(f){var n;for(n=0;n<this.getNumLayers();n++)if(this.all_layers[n][0]==f)return true;return false};svgedit.draw.Drawing.prototype.getLayerName=function(f){if(f>=0&&f<this.getNumLayers())return this.all_layers[f][0];return""};svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer};svgedit.draw.Drawing.prototype.getCurrentLayerName=function(){var f;for(f=0;f<this.getNumLayers();++f)if(this.all_layers[f][1]==this.current_layer)return this.getLayerName(f);
return""};svgedit.draw.Drawing.prototype.setCurrentLayer=function(f){var n;for(n=0;n<this.getNumLayers();++n)if(f==this.getLayerName(n)){if(this.current_layer!=this.all_layers[n][1]){this.current_layer.setAttribute("style","pointer-events:none");this.current_layer=this.all_layers[n][1];this.current_layer.setAttribute("style","pointer-events:all")}return true}return false};svgedit.draw.Drawing.prototype.deleteCurrentLayer=function(){if(this.current_layer&&this.getNumLayers()>1){var f=this.current_layer.parentNode.removeChild(this.current_layer);
this.identifyLayers();return f}return null};svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];var f=this.svgElem_.childNodes.length,n=[],i=[],m=null,k=false,z;for(z=0;z<f;++z){var s=this.svgElem_.childNodes.item(z);if(s&&s.nodeType==1)if(s.tagName=="g"){k=true;var E=$("title",s).text();if(!E&&svgedit.browser.isOpera()&&s.querySelectorAll)E=$(s.querySelectorAll("title")).text();if(E){i.push(E);this.all_layers.push([E,s]);m=s;svgedit.utilities.walkTree(s,function(A){A.setAttribute("style",
"pointer-events:inherit")});m.setAttribute("style","pointer-events:none")}else n.push(s)}else if(~J.indexOf(s.nodeName)){svgedit.utilities.getBBox(s);n.push(s)}}f=this.svgElem_.ownerDocument;if(n.length>0||!k){for(z=1;i.indexOf("Layer "+z)>=0;)z++;i="Layer "+z;m=f.createElementNS(a.SVG,"g");k=f.createElementNS(a.SVG,"title");k.textContent=i;m.appendChild(k);for(k=0;k<n.length;++k)m.appendChild(n[k]);this.svgElem_.appendChild(m);this.all_layers.push([i,m])}svgedit.utilities.walkTree(m,function(A){A.setAttribute("style",
"pointer-events:inherit")});this.current_layer=m;this.current_layer.setAttribute("style","pointer-events:all")};svgedit.draw.Drawing.prototype.createLayer=function(f){var n=this.svgElem_.ownerDocument,i=n.createElementNS(a.SVG,"g");n=n.createElementNS(a.SVG,"title");n.textContent=f;i.appendChild(n);this.svgElem_.appendChild(i);this.identifyLayers();return i};svgedit.draw.Drawing.prototype.getLayerVisibility=function(f){var n=null,i;for(i=0;i<this.getNumLayers();++i)if(this.getLayerName(i)==f){n=this.all_layers[i][1];
break}if(!n)return false;return n.getAttribute("display")!=="none"};svgedit.draw.Drawing.prototype.setLayerVisibility=function(f,n){if(typeof n!=="boolean")return null;var i=null,m;for(m=0;m<this.getNumLayers();++m)if(this.getLayerName(m)==f){i=this.all_layers[m][1];break}if(!i)return null;i.getAttribute("display");i.setAttribute("display",n?"inline":"none");return i};svgedit.draw.Drawing.prototype.getLayerOpacity=function(f){var n;for(n=0;n<this.getNumLayers();++n)if(this.getLayerName(n)==f){(f=
this.all_layers[n][1].getAttribute("opacity"))||(f="1.0");return parseFloat(f)}return null};svgedit.draw.Drawing.prototype.setLayerOpacity=function(f,n){if(!(typeof n!=="number"||n<0||n>1)){var i;for(i=0;i<this.getNumLayers();++i)if(this.getLayerName(i)==f){this.all_layers[i][1].setAttribute("opacity",n);break}}}})();(function(){if(!svgedit.path)svgedit.path={};var a=svgedit.NS,J={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},p={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},c=[],f=true,n={};svgedit.path.setLinkControlPoints=function(h){f=h};var i=svgedit.path.path=null;
svgedit.path.init=function(h){i=h;c=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(u,t){c.push(t+"Abs");c.push(t+"Rel")})};svgedit.path.insertItemBefore=function(h,u,t){h=h.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())h.insertItemBefore(u,t);else{var v=h.numberOfItems,r=[],O;for(O=0;O<v;O++){var Z=h.getItem(O);r.push(Z)}h.clear();for(O=0;O<v;O++){O==t&&h.appendItem(u);
h.appendItem(r[O])}}};svgedit.path.ptObjToArr=function(h,u){var t=p[h],v=t.length,r,O=[];for(r=0;r<v;r++)O[r]=u[t[r]];return O};svgedit.path.getGripPt=function(h,u){var t={x:u?u.x:h.item.x,y:u?u.y:h.item.y},v=h.path;if(v.matrix)t=svgedit.math.transformPoint(t.x,t.y,v.matrix);t.x*=i.getCurrentZoom();t.y*=i.getCurrentZoom();return t};svgedit.path.getPointFromGrip=function(h,u){var t={x:h.x,y:h.y};if(u.matrix){h=svgedit.math.transformPoint(t.x,t.y,u.imatrix);t.x=h.x;t.y=h.y}t.x/=i.getCurrentZoom();t.y/=
i.getCurrentZoom();return t};svgedit.path.addPointGrip=function(h,u,t){var v=svgedit.path.getGripContainer(),r=svgedit.utilities.getElem("pathpointgrip_"+h);if(!r){r=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(r,{id:"pathpointgrip_"+h,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":J.pathNodeTooltip});r=v.appendChild(r);$("#pathpointgrip_"+h).dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})}u&&
t&&svgedit.utilities.assignAttributes(r,{cx:u,cy:t,display:"inline"});return r};svgedit.path.getGripContainer=function(){var h=svgedit.utilities.getElem("pathpointgrip_container");if(!h){h=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS(a.SVG,"g"));h.id="pathpointgrip_container"}return h};svgedit.path.addCtrlGrip=function(h){var u=svgedit.utilities.getElem("ctrlpointgrip_"+h);if(u)return u;u=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(u,
{id:"ctrlpointgrip_"+h,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":J.pathCtrlPtTooltip});svgedit.path.getGripContainer().appendChild(u);return u};svgedit.path.getCtrlLine=function(h){var u=svgedit.utilities.getElem("ctrlLine_"+h);if(u)return u;u=document.createElementNS(a.SVG,"line");svgedit.utilities.assignAttributes(u,{id:"ctrlLine_"+h,stroke:"#555","stroke-width":1,style:"pointer-events:none"});svgedit.path.getGripContainer().appendChild(u);
return u};svgedit.path.getPointGrip=function(h,u){var t=svgedit.path.addPointGrip(h.index);if(u){var v=svgedit.path.getGripPt(h);svgedit.utilities.assignAttributes(t,{cx:v.x,cy:v.y,display:"inline"})}return t};svgedit.path.getControlPoints=function(h){var u=h.item,t=h.index;if(!("x1"in u)||!("x2"in u))return null;var v={};svgedit.path.getGripContainer();var r=[svgedit.path.path.segs[t-1].item,u],O;for(O=1;O<3;O++){var Z=t+"c"+O,ka=v["c"+O+"_line"]=svgedit.path.getCtrlLine(Z),ea=svgedit.path.getGripPt(h,
{x:u["x"+O],y:u["y"+O]}),ba=svgedit.path.getGripPt(h,{x:r[O-1].x,y:r[O-1].y});svgedit.utilities.assignAttributes(ka,{x1:ea.x,y1:ea.y,x2:ba.x,y2:ba.y,display:"inline"});v["c"+O+"_line"]=ka;Z=v["c"+O]=svgedit.path.addCtrlGrip(Z);svgedit.utilities.assignAttributes(Z,{cx:ea.x,cy:ea.y,display:"inline"});v["c"+O]=Z}return v};svgedit.path.replacePathSeg=function(h,u,t,v){v=v||svgedit.path.path.elem;h=v["createSVGPathSeg"+c[h]].apply(v,t);if(svgedit.browser.supportsPathReplaceItem())v.pathSegList.replaceItem(h,
u);else{t=v.pathSegList;v=t.numberOfItems;var r=[],O;for(O=0;O<v;O++){var Z=t.getItem(O);r.push(Z)}t.clear();for(O=0;O<v;O++)O==u?t.appendItem(h):t.appendItem(r[O])}};svgedit.path.getSegSelector=function(h,u){var t=h.index,v=svgedit.utilities.getElem("segline_"+t);if(!v){var r=svgedit.path.getGripContainer();v=document.createElementNS(a.SVG,"path");svgedit.utilities.assignAttributes(v,{id:"segline_"+t,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});
r.appendChild(v)}if(u){t=h.prev;if(!t){v.setAttribute("display","none");return v}t=svgedit.path.getGripPt(t);svgedit.path.replacePathSeg(2,0,[t.x,t.y],v);r=svgedit.path.ptObjToArr(h.type,h.item,true);var O;for(O=0;O<r.length;O+=2){t=svgedit.path.getGripPt(h,{x:r[O],y:r[O+1]});r[O]=t.x;r[O+1]=t.y}svgedit.path.replacePathSeg(h.type,1,r,v)}return v};svgedit.path.smoothControlPoints=function(h,u,t){var v=h.x-t.x,r=h.y-t.y,O=u.x-t.x,Z=u.y-t.y;if((v!=0||r!=0)&&(O!=0||Z!=0)){h=Math.atan2(r,v);u=Math.atan2(Z,
O);v=Math.sqrt(v*v+r*r);O=Math.sqrt(O*O+Z*Z);r=i.getSVGRoot().createSVGPoint();Z=i.getSVGRoot().createSVGPoint();if(h<0)h+=2*Math.PI;if(u<0)u+=2*Math.PI;var ka=Math.abs(h-u),ea=Math.abs(Math.PI-ka)/2;if(h-u>0){h=ka<Math.PI?h+ea:h-ea;u=ka<Math.PI?u-ea:u+ea}else{h=ka<Math.PI?h-ea:h+ea;u=ka<Math.PI?u+ea:u-ea}r.x=v*Math.cos(h)+t.x;r.y=v*Math.sin(h)+t.y;Z.x=O*Math.cos(u)+t.x;Z.y=O*Math.sin(u)+t.y;return[r,Z]}};svgedit.path.Segment=function(h,u){this.selected=false;this.index=h;this.item=u;this.type=u.pathSegType;
this.ctrlpts=[];this.segsel=this.ptgrip=null};svgedit.path.Segment.prototype.showCtrlPts=function(h){for(var u in this.ctrlpts)if(this.ctrlpts.hasOwnProperty(u))this.ctrlpts[u].setAttribute("display",h?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(h){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",h?"#0FF":"#EEE")};svgedit.path.Segment.prototype.show=function(h){if(this.ptgrip){this.ptgrip.setAttribute("display",h?"inline":"none");this.segsel.setAttribute("display",
h?"inline":"none");this.showCtrlPts(h)}};svgedit.path.Segment.prototype.select=function(h){if(this.ptgrip){this.ptgrip.setAttribute("stroke",h?"#0FF":"#00F");this.segsel.setAttribute("display",h?"inline":"none");this.ctrlpts&&this.selectCtrls(h);this.selected=h}};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,true);this.ctrlpts=svgedit.path.getControlPoints(this,true);this.segsel=svgedit.path.getSegSelector(this,true)};svgedit.path.Segment.prototype.update=
function(h){if(this.ptgrip){var u=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,{cx:u.x,cy:u.y});svgedit.path.getSegSelector(this,true);if(this.ctrlpts){if(h){this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.type=this.item.pathSegType}svgedit.path.getControlPoints(this)}}};svgedit.path.Segment.prototype.move=function(h,u){var t;t=this.item;t=this.ctrlpts?[t.x+=h,t.y+=u,t.x1,t.y1,t.x2+=h,t.y2+=u]:[t.x+=h,t.y+=u];svgedit.path.replacePathSeg(this.type,
this.index,t);if(this.next&&this.next.ctrlpts){t=this.next.item;t=[t.x,t.y,t.x1+=h,t.y1+=u,t.x2,t.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,t)}if(this.mate){t=this.mate.item;t=[t.x+=h,t.y+=u];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,t)}this.update(true);this.next&&this.next.update(true)};svgedit.path.Segment.prototype.setLinked=function(h){var u,t,v;if(h==2){t=1;u=this.next;if(!u)return;v=this.item}else{t=2;u=this.prev;if(!u)return;v=u.item}var r=u.item;r["x"+
t]=v.x+(v.x-this.item["x"+h]);r["y"+t]=v.y+(v.y-this.item["y"+h]);svgedit.path.replacePathSeg(u.type,u.index,[r.x,r.y,r.x1,r.y1,r.x2,r.y2]);u.update(true)};svgedit.path.Segment.prototype.moveCtrl=function(h,u,t){var v=this.item;v["x"+h]+=u;v["y"+h]+=t;svgedit.path.replacePathSeg(this.type,this.index,[v.x,v.y,v.x1,v.y1,v.x2,v.y2]);this.update(true)};svgedit.path.Segment.prototype.setType=function(h,u){svgedit.path.replacePathSeg(h,this.index,u);this.type=h;this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);
this.showCtrlPts(h===6);this.ctrlpts=svgedit.path.getControlPoints(this);this.update(true)};svgedit.path.Path=function(h){if(!h||h.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=h;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").attr("display","none");var h=this.elem.pathSegList,u=h.numberOfItems;this.segs=[];this.selected_pts=[];this.first_seg=null;
var t;for(t=0;t<u;t++){var v=h.getItem(t);v=new svgedit.path.Segment(t,v);v.path=this;this.segs.push(v)}h=this.segs;v=null;for(t=0;t<u;t++){var r=h[t],O=t+1>=u?null:h[t+1],Z=t-1<0?null:h[t-1];if(r.type===2){if(Z&&Z.type!==1){O=h[v];O.next=h[v+1];O.next.prev=O;O.addGrip()}v=t}else if(O&&O.type===1){r.next=h[v+1];r.next.prev=r;r.mate=h[v];r.addGrip();if(this.first_seg==null)this.first_seg=r}else if(O){if(r.type!==1){r.addGrip();if(O&&O.type!==2){r.next=O;r.next.prev=r}}}else if(r.type!==1){O=h[v];O.next=
h[v+1];O.next.prev=O;O.addGrip();r.addGrip();if(!this.first_seg)this.first_seg=h[v]}}return this};svgedit.path.Path.prototype.eachSeg=function(h){var u,t=this.segs.length;for(u=0;u<t;u++)if(h.call(this.segs[u],u)===false)break};svgedit.path.Path.prototype.addSeg=function(h){var u=this.segs[h];if(u.prev){var t=u.prev,v,r,O;switch(u.item.pathSegType){case 4:r=(u.item.x+t.item.x)/2;O=(u.item.y+t.item.y)/2;v=this.elem.createSVGPathSegLinetoAbs(r,O);break;case 6:v=(t.item.x+u.item.x1)/2;var Z=(u.item.x1+
u.item.x2)/2,ka=(u.item.x2+u.item.x)/2,ea=(v+Z)/2;Z=(Z+ka)/2;r=(ea+Z)/2;var ba=(t.item.y+u.item.y1)/2,ia=(u.item.y1+u.item.y2)/2;t=(u.item.y2+u.item.y)/2;var Pa=(ba+ia)/2;ia=(ia+t)/2;O=(Pa+ia)/2;v=this.elem.createSVGPathSegCurvetoCubicAbs(r,O,v,ba,ea,Pa);svgedit.path.replacePathSeg(u.type,h,[u.item.x,u.item.y,Z,ia,ka,t])}svgedit.path.insertItemBefore(this.elem,v,h)}};svgedit.path.Path.prototype.deleteSeg=function(h){var u=this.segs[h],t=this.elem.pathSegList;u.show(false);var v=u.next,r;if(u.mate){r=
[v.item.x,v.item.y];svgedit.path.replacePathSeg(2,v.index,r);svgedit.path.replacePathSeg(4,u.index,r);t.removeItem(u.mate.index)}else{if(!u.prev){r=[v.item.x,v.item.y];svgedit.path.replacePathSeg(2,u.next.index,r)}t.removeItem(h)}};svgedit.path.Path.prototype.subpathIsClosed=function(h){var u=false;svgedit.path.path.eachSeg(function(t){if(t<=h)return true;if(this.type===2)return false;if(this.type===1){u=true;return false}});return u};svgedit.path.Path.prototype.removePtFromSelection=function(h){var u=
this.selected_pts.indexOf(h);if(u!=-1){this.segs[h].select(false);this.selected_pts.splice(u,1)}};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(false)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(h){this.eachSeg(function(){this.show(h)});h&&this.selectPt(this.first_seg.index);return this};svgedit.path.Path.prototype.movePts=function(h,u){for(var t=
this.selected_pts.length;t--;)this.segs[this.selected_pts[t]].move(h,u)};svgedit.path.Path.prototype.moveCtrl=function(h,u){var t=this.segs[this.selected_pts[0]];t.moveCtrl(this.dragctrl,h,u);f&&t.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(h){this.storeD();for(var u=this.selected_pts.length,t;u--;){var v=this.segs[this.selected_pts[u]],r=v.prev;if(r){if(!h){t="Toggle Path Segment Type";h=v.type==6?4:6}h=Number(h);var O=v.item.x,Z=v.item.y,ka=r.item.x;r=r.item.y;var ea;
switch(h){case 6:if(v.olditem){ka=v.olditem;ea=[O,Z,ka.x1,ka.y1,ka.x2,ka.y2]}else{ea=O-ka;var ba=Z-r;ea=[O,Z,ka+ea/3,r+ba/3,O-ea/3,Z-ba/3]}break;case 4:ea=[O,Z];v.olditem=v.item}v.setType(h,ea)}}svgedit.path.path.endChanges(t)};svgedit.path.Path.prototype.selectPt=function(h,u){this.clearSelection();h==null&&this.eachSeg(function(t){if(this.prev)h=t});this.addPtsToSelection(h);if(u){this.dragctrl=u;f&&this.segs[h].setLinked(u)}};svgedit.path.Path.prototype.update=function(){var h=this.elem;if(svgedit.utilities.getRotationAngle(h)){this.matrix=
svgedit.math.getMatrix(h);this.imatrix=this.matrix.inverse()}else this.imatrix=this.matrix=null;this.eachSeg(function(u){this.item=h.pathSegList.getItem(u);this.update()});return this};svgedit.path.getPath_=function(h){var u=n[h.id];u||(u=n[h.id]=new svgedit.path.Path(h));return u};svgedit.path.removePath_=function(h){h in n&&delete n[h]};var m,k,z,s,E,A=function(h,u){var t=h-z,v=u-s,r=Math.sqrt(t*t+v*v);v=Math.atan2(v,t)+E;t=r*Math.cos(v)+z;v=r*Math.sin(v)+s;t-=m;v-=k;r=Math.sqrt(t*t+v*v);v=Math.atan2(v,
t)-E;return{x:r*Math.cos(v)+m,y:r*Math.sin(v)+k}};svgedit.path.recalcRotatedPath=function(){var h=svgedit.path.path.elem;if(E=svgedit.utilities.getRotationAngle(h,true)){var u=svgedit.utilities.getBBox(h),t=svgedit.path.path.oldbbox;z=t.x+t.width/2;s=t.y+t.height/2;m=u.x+u.width/2;k=u.y+u.height/2;t=m-z;var v=k-s;u=Math.sqrt(t*t+v*v);t=Math.atan2(v,t)+E;m=u*Math.cos(t)+z;k=u*Math.sin(t)+s;u=h.pathSegList;for(t=u.numberOfItems;t;){t-=1;var r=u.getItem(t);v=r.pathSegType;if(v!=1){var O=A(r.x,r.y);O=
[O.x,O.y];if(r.x1!=null&&r.x2!=null){var Z=A(r.x1,r.y1);r=A(r.x2,r.y2);O.splice(O.length,0,Z.x,Z.y,r.x,r.y)}svgedit.path.replacePathSeg(v,t,O)}}svgedit.utilities.getBBox(h);u=svgroot.createSVGTransform();h=svgedit.transformlist.getTransformList(h);u.setRotate(E*180/Math.PI,m,k);h.replaceItem(u,0)}};svgedit.path.clearData=function(){n={}}})();(function(){if(!window.console){window.console={};window.console.log=function(){};window.console.dir=function(){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(){}}})();
$.SvgCanvas=function(a,J){function p(){xa();var b=[],e={feGaussianBlur:qb.exportNoBlur,foreignObject:qb.exportNoforeignObject,"[stroke-dasharray]":qb.exportNoDashArray},d=$(s);if(!("font"in $("<canvas>")[0].getContext("2d")))e.text=qb.exportNoText;$.each(e,function(q,j){d.find(q).length&&b.push(j)});return b}function c(b,e){var d,q=svgedit.utilities.getBBox(b);for(d=0;d<2;d++){var j=d===0?"fill":"stroke",C=b.getAttribute(j);if(C&&C.indexOf("url(")===0){C=svgedit.utilities.getRefElem(C);if(C.tagName===
"linearGradient"){var o=C.getAttribute("x1")||0,w=C.getAttribute("y1")||0,B=C.getAttribute("x2")||1,H=C.getAttribute("y2")||0;o=q.width*o+q.x;w=q.height*w+q.y;B=q.width*B+q.x;H=q.height*H+q.y;o=svgedit.math.transformPoint(o,w,e);H=svgedit.math.transformPoint(B,H,e);B={};B.x1=(o.x-q.x)/q.width;B.y1=(o.y-q.y)/q.height;B.x2=(H.x-q.x)/q.width;B.y2=(H.y-q.y)/q.height;C=C.cloneNode(true);$(C).attr(B);C.id=Ha();svgedit.utilities.findDefs().appendChild(C);b.setAttribute(j,"url(#"+C.id+")")}}}}var f=svgedit.NS,
n={show_outside_canvas:true,selectNew:true,dimensions:[640,480]};J&&$.extend(n,J);var i=n.dimensions,m=this,k=a.ownerDocument,z=k.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+f.SVG+'" xlinkns="'+f.XLINK+'" width="'+i[0]+'" height="'+i[1]+'" x="'+i[0]+'" y="'+i[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,
true);a.appendChild(z);var s=k.createElementNS(f.SVG,"svg");(m.clearSvgContentElement=function(){for(;s.firstChild;)s.removeChild(s.firstChild);$(s).attr({id:"svgcontent",width:i[0],height:i[1],x:i[0],y:i[1],overflow:n.show_outside_canvas?"visible":"hidden",xmlns:f.SVG,"xmlns:se":f.SE,"xmlns:xlink":f.XLINK}).appendTo(z);var b=k.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");s.appendChild(b)})();var E="svg_";m.setIdPrefix=function(b){E=b};m.current_drawing_=new svgedit.draw.Drawing(s,
E);var A=m.getCurrentDrawing=function(){return m.current_drawing_},h=1,u=null,t={shape:{fill:(n.initFill.color=="none"?"":"#")+n.initFill.color,fill_paint:null,fill_opacity:n.initFill.opacity,stroke:"#"+n.initStroke.color,stroke_paint:null,stroke_opacity:n.initStroke.opacity,stroke_width:n.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:n.initOpacity}};t.text=$.extend(true,{},t.shape);$.extend(t.text,{fill:"#000000",stroke_width:0,font_size:24,font_family:"serif"});
var v=t.shape,r=Array(1),O=this.addSvgElementFromJson=function(b){var e=svgedit.utilities.getElem(b.attr.id),d=A().getCurrentLayer();if(e&&b.element!=e.tagName){d.removeChild(e);e=null}if(!e){e=k.createElementNS(f.SVG,b.element);if(d)(u||d).appendChild(e)}b.curStyles&&svgedit.utilities.assignAttributes(e,{fill:v.fill,stroke:v.stroke,"stroke-width":v.stroke_width,"stroke-dasharray":v.stroke_dasharray,"stroke-linejoin":v.stroke_linejoin,"stroke-linecap":v.stroke_linecap,"stroke-opacity":v.stroke_opacity,
"fill-opacity":v.fill_opacity,opacity:v.opacity/2,style:"pointer-events:inherit"},100);svgedit.utilities.assignAttributes(e,b.attr,100);svgedit.utilities.cleanupElement(e);return e};m.getTransformList=svgedit.transformlist.getTransformList;var Z=svgedit.math.transformPoint,ka=m.matrixMultiply=svgedit.math.matrixMultiply,ea=m.hasMatrixTransform=svgedit.math.hasMatrixTransform,ba=m.transformListToTransform=svgedit.math.transformListToTransform;svgedit.units.init({getBaseUnit:function(){return n.baseUnit},
getElement:svgedit.utilities.getElem,getHeight:function(){return s.getAttribute("height")/h},getWidth:function(){return s.getAttribute("width")/h},getRoundDigits:function(){return Xa.round_digits}});m.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return k},getDOMContainer:function(){return a},getSVGRoot:function(){return z},getSelectedElements:function(){return r},getSVGContent:function(){return s},getBaseUnit:function(){return n.baseUnit},getSnappingStep:function(){return n.snappingStep}});
var ia=m.findDefs=svgedit.utilities.findDefs,Pa=m.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,Ca=m.getHref=svgedit.utilities.getHref,eb=m.setHref=svgedit.utilities.setHref,Hb=svgedit.utilities.getPathBBox;m.getBBox=svgedit.utilities.getBBox;m.getRotationAngle=svgedit.utilities.getRotationAngle;var mb=m.getElem=svgedit.utilities.getElem;m.getRefElem=svgedit.utilities.getRefElem;var db=m.assignAttributes=svgedit.utilities.assignAttributes,ua=this.cleanupElement=svgedit.utilities.cleanupElement;
svgedit.coords.init({getDrawing:function(){return A()},getGridSnapping:function(){return n.gridSnapping}});var Sb=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return z},getStartTransform:function(){return nb},setStartTransform:function(b){nb=b}});var Ib=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,bb=svgedit.getReverseNS(),Jb=m.sanitizeSvg=svgedit.sanitize.sanitizeSvg,yb=svgedit.history.MoveElementCommand,cb=svgedit.history.InsertElementCommand,
Ua=svgedit.history.RemoveElementCommand,ib=svgedit.history.ChangeElementCommand,Xb=svgedit.history.BatchCommand,W;m.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(b,e){var d=svgedit.history.HistoryEventTypes;if(b==d.BEFORE_UNAPPLY||b==d.BEFORE_APPLY)m.clearSelection();else if(b==d.AFTER_APPLY||b==d.AFTER_UNAPPLY){var q=e.elements();m.pathActions.clear();W("changed",q);q=e.type();d=b==d.AFTER_APPLY;if(q==yb.type())(d?e.newParent:e.oldParent)==s&&m.identifyLayers();else if(q==
cb.type()||q==Ua.type()){e.parent==s&&m.identifyLayers();if(q==cb.type())d&&Na(e.elem);else d||Na(e.elem);e.elem.tagName==="use"&&zb(e.elem)}else if(q==ib.type()){e.elem.tagName=="title"&&e.elem.parentNode.parentNode==s&&m.identifyLayers();d=d?e.newValues:e.oldValues;d.stdDeviation&&m.setBlurOffsets(e.elem.parentNode,d.stdDeviation)}}}});var pa=function(b){m.undoMgr.addCommandToHistory(b)};svgedit.select.init(n,{createSVGElement:function(b){return m.addSvgElementFromJson(b)},svgRoot:function(){return z},
svgContent:function(){return s},currentZoom:function(){return h},getStrokedBBox:function(b){return m.getStrokedBBox([b])}});var qa=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return h},getSVGRoot:function(){return z}});var qb={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},
Tb=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],rb=$.data,Ab=document.createElementNS(f.SVG,"animate");$(Ab).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(z);var Na=function(b){var e,d=$(b).attr(Tb);for(e in d){var q=d[e];if(q&&q.indexOf("url(")===0){q=svgedit.utilities.getUrlFromAttr(q).substr(1);if(!mb(q)){svgedit.utilities.findDefs().appendChild(Bb[q]);delete Bb[q]}}}d=b.getElementsByTagName("*");if(d.length){b=0;for(e=
d.length;b<e;b++)Na(d[b])}},jb={},na=n.imgPath+"logo.png",Qa=[],Xa={round_digits:5},Ba=false,nb=null,va="select",kb="none",lb={},Va=t.text,ya=v,Kb=null,Da=null,hb=[],La={},Cb=null,Bb={};m.clipBoard=[];var tb=this.runExtensions=function(b,e,d){var q=d?[]:false;$.each(La,function(j,C){if(C&&b in C)if(d)q.push(C[b](e));else q=C[b](e)});return q};this.addExtension=function(b,e){var d;if(b in La)console.log('Cannot add extension "'+b+'", an extension by that name already exists.');else{d=$.isFunction(e)?
e($.extend(m.getPrivateMethods(),{svgroot:z,svgcontent:s,nonce:A().getNonce(),selectorManager:qa})):e;La[b]=d;W("extension_added",d)}};var Ya=this.round=function(b){return parseInt(b*h,10)/h},ub=this.getIntersectionList=function(b){if(Da==null)return null;var e=u||A().getCurrentLayer();hb.length||(hb=Ub(e));var d=null;try{d=e.getIntersectionList(b,null)}catch(q){}if(d==null||typeof d.item!="function"){d=[];if(b)b=b;else{b=Da.getBBox();var j;e={};for(j in b)e[j]=b[j]/h;b=e}for(j=hb.length;j--;)b.width&&
svgedit.math.rectsIntersect(b,hb[j].bbox)&&d.push(hb[j].elem)}return d};getStrokedBBox=this.getStrokedBBox=function(b){b||(b=Ta());if(!b.length)return false;var e=function(H){try{var K=svgedit.utilities.getBBox(H),D=svgedit.utilities.getRotationAngle(H);if(D&&D%90||svgedit.math.hasMatrixTransform(svgedit.transformlist.getTransformList(H))){D=false;if(["ellipse","path","line","polyline","polygon"].indexOf(H.tagName)>=0)K=D=m.convertToPath(H,true);else if(H.tagName=="rect"){var N=H.getAttribute("rx"),
S=H.getAttribute("ry");if(N||S)K=D=m.convertToPath(H,true)}if(!D){var U=H.cloneNode(true),X=document.createElementNS(f.SVG,"g"),da=H.parentNode;da.appendChild(X);X.appendChild(U);K=svgedit.utilities.bboxToObj(X.getBBox());da.removeChild(X)}}return K}catch(R){console.log(H,R);return null}},d;$.each(b,function(){if(!d)if(this.parentNode)d=e(this)});if(d==null)return null;var q=d.x+d.width,j=d.y+d.height,C=d.x,o=d.y,w=function(H){var K=H.getAttribute("stroke-width"),D=0;if(H.getAttribute("stroke")!=
"none"&&!isNaN(K))D+=K/2;return D},B=[];$.each(b,function(H,K){var D=e(K);if(D){var N=w(K);C=Math.min(C,D.x-N);o=Math.min(o,D.y-N);B.push(D)}});d.x=C;d.y=o;$.each(b,function(H,K){var D=B[H];if(D&&K.nodeType==1){var N=w(K);q=Math.max(q,D.x+D.width+N);j=Math.max(j,D.y+D.height+N)}});d.width=q-C;d.height=j-o;return d};var Ta=this.getVisibleElements=function(b){b||(b=$(s).children());var e=[];$(b).children().each(function(d,q){try{q.getBBox()&&e.push(q)}catch(j){}});return e.reverse()},Ub=this.getVisibleElementsAndBBoxes=
function(b){b||(b=$(s).children());var e=[];$(b).children().each(function(d,q){try{q.getBBox()&&e.push({elem:q,bbox:getStrokedBBox([q])})}catch(j){}});return e.reverse()},Lb=this.groupSvgElem=function(b){var e=document.createElementNS(f.SVG,"g");b.parentNode.replaceChild(e,b);$(e).append(b).data("gsvg",b)[0].id=Ha()},ob=function(b){var e=document.createElementNS(b.namespaceURI,b.nodeName);$.each(b.attributes,function(q,j){j.localName!="-moz-math-font-style"&&e.setAttributeNS(j.namespaceURI,j.nodeName,
j.value)});e.removeAttribute("id");e.id=Ha();if(svgedit.browser.isWebkit()&&b.nodeName=="path"){var d=ra.convertPath(b);e.setAttribute("d",d)}$.each(b.childNodes,function(q,j){switch(j.nodeType){case 1:e.appendChild(ob(j));break;case 3:e.textContent=j.nodeValue}});if($(b).data("gsvg"))$(e).data("gsvg",e.firstChild);else if($(b).data("symbol")){b=$(b).data("symbol");$(e).data("ref",b).data("symbol",b)}else e.tagName=="image"&&vb(e);return e},Za,Ha,Ka,ra;(function(b){var e={};Za=b.getId=function(){return A().getId()};
Ha=b.getNextId=function(){return A().getNextId()};W=b.call=function(d,q){if(e[d])return e[d](this,q)};b.bind=function(d,q){var j=e[d];e[d]=q;return j}})(m);this.prepareSvg=function(b){this.sanitizeSvg(b.documentElement);var e,d,q=b.getElementsByTagNameNS(f.SVG,"path");b=0;for(d=q.length;b<d;++b){e=q[b];e.setAttribute("d",ra.convertPath(e));ra.fixEnd(e)}};var Db=function(b){if(!svgedit.browser.isGecko())return b;var e=b.cloneNode(true);b.parentNode.insertBefore(e,b);b.parentNode.removeChild(b);qa.releaseSelector(b);
r[0]=e;qa.requestSelector(e).showGrips(true);return e};this.setRotationAngle=function(b,e){b=parseFloat(b);var d=r[0],q=d.getAttribute("transform"),j=svgedit.utilities.getBBox(d),C=j.x+j.width/2,o=j.y+j.height/2;j=svgedit.transformlist.getTransformList(d);j.numberOfItems>0&&j.getItem(0).type==4&&j.removeItem(0);if(b!=0){C=svgedit.math.transformPoint(C,o,svgedit.math.transformListToTransform(j).matrix);o=z.createSVGTransform();o.setRotate(b,C.x,C.y);j.numberOfItems?j.insertItemBefore(o,0):j.appendItem(o)}else j.numberOfItems==
0&&d.removeAttribute("transform");if(!e){j=d.getAttribute("transform");d.setAttribute("transform",q);Ma("transform",j,r);W("changed",r)}svgedit.utilities.getElem("pathpointgrip_container");d=qa.requestSelector(r[0]);d.resize();d.updateGripCursors(b)};var Mb=this.recalculateAllSelectedDimensions=function(){for(var b=new svgedit.history.BatchCommand(kb=="none"?"position":"size"),e=r.length;e--;){var d=svgedit.recalculate.recalculateDimensions(r[e]);d&&b.addSubCommand(d)}if(!b.isEmpty()){pa(b);W("changed",
r)}},gc=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],Yb=function(b){console.log([b.a,b.b,b.c,b.d,b.e,b.f])},fb=null,xa=this.clearSelection=function(b){if(r[0]!=null){var e,d,q=r.length;for(e=0;e<q;++e){d=r[e];if(d==null)break;qa.releaseSelector(d);r[e]=null}}b||W("selected",r)},gb=this.addToSelection=function(b,e){if(b.length!=0){for(var d=0;d<r.length;){if(r[d]==null)break;++d}for(var q=b.length;q--;){var j=b[q];if(j&&svgedit.utilities.getBBox(j)){if(j.tagName===
"a"&&j.childNodes.length===1)j=j.firstChild;if(r.indexOf(j)==-1){r[d]=j;d++;j=qa.requestSelector(j);r.length>1&&j.showGrips(false)}}}W("selected",r);e||r.length==1?qa.requestSelector(r[0]).showGrips(true):qa.requestSelector(r[0]).showGrips(false);for(r.sort(function(C,o){if(C&&o&&C.compareDocumentPosition)return 3-(o.compareDocumentPosition(C)&6);if(C==null)return 1});r[0]==null;)r.shift(0)}},$a=this.selectOnly=function(b,e){xa(true);gb(b,e)};this.removeFromSelection=function(b){if(r[0]!=null)if(b.length!=
0){var e,d=0,q=[],j=r.length;q.length=j;for(e=0;e<j;++e){var C=r[e];if(C)if(b.indexOf(C)==-1){q[d]=C;d++}else qa.releaseSelector(C)}r=q}};this.selectAllInCurrentLayer=function(){var b=A().getCurrentLayer();if(b){va="select";$a($(u||b).children())}};var Eb=this.getMouseTarget=function(b){if(b==null)return null;b=b.target;if(b.correspondingUseElement)b=b.correspondingUseElement;if([f.MATH,f.HTML].indexOf(b.namespaceURI)>=0&&b.id!="svgcanvas")for(;b.nodeName!="foreignObject";){b=b.parentNode;if(!b)return z}var e=
A().getCurrentLayer();if([z,a,s,e].indexOf(b)>=0)return z;if($(b).closest("#selectorParentGroup").length)return qa.selectorParentGroup;for(;b.parentNode!==(u||e);)b=b.parentNode;return b};(function(){var b=null,e=null,d=null,q=null,j=null,C={},o={minx:null,miny:null,maxx:null,maxy:null},w=0,B={x:0,y:0},H={x:0,y:0},K={x:0,y:0},D={x:0,y:0},N,S,U={x:0,y:0},X={x:0,y:0},da=function(R){var L={x:0,y:0},I=B,M=H,Q=K,aa=D,ga=1/6,oa=R*R,za=oa*R,ca=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];L.x=ga*((I.x*ca[0][0]+
M.x*ca[0][1]+Q.x*ca[0][2]+aa.x*ca[0][3])*za+(I.x*ca[1][0]+M.x*ca[1][1]+Q.x*ca[1][2]+aa.x*ca[1][3])*oa+(I.x*ca[2][0]+M.x*ca[2][1]+Q.x*ca[2][2]+aa.x*ca[2][3])*R+(I.x*ca[3][0]+M.x*ca[3][1]+Q.x*ca[3][2]+aa.x*ca[3][3]));L.y=ga*((I.y*ca[0][0]+M.y*ca[0][1]+Q.y*ca[0][2]+aa.y*ca[0][3])*za+(I.y*ca[1][0]+M.y*ca[1][1]+Q.y*ca[1][2]+aa.y*ca[1][3])*oa+(I.y*ca[2][0]+M.y*ca[2][1]+Q.y*ca[2][2]+aa.y*ca[2][3])*R+(I.y*ca[3][0]+M.y*ca[3][1]+Q.y*ca[3][2]+aa.y*ca[3][3]));return{x:L.x,y:L.y}};$(a).mousedown(function(R){if(!(m.spaceKey||
R.button===1)){var L=R.button===2;R.altKey&&svgCanvas.cloneSelectedElements(0,0);fb=$("#svgcontent g")[0].getScreenCTM().inverse();var I=svgedit.math.transformPoint(R.pageX,R.pageY,fb),M=I.x*h,Q=I.y*h;R.preventDefault();if(L){va="select";Cb=I}I=M/h;Q=Q/h;var aa=Eb(R);if(aa.tagName==="a"&&aa.childNodes.length===1)aa=aa.firstChild;q=e=M=I;var ga=Q;j=d=Q;if(n.gridSnapping){I=svgedit.utilities.snapToGrid(I);Q=svgedit.utilities.snapToGrid(Q);e=svgedit.utilities.snapToGrid(e);d=svgedit.utilities.snapToGrid(d)}if(aa==
qa.selectorParentGroup&&r[0]!=null){aa=R.target;var oa=rb(aa,"type");if(oa=="rotate")va="rotate";else if(oa=="resize"){va="resize";kb=rb(aa,"dir")}aa=r[0]}nb=aa.getAttribute("transform");var za;oa=svgedit.transformlist.getTransformList(aa);switch(va){case "select":Ba=true;kb="none";if(L)Ba=false;if(aa!=z){if(r.indexOf(aa)==-1){R.shiftKey||xa(true);gb([aa]);Kb=aa;ra.clear()}if(!L)for(L=0;L<r.length;++L)if(r[L]!=null){za=svgedit.transformlist.getTransformList(r[L]);za.numberOfItems?za.insertItemBefore(z.createSVGTransform(),
0):za.appendItem(z.createSVGTransform())}}else if(!L){xa();va="multiselect";if(Da==null)Da=qa.getRubberBandBox();q*=h;j*=h;svgedit.utilities.assignAttributes(Da,{x:q,y:j,width:0,height:0,display:"inline"},100)}break;case "zoom":Ba=true;if(Da==null)Da=qa.getRubberBandBox();svgedit.utilities.assignAttributes(Da,{x:M*h,y:M*h,width:0,height:0,display:"inline"},100);break;case "resize":Ba=true;e=I;d=Q;C=svgedit.utilities.getBBox($("#selectedBox0")[0]);var ca={};$.each(C,function(ta,Aa){ca[ta]=Aa/h});C=
ca;L=svgedit.utilities.getRotationAngle(aa)?1:0;if(svgedit.math.hasMatrixTransform(oa)){oa.insertItemBefore(z.createSVGTransform(),L);oa.insertItemBefore(z.createSVGTransform(),L);oa.insertItemBefore(z.createSVGTransform(),L)}else{oa.appendItem(z.createSVGTransform());oa.appendItem(z.createSVGTransform());oa.appendItem(z.createSVGTransform());if(svgedit.browser.supportsNonScalingStroke()){if(I=svgedit.browser.isWebkit())za=function(ta){var Aa=ta.getAttributeNS(null,"stroke");ta.removeAttributeNS(null,
"stroke");setTimeout(function(){ta.setAttributeNS(null,"stroke",Aa)},0)};aa.style.vectorEffect="non-scaling-stroke";I&&za(aa);Q=aa.getElementsByTagName("*");M=Q.length;for(L=0;L<M;L++){Q[L].style.vectorEffect="non-scaling-stroke";I&&za(Q[L])}}}break;case "fhellipse":case "fhrect":case "fhpath":K.x=M;K.y=ga;Ba=true;b=M+","+ga+" ";za=v.stroke_width==0?1:v.stroke_width;O({element:"polyline",curStyles:true,attr:{points:b,id:Ha(),fill:"none",opacity:v.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});
o.minx=M;o.maxx=M;o.miny=ga;o.maxy=ga;break;case "image":Ba=true;za=O({element:"image",attr:{x:I,y:Q,width:0,height:0,id:Ha(),opacity:v.opacity/2,style:"pointer-events:inherit"}});eb(za,na);vb(za);break;case "square":case "rect":Ba=true;e=I;d=Q;O({element:"rect",curStyles:true,attr:{x:I,y:Q,width:0,height:0,id:Ha(),opacity:v.opacity/2}});break;case "line":Ba=true;za=v.stroke_width==0?1:v.stroke_width;O({element:"line",curStyles:true,attr:{x1:I,y1:Q,x2:I,y2:Q,id:Ha(),stroke:v.stroke,"stroke-width":za,
"stroke-dasharray":v.stroke_dasharray,"stroke-linejoin":v.stroke_linejoin,"stroke-linecap":v.stroke_linecap,"stroke-opacity":v.stroke_opacity,fill:"none",opacity:v.opacity/2,style:"pointer-events:none"}});break;case "circle":Ba=true;O({element:"circle",curStyles:true,attr:{cx:I,cy:Q,r:0,id:Ha(),opacity:v.opacity/2}});break;case "ellipse":Ba=true;O({element:"ellipse",curStyles:true,attr:{cx:I,cy:Q,rx:0,ry:0,id:Ha(),opacity:v.opacity/2}});break;case "text":Ba=true;O({element:"text",curStyles:true,attr:{x:I,
y:Q,id:Ha(),fill:Va.fill,"stroke-width":Va.stroke_width,"font-size":Va.font_size,"font-family":Va.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:v.opacity}});break;case "path":case "pathedit":e*=h;d*=h;ra.mouseDown(R,aa,e,d);Ba=true;break;case "textedit":e*=h;d*=h;Ka.mouseDown(R,aa,e,d);Ba=true;break;case "rotate":Ba=true;m.undoMgr.beginUndoableChange("transform",r)}R=tb("mouseDown",{event:R,start_x:e,start_y:d,selectedElements:r},true);$.each(R,function(ta,Aa){if(Aa&&Aa.started)Ba=
true})}}).mousemove(function(R){if(Ba)if(!(R.button===1||m.spaceKey)){var L,I,M,Q,aa,ga=r[0],oa=svgedit.math.transformPoint(R.pageX,R.pageY,fb),za=oa.x*h;oa=oa.y*h;var ca=svgedit.utilities.getElem(Za());x=I=za/h;y=Q=oa/h;if(n.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}R.preventDefault();switch(va){case "select":if(r[0]!==null){I=x-e;M=y-d;if(n.gridSnapping){I=svgedit.utilities.snapToGrid(I);M=svgedit.utilities.snapToGrid(M)}if(R.shiftKey){L=svgedit.math.snapToAngle(e,
d,x,y);x=L.x;y=L.y}if(I!=0||M!=0){Q=r.length;for(L=0;L<Q;++L){ga=r[L];if(ga==null)break;var ta=z.createSVGTransform();ca=svgedit.transformlist.getTransformList(ga);ta.setTranslate(I,M);ca.numberOfItems?ca.replaceItem(ta,0):ca.appendItem(ta);qa.requestSelector(ga).resize()}W("transition",r)}}break;case "multiselect":I*=h;Q*=h;svgedit.utilities.assignAttributes(Da,{x:Math.min(q,I),y:Math.min(j,Q),width:Math.abs(I-q),height:Math.abs(Q-j)},100);ca=[];I=[];ta=ub();Q=r.length;for(L=0;L<Q;++L){M=ta.indexOf(r[L]);
if(M==-1)ca.push(r[L]);else ta[M]=null}Q=ta.length;for(L=0;L<Q;++L)ta[L]&&I.push(ta[L]);ca.length>0&&m.removeFromSelection(ca);I.length>0&&gb(I);break;case "resize":ca=svgedit.transformlist.getTransformList(ga);M=(L=svgedit.math.hasMatrixTransform(ca))?C:svgedit.utilities.getBBox(ga);Q=M.x;ta=M.y;var Aa=M.width,ab=M.height;I=x-e;M=y-d;if(n.gridSnapping){I=svgedit.utilities.snapToGrid(I);M=svgedit.utilities.snapToGrid(M);ab=svgedit.utilities.snapToGrid(ab);Aa=svgedit.utilities.snapToGrid(Aa)}if(aa=
svgedit.utilities.getRotationAngle(ga)){var pb=Math.sqrt(I*I+M*M);M=Math.atan2(M,I)-aa*Math.PI/180;I=pb*Math.cos(M);M=pb*Math.sin(M)}if(kb.indexOf("n")==-1&&kb.indexOf("s")==-1)M=0;if(kb.indexOf("e")==-1&&kb.indexOf("w")==-1)I=0;var Fb=pb=0,Nb=ab?(ab+M)/ab:1,Gb=Aa?(Aa+I)/Aa:1;if(kb.indexOf("n")>=0){Nb=ab?(ab-M)/ab:1;Fb=ab}if(kb.indexOf("w")>=0){Gb=Aa?(Aa-I)/Aa:1;pb=Aa}I=z.createSVGTransform();M=z.createSVGTransform();Aa=z.createSVGTransform();if(n.gridSnapping){Q=svgedit.utilities.snapToGrid(Q);pb=
svgedit.utilities.snapToGrid(pb);ta=svgedit.utilities.snapToGrid(ta);Fb=svgedit.utilities.snapToGrid(Fb)}I.setTranslate(-(Q+pb),-(ta+Fb));if(R.shiftKey)if(Gb==1)Gb=Nb;else Nb=Gb;M.setScale(Gb,Nb);Aa.setTranslate(Q+pb,ta+Fb);if(L){L=aa?1:0;ca.replaceItem(I,2+L);ca.replaceItem(M,1+L);ca.replaceItem(Aa,Number(L))}else{L=ca.numberOfItems;ca.replaceItem(Aa,L-3);ca.replaceItem(M,L-2);ca.replaceItem(I,L-1)}qa.requestSelector(ga).resize();W("transition",r);break;case "zoom":I*=h;Q*=h;svgedit.utilities.assignAttributes(Da,
{x:Math.min(q*h,I),y:Math.min(j*h,Q),width:Math.abs(I-q*h),height:Math.abs(Q-j*h)},100);break;case "text":svgedit.utilities.assignAttributes(ca,{x:x,y:y},1E3);break;case "line":Q=null;window.opera||z.suspendRedraw(1E3);if(n.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}I=x;L=y;if(R.shiftKey){L=svgedit.math.snapToAngle(e,d,I,L);I=L.x;L=L.y}ca.setAttributeNS(null,"x2",I);ca.setAttributeNS(null,"y2",L);window.opera||z.unsuspendRedraw(Q);break;case "foreignObject":case "square":case "rect":case "image":I=
Math.abs(x-e);L=Math.abs(y-d);if(va=="square"||R.shiftKey){I=L=Math.max(I,L);Q=e<x?e:e-I;ta=d<y?d:d-L}else{Q=Math.min(e,x);ta=Math.min(d,y)}if(n.gridSnapping){I=svgedit.utilities.snapToGrid(I);L=svgedit.utilities.snapToGrid(L);Q=svgedit.utilities.snapToGrid(Q);ta=svgedit.utilities.snapToGrid(ta)}svgedit.utilities.assignAttributes(ca,{width:I,height:L,x:Q,y:ta},1E3);break;case "circle":L=$(ca).attr(["cx","cy"]);I=L.cx;L=L.cy;I=Math.sqrt((x-I)*(x-I)+(y-L)*(y-L));if(n.gridSnapping)I=svgedit.utilities.snapToGrid(I);
ca.setAttributeNS(null,"r",I);break;case "ellipse":L=$(ca).attr(["cx","cy"]);I=L.cx;L=L.cy;Q=null;window.opera||z.suspendRedraw(1E3);if(n.gridSnapping){x=svgedit.utilities.snapToGrid(x);I=svgedit.utilities.snapToGrid(I);y=svgedit.utilities.snapToGrid(y);L=svgedit.utilities.snapToGrid(L)}ca.setAttributeNS(null,"rx",Math.abs(x-I));ca.setAttributeNS(null,"ry",Math.abs(R.shiftKey?x-I:y-L));window.opera||z.unsuspendRedraw(Q);break;case "fhellipse":case "fhrect":o.minx=Math.min(I,o.minx);o.maxx=Math.max(I,
o.maxx);o.miny=Math.min(Q,o.miny);o.maxy=Math.max(Q,o.maxy);case "fhpath":D.x=I;D.y=Q;if(B.x&&B.y)for(L=0;L<9;L++){N=L/10;S=(L+1)/10;X=U=da(S);U=da(N);w+=Math.sqrt((X.x-U.x)*(X.x-U.x)+(X.y-U.y)*(X.y-U.y));if(w>0.8){b+=+U.x+","+U.y+" ";ca.setAttributeNS(null,"points",b);w-=0.8}}B={x:H.x,y:H.y};H={x:K.x,y:K.y};K={x:D.x,y:D.y};break;case "path":case "pathedit":x*=h;y*=h;if(n.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y);e=svgedit.utilities.snapToGrid(e);d=svgedit.utilities.snapToGrid(d)}if(R.shiftKey){if(L=
svgedit.path.path){ca=L.dragging?L.dragging[0]:e;L=L.dragging?L.dragging[1]:d}else{ca=e;L=d}L=svgedit.math.snapToAngle(ca,L,x,y);x=L.x;y=L.y}if(Da&&Da.getAttribute("display")!=="none"){I*=h;Q*=h;svgedit.utilities.assignAttributes(Da,{x:Math.min(q*h,I),y:Math.min(j*h,Q),width:Math.abs(I-q*h),height:Math.abs(Q-j*h)},100)}ra.mouseMove(x,y);break;case "textedit":x*=h;y*=h;Ka.mouseMove(za,oa);break;case "rotate":M=svgedit.utilities.getBBox(ga);I=M.x+M.width/2;L=M.y+M.height/2;ca=svgedit.math.getMatrix(ga);
ca=svgedit.math.transformPoint(I,L,ca);I=ca.x;L=ca.y;aa=(Math.atan2(L-y,I-x)*(180/Math.PI)-90)%360;if(n.gridSnapping)aa=svgedit.utilities.snapToGrid(aa);if(R.shiftKey)aa=Math.round(aa/45)*45;m.setRotationAngle(aa<-180?360+aa:aa,true);W("transition",r)}tb("mouseMove",{event:R,mouse_x:za,mouse_y:oa,selected:ga})}}).click(function(R){R.preventDefault();return false}).dblclick(function(R){var L=R.target.parentNode;if(L!==u){var I=Eb(R),M=I.tagName;if(M==="text"&&va!=="textedit"){R=svgedit.math.transformPoint(R.pageX,
R.pageY,fb);Ka.select(I,R.x,R.y)}if((M==="g"||M==="a")&&svgedit.utilities.getRotationAngle(I)){Vb(I);I=r[0];xa(true)}u&&Ob();L.tagName!=="g"&&L.tagName!=="a"||L===A().getCurrentLayer()||I===qa.selectorParentGroup||hc(I)}}).mouseup(function(R){if(R.button!==2){var L=Kb;Kb=null;if(Ba){var I=svgedit.math.transformPoint(R.pageX,R.pageY,fb),M=I.x*h;I=I.y*h;var Q=M/h,aa=I/h,ga=svgedit.utilities.getElem(Za()),oa=false;Ba=false;switch(va){case "resize":case "multiselect":if(Da!=null){Da.setAttribute("display",
"none");hb=[]}va="select";case "select":if(r[0]!=null){if(r[1]==null){M=r[0];switch(M.tagName){case "g":case "use":case "image":case "foreignObject":break;default:ya.fill=M.getAttribute("fill");ya.fill_opacity=M.getAttribute("fill-opacity");ya.stroke=M.getAttribute("stroke");ya.stroke_opacity=M.getAttribute("stroke-opacity");ya.stroke_width=M.getAttribute("stroke-width");ya.stroke_dasharray=M.getAttribute("stroke-dasharray");ya.stroke_linejoin=M.getAttribute("stroke-linejoin");ya.stroke_linecap=M.getAttribute("stroke-linecap")}if(M.tagName==
"text"){Va.font_size=M.getAttribute("font-size");Va.font_family=M.getAttribute("font-family")}qa.requestSelector(M).showGrips(true)}Mb();if(Q!=q||aa!=j){M=r.length;for(R=0;R<M;++R){if(r[R]==null)break;r[R].firstChild||qa.requestSelector(r[R]).resize()}}else{M=R.target;if(r[0].nodeName==="path"&&r[1]==null)ra.select(r[0]);else R.shiftKey&&L!=M&&m.removeFromSelection([M])}if(svgedit.browser.supportsNonScalingStroke())if(R=r[0]){R.removeAttribute("style");svgedit.utilities.walkTree(R,function(ta){ta.removeAttribute("style")})}}return;
case "zoom":Da!=null&&Da.setAttribute("display","none");W("zoomed",{x:Math.min(q,Q),y:Math.min(j,aa),width:Math.abs(Q-q),height:Math.abs(aa-j),factor:R.shiftKey?0.5:2});return;case "fhpath":w=0;B={x:0,y:0};H={x:0,y:0};K={x:0,y:0};D={x:0,y:0};L=ga.getAttribute("points");Q=L.indexOf(",");if(oa=Q>=0?L.indexOf(",",Q+1)>=0:L.indexOf(" ",L.indexOf(" ")+1)>=0)ga=ra.smoothPolylineIntoPath(ga);break;case "line":L=$(ga).attr(["x1","x2","y1","y2"]);oa=L.x1!=L.x2||L.y1!=L.y2;break;case "foreignObject":case "square":case "rect":case "image":L=
$(ga).attr(["width","height"]);oa=L.width!=0||L.height!=0||va==="image";break;case "circle":oa=ga.getAttribute("r")!=0;break;case "ellipse":L=$(ga).attr(["rx","ry"]);oa=L.rx!=null||L.ry!=null;break;case "fhellipse":if(o.maxx-o.minx>0&&o.maxy-o.miny>0){ga=O({element:"ellipse",curStyles:true,attr:{cx:(o.minx+o.maxx)/2,cy:(o.miny+o.maxy)/2,rx:(o.maxx-o.minx)/2,ry:(o.maxy-o.miny)/2,id:Za()}});W("changed",[ga]);oa=true}break;case "fhrect":if(o.maxx-o.minx>0&&o.maxy-o.miny>0){ga=O({element:"rect",curStyles:true,
attr:{x:o.minx,y:o.miny,width:o.maxx-o.minx,height:o.maxy-o.miny,id:Za()}});W("changed",[ga]);oa=true}break;case "text":oa=true;$a([ga]);Ka.start(ga);break;case "path":ga=null;Ba=true;L=ra.mouseUp(R,ga,M,I);ga=L.element;oa=L.keep;break;case "pathedit":oa=true;ga=null;ra.mouseUp(R);break;case "textedit":oa=false;ga=null;Ka.mouseUp(R,M,I);break;case "rotate":oa=true;ga=null;va="select";L=m.undoMgr.finishUndoableChange();L.isEmpty()||pa(L);Mb();W("changed",r)}M=tb("mouseUp",{event:R,mouse_x:M,mouse_y:I},
true);$.each(M,function(ta,Aa){if(Aa){oa=Aa.keep||oa;ga=Aa.element;Ba=Aa.started||Ba}});if(!oa&&ga!=null){A().releaseId(Za());ga.parentNode.removeChild(ga);ga=null;for(M=R.target;M.parentNode.parentNode.tagName=="g";)M=M.parentNode;if((va!="path"||!drawn_path)&&M.parentNode.id!="selectorParentGroup"&&M.id!="svgcanvas"&&M.id!="svgroot"){m.setMode("select");$a([M],true)}}else if(ga!=null){m.addedNew=true;R=0.2;var za;if(Ab.beginElement&&ga.getAttribute("opacity")!=v.opacity){za=$(Ab).clone().attr({to:v.opacity,
dur:R}).appendTo(ga);try{za[0].beginElement()}catch(ca){}}else R=0;setTimeout(function(){za&&za.remove();ga.setAttribute("opacity",v.opacity);ga.setAttribute("style","pointer-events:inherit");ua(ga);if(va==="path")ra.toEditMode(ga);else n.selectNew&&$a([ga],true);pa(new svgedit.history.InsertElementCommand(ga));W("changed",[ga])},R*1E3)}nb=null}}});$(a).bind("mousewheel DOMMouseScroll",function(R){R.preventDefault();R=R.originalEvent;fb=$("#svgcontent g")[0].getScreenCTM().inverse();var L=svgedit.math.transformPoint(R.pageX,
R.pageY,fb);L={x:L.x,y:L.y,width:0,height:0};if(R=R.wheelDelta?R.wheelDelta:R.detail?-R.detail:0){L.factor=Math.max(0.75,Math.min(4/3,R));W("zoomed",L)}})})();var vb=function(b){$(b).click(function(e){e.preventDefault()})};Ka=m.textActions=function(){function b(I){var M=H.value==="";$(H).focus();if(!arguments.length)if(M)I=0;else{if(H.selectionEnd!==H.selectionStart)return;I=H.selectionEnd}var Q;Q=S[I];M||H.setSelectionRange(I,I);K=svgedit.utilities.getElem("text_cursor");if(!K){K=document.createElementNS(f.SVG,
"line");svgedit.utilities.assignAttributes(K,{id:"text_cursor",stroke:"#333","stroke-width":1});K=svgedit.utilities.getElem("selectorParentGroup").appendChild(K)}N||(N=setInterval(function(){var aa=K.getAttribute("display")==="none";K.setAttribute("display",aa?"inline":"none")},600));M=C(Q.x,U.y);Q=C(Q.x,U.y+U.height);svgedit.utilities.assignAttributes(K,{x1:M.x,y1:M.y,x2:Q.x,y2:Q.y,visibility:"visible",display:"inline"});D&&D.setAttribute("d","")}function e(I,M,Q){if(I===M)b(M);else{Q||H.setSelectionRange(I,
M);D=svgedit.utilities.getElem("text_selectblock");if(!D){D=document.createElementNS(f.SVG,"path");svgedit.utilities.assignAttributes(D,{id:"text_selectblock",fill:"green",opacity:0.5,style:"pointer-events:none"});svgedit.utilities.getElem("selectorParentGroup").appendChild(D)}I=S[I];var aa=S[M];K.setAttribute("visibility","hidden");M=C(I.x,U.y);Q=C(I.x+(aa.x-I.x),U.y);var ga=C(I.x,U.y+U.height);I=C(I.x+(aa.x-I.x),U.y+U.height);svgedit.utilities.assignAttributes(D,{d:"M"+M.x+","+M.y+" L"+Q.x+","+
Q.y+" "+I.x+","+I.y+" "+ga.x+","+ga.y+"z",display:"inline"})}}function d(I,M){var Q=z.createSVGPoint();Q.x=I;Q.y=M;if(S.length==1)return 0;Q=B.getCharNumAtPosition(Q);if(Q<0){Q=S.length-2;if(I<=S[0].x)Q=0}else if(Q>=S.length-2)Q=S.length-2;var aa=S[Q];I>aa.x+aa.width/2&&Q++;return Q}function q(I,M,Q){var aa=H.selectionStart;I=d(I,M);e(Math.min(aa,I),Math.max(aa,I),!Q)}function j(I,M){var Q={x:I,y:M};Q.x/=h;Q.y/=h;if(X){var aa=svgedit.math.transformPoint(Q.x,Q.y,X.inverse());Q.x=aa.x;Q.y=aa.y}return Q}
function C(I,M){var Q={x:I,y:M};if(X){var aa=svgedit.math.transformPoint(Q.x,Q.y,X);Q.x=aa.x;Q.y=aa.y}Q.x*=h;Q.y*=h;return Q}function o(I){e(0,B.textContent.length);$(this).unbind(I)}function w(I){if(L&&B){var M=svgedit.math.transformPoint(I.pageX,I.pageY,fb);M=j(M.x*h,M.y*h);M=d(M.x,M.y);var Q=B.textContent,aa=Q.substr(0,M).replace(/[a-z0-9]+$/i,"").length;Q=Q.substr(M).match(/^[a-z0-9]+/i);e(aa,(Q?Q[0].length:0)+M);$(I.target).click(o);setTimeout(function(){$(I.target).unbind("click",o)},300)}}
var B,H,K,D,N,S=[],U,X,da,R,L;return{select:function(I,M,Q){B=I;Ka.toEditMode(M,Q)},start:function(I){B=I;Ka.toEditMode()},mouseDown:function(I,M,Q,aa){I=j(Q,aa);H.focus();b(d(I.x,I.y));da=Q;R=aa},mouseMove:function(I,M){var Q=j(I,M);q(Q.x,Q.y)},mouseUp:function(I,M,Q){var aa=j(M,Q);q(aa.x,aa.y,true);I.target!==B&&M<da+2&&M>da-2&&Q<R+2&&Q>R-2&&Ka.toSelectMode(true)},setCursor:b,toEditMode:function(I,M){L=false;va="textedit";qa.requestSelector(B).showGrips(false);qa.requestSelector(B);Ka.init();$(B).css("cursor",
"text");if(arguments.length){var Q=j(I,M);b(d(Q.x,Q.y))}else b();setTimeout(function(){L=true},300)},toSelectMode:function(I){va="select";clearInterval(N);N=null;D&&$(D).attr("display","none");K&&$(K).attr("visibility","hidden");$(B).css("cursor","move");if(I){xa();$(B).css("cursor","move");W("selected",[B]);gb([B],true)}B&&!B.textContent.length&&m.deleteSelectedElements();$(H).blur();B=false},setInputElem:function(I){H=I},clear:function(){va=="textedit"&&Ka.toSelectMode()},init:function(){if(B){var I,
M;if(!B.parentNode){B=r[0];qa.requestSelector(B).showGrips(false)}var Q=B.textContent.length;I=B.getAttribute("transform");U=svgedit.utilities.getBBox(B);X=I?svgedit.math.getMatrix(B):null;S=[];S.length=Q;H.focus();$(B).unbind("dblclick",w).dblclick(w);Q||(M={x:U.x+U.width/2,width:0});for(I=0;I<Q;I++){var aa=B.getStartPositionOfChar(I);M=B.getEndPositionOfChar(I);if(!svgedit.browser.supportsGoodTextCharPos()){var ga=m.contentW*h;aa.x-=ga;M.x-=ga;aa.x/=h;M.x/=h}S[I]={x:aa.x,y:U.y,width:M.x-aa.x,height:U.height}}S.push({x:M.x,
width:0});e(H.selectionStart,H.selectionEnd,true)}}}}();ra=m.pathActions=function(){var b=false,e,d,q;svgedit.path.Path.prototype.endChanges=function(o){if(svgedit.browser.isWebkit()){var w=this.elem;w.setAttribute("d",ra.convertPath(w))}o=new svgedit.history.ChangeElementCommand(this.elem,{d:this.last_d},o);pa(o);W("changed",[this.elem])};svgedit.path.Path.prototype.addPtsToSelection=function(o){var w,B;$.isArray(o)||(o=[o]);for(w=0;w<o.length;w++){var H=o[w];B=this.segs[H];B.ptgrip&&this.selected_pts.indexOf(H)==
-1&&H>=0&&this.selected_pts.push(H)}this.selected_pts.sort();w=this.selected_pts.length;o=[];for(o.length=w;w--;){B=this.segs[this.selected_pts[w]];B.select(true);o[w]=B.ptgrip}ra.canDeleteNodes=true;ra.closed_subpath=this.subpathIsClosed(this.selected_pts[0]);W("selected",o)};var j=e=null,C=false;return{mouseDown:function(o,w,B,H){var K;if(va==="path"){mouse_x=B;mouse_y=H;H=mouse_x/h;w=mouse_y/h;B=svgedit.utilities.getElem("path_stretch_line");d=[H,w];if(n.gridSnapping){H=svgedit.utilities.snapToGrid(H);
w=svgedit.utilities.snapToGrid(w);mouse_x=svgedit.utilities.snapToGrid(mouse_x);mouse_y=svgedit.utilities.snapToGrid(mouse_y)}if(!B){B=document.createElementNS(f.SVG,"path");svgedit.utilities.assignAttributes(B,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"});B=svgedit.utilities.getElem("selectorParentGroup").appendChild(B)}B.setAttribute("display","inline");var D=null;if(j){D=j.pathSegList;var N=D.numberOfItems;K=6/h;for(var S=false;N;){N--;var U=D.getItem(N),X=U.x;U=U.y;
if(H>=X-K&&H<=X+K&&w>=U-K&&w<=U+K){S=true;break}}K=Za();svgedit.path.removePath_(K);K=svgedit.utilities.getElem(K);X=D.numberOfItems;if(S){if(N<=1&&X>=2){H=D.getItem(0).x;w=D.getItem(0).y;o=B.pathSegList.getItem(1);o=o.pathSegType===4?j.createSVGPathSegLinetoAbs(H,w):j.createSVGPathSegCurvetoCubicAbs(H,w,o.x1/h,o.y1/h,H,w);H=j.createSVGPathSegClosePath();D.appendItem(o);D.appendItem(H)}else if(X<3)return D=false;$(B).remove();element=K;j=null;Ba=false;if(b){svgedit.path.path.matrix&&svgedit.coords.remapElement(K,
{},svgedit.path.path.matrix.inverse());B=K.getAttribute("d");o=$(svgedit.path.path.elem).attr("d");$(svgedit.path.path.elem).attr("d",o+B);$(K).remove();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();svgedit.path.path.init();ra.toEditMode(svgedit.path.path.elem);svgedit.path.path.selectPt();return false}}else{if(!$.contains(a,Eb(o))){console.log("Clicked outside canvas");return false}D=j.pathSegList.numberOfItems;N=j.pathSegList.getItem(D-1);K=N.x;N=N.y;if(o.shiftKey){o=svgedit.math.snapToAngle(K,
N,H,w);H=o.x;w=o.y}o=B.pathSegList.getItem(1);o=o.pathSegType===4?j.createSVGPathSegLinetoAbs(Ya(H),Ya(w)):j.createSVGPathSegCurvetoCubicAbs(Ya(H),Ya(w),o.x1/h,o.y1/h,o.x2/h,o.y2/h);j.pathSegList.appendItem(o);H*=h;w*=h;B.setAttribute("d",["M",H,w,H,w].join(" "));B=D;if(b)B+=svgedit.path.path.segs.length;svgedit.path.addPointGrip(B,H,w)}}else{d_attr="M"+H+","+w+" ";j=O({element:"path",curStyles:true,attr:{d:d_attr,id:Ha(),opacity:v.opacity/2}});B.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" "));
B=b?svgedit.path.path.segs.length:0;svgedit.path.addPointGrip(B,mouse_x,mouse_y)}}else if(svgedit.path.path){svgedit.path.path.storeD();K=o.target.id;if(K.substr(0,14)=="pathpointgrip_"){w=svgedit.path.path.cur_pt=parseInt(K.substr(14));svgedit.path.path.dragging=[B,H];D=svgedit.path.path.segs[w];if(o.shiftKey)D.selected?svgedit.path.path.removePtFromSelection(w):svgedit.path.path.addPtsToSelection(w);else{if(svgedit.path.path.selected_pts.length<=1||!D.selected)svgedit.path.path.clearSelection();
svgedit.path.path.addPtsToSelection(w)}}else if(K.indexOf("ctrlpointgrip_")==0){svgedit.path.path.dragging=[B,H];o=K.split("_")[1].split("c");w=Number(o[0]);svgedit.path.path.selectPt(w,Number(o[1]))}if(!svgedit.path.path.dragging){if(Da==null)Da=qa.getRubberBandBox();svgedit.utilities.assignAttributes(Da,{x:B*h,y:H*h,width:0,height:0,display:"inline"},100)}}},mouseMove:function(o,w){C=true;if(va==="path"){if(j){var B=j.pathSegList,H=B.numberOfItems-1;if(d){var K=svgedit.path.addCtrlGrip("1c1"),D=
svgedit.path.addCtrlGrip("0c2");K.setAttribute("cx",o);K.setAttribute("cy",w);K.setAttribute("display","inline");K=d[0];var N=d[1];B.getItem(H);var S=K+(K-o/h),U=N+(N-w/h);D.setAttribute("cx",S*h);D.setAttribute("cy",U*h);D.setAttribute("display","inline");D=svgedit.path.getCtrlLine(1);svgedit.utilities.assignAttributes(D,{x1:o,y1:w,x2:S*h,y2:U*h,display:"inline"});if(H===0)q=[o,w];else{B=B.getItem(H-1);D=B.x;var X=B.y;if(B.pathSegType===6){D+=D-B.x2;X+=X-B.y2}else if(q){D=q[0]/h;X=q[1]/h}svgedit.path.replacePathSeg(6,
H,[K,N,D,X,S,U],j)}}else if(K=svgedit.utilities.getElem("path_stretch_line")){H=B.getItem(H);if(H.pathSegType===6)svgedit.path.replacePathSeg(6,1,[o,w,(H.x+(H.x-H.x2))*h,(H.y+(H.y-H.y2))*h,o,w],K);else q?svgedit.path.replacePathSeg(6,1,[o,w,q[0],q[1],o,w],K):svgedit.path.replacePathSeg(4,1,[o,w],K)}}}else if(svgedit.path.path.dragging){K=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path);N=svgedit.path.getPointFromGrip({x:o,y:w},svgedit.path.path);
H=N.x-K.x;K=N.y-K.y;svgedit.path.path.dragging=[o,w];svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(H,K):svgedit.path.path.movePts(H,K)}else{svgedit.path.path.selected_pts=[];svgedit.path.path.eachSeg(function(){if(this.next||this.prev){var da=Da.getBBox(),R=svgedit.path.getGripPt(this);da=svgedit.math.rectsIntersect(da,{x:R.x,y:R.y,width:0,height:0});this.select(da);da&&svgedit.path.path.selected_pts.push(this.index)}})}},mouseUp:function(o,w){if(va==="path"){d=null;if(!j){w=svgedit.utilities.getElem(Za());
Ba=false;q=null}return{keep:true,element:w}}if(svgedit.path.path.dragging){var B=svgedit.path.path.cur_pt;svgedit.path.path.dragging=false;svgedit.path.path.dragctrl=false;svgedit.path.path.update();C&&svgedit.path.path.endChanges("Move path point(s)");!o.shiftKey&&!C&&svgedit.path.path.selectPt(B)}else if(Da&&Da.getAttribute("display")!="none"){Da.setAttribute("display","none");Da.getAttribute("width")<=2&&Da.getAttribute("height")<=2&&ra.toSelectMode(o.target)}else ra.toSelectMode(o.target);C=false},
toEditMode:function(o){svgedit.path.path=svgedit.path.getPath_(o);va="pathedit";xa();svgedit.path.path.show(true).update();svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem);b=false},toSelectMode:function(o){var w=o==svgedit.path.path.elem;va="select";svgedit.path.path.show(false);e=false;xa();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();if(w){W("selected",[o]);gb([o],true)}},addSubPath:function(o){if(o){va="path";b=true}else{ra.clear(true);ra.toEditMode(svgedit.path.path.elem)}},
select:function(o){if(e===o){ra.toEditMode(o);va="pathedit"}else e=o},reorient:function(){var o=r[0];if(o)if(svgedit.utilities.getRotationAngle(o)!=0){var w=new svgedit.history.BatchCommand("Reorient path"),B={d:o.getAttribute("d"),transform:o.getAttribute("transform")};w.addSubCommand(new svgedit.history.ChangeElementCommand(o,B));xa();this.resetOrientation(o);pa(w);svgedit.path.getPath_(o).show(false).matrix=null;this.clear();gb([o],true);W("changed",r)}},clear:function(){e=null;if(j){var o=svgedit.utilities.getElem(Za());
$(svgedit.utilities.getElem("path_stretch_line")).remove();$(o).remove();$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none");j=q=null;Ba=false}else va=="pathedit"&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(false)},resetOrientation:function(o){if(o==null||o.nodeName!="path")return false;var w=svgedit.transformlist.getTransformList(o),B=svgedit.math.transformListToTransform(w).matrix;w.clear();o.removeAttribute("transform");w=o.pathSegList;
var H=w.numberOfItems,K;for(K=0;K<H;++K){var D=w.getItem(K),N=D.pathSegType;if(N!=1){var S=[];$.each(["",1,2],function(U,X){var da=D["x"+X],R=D["y"+X];if(da!==undefined&&R!==undefined){da=svgedit.math.transformPoint(da,R,B);S.splice(S.length,0,da.x,da.y)}});svgedit.path.replacePathSeg(N,K,S,o)}}c(o,B)},zoomChange:function(){va=="pathedit"&&svgedit.path.path.update()},getNodePoint:function(){var o=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1];return{x:o.item.x,
y:o.item.y,type:o.type}},linkControlPoints:function(o){svgedit.path.setLinkControlPoints(o)},clonePathNode:function(){svgedit.path.path.storeD();for(var o=svgedit.path.path.selected_pts,w=o.length,B=[];w--;){var H=o[w];svgedit.path.path.addSeg(H);B.push(H+w);B.push(H+w+1)}svgedit.path.path.init().addPtsToSelection(B);svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var o=svgedit.path.path.selected_pts;if(o.length===1){var w=svgedit.path.path.elem,B=w.pathSegList,H=o[0],
K=null,D=null;svgedit.path.path.eachSeg(function(X){if(this.type===2&&X<=H)D=this.item;if(X<=H)return true;if(this.type===2){K=X;return false}if(this.type===1)return K=false});if(K==null)K=svgedit.path.path.segs.length-1;if(K!==false){var N=w.createSVGPathSegLinetoAbs(D.x,D.y),S=w.createSVGPathSegClosePath();if(K==svgedit.path.path.segs.length-1){B.appendItem(N);B.appendItem(S)}else{svgedit.path.insertItemBefore(w,S,K);svgedit.path.insertItemBefore(w,N,K)}svgedit.path.path.init().selectPt(K+1)}else if(svgedit.path.path.segs[H].mate){B.removeItem(H);
B.removeItem(H);svgedit.path.path.init().selectPt(H-1)}else{for(o=0;o<B.numberOfItems;o++){var U=B.getItem(o);if(U.pathSegType===2)N=o;else if(o===H)B.removeItem(N);else if(U.pathSegType===1&&H<o){S=o-1;B.removeItem(o);break}}for(o=H-N-1;o--;)svgedit.path.insertItemBefore(w,B.getItem(N),S);w=B.getItem(N);svgedit.path.replacePathSeg(2,N,[w.x,w.y]);o=H;svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(ra.canDeleteNodes){svgedit.path.path.storeD();for(var o=svgedit.path.path.selected_pts,
w=o.length;w--;)svgedit.path.path.deleteSeg(o[w]);var B=function(){var H=svgedit.path.path.elem.pathSegList,K=H.numberOfItems,D=function(U,X){for(;X--;)H.removeItem(U)};if(K<=1)return true;for(;K--;){var N=H.getItem(K);if(N.pathSegType===1){N=H.getItem(K-1);var S=H.getItem(K-2);if(N.pathSegType===2){D(K-1,2);B();break}else if(S.pathSegType===2){D(K-2,3);B();break}}else if(N.pathSegType===2)if(K>0){N=H.getItem(K-1).pathSegType;if(N===2){D(K-1,1);B();break}else if(N===1&&H.numberOfItems-1===K){D(K,
1);B();break}}}return false};B();if(svgedit.path.path.elem.pathSegList.numberOfItems<=1){ra.toSelectMode(svgedit.path.path.elem);m.deleteSelectedElements()}else{svgedit.path.path.init();svgedit.path.path.clearSelection();if(window.opera){o=$(svgedit.path.path.elem);o.attr("d",o.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}}},smoothPolylineIntoPath:function(o){var w=o.points,B=w.numberOfItems;if(B>=4){var H=w.getItem(0),K=null,D=[];D.push(["M",H.x,",",H.y," C"].join(""));for(o=1;o<=
B-4;o+=3){var N=w.getItem(o),S=w.getItem(o+1),U=w.getItem(o+2);if(K)if((H=svgedit.path.smoothControlPoints(K,N,H))&&H.length==2){N=D[D.length-1].split(",");N[2]=H[0].x;N[3]=H[0].y;D[D.length-1]=N.join(",");N=H[1]}D.push([N.x,N.y,S.x,S.y,U.x,U.y].join(","));H=U;K=S}for(D.push("L");o<B;){S=w.getItem(o);D.push([S.x,S.y].join(","));o++}D=D.join(" ");o=O({element:"path",curStyles:true,attr:{id:Za(),d:D,fill:"none"}})}return o},setSegType:function(o){svgedit.path.path.setSegType(o)},moveNode:function(o,
w){var B=svgedit.path.path.selected_pts;if(B.length){svgedit.path.path.storeD();B=svgedit.path.path.segs[B[0]];var H={x:0,y:0};H[o]=w-B.item[o];B.move(H.x,H.y);svgedit.path.path.endChanges("Move path point")}},fixEnd:function(o){var w=o.pathSegList,B=w.numberOfItems,H,K;for(H=0;H<B;++H){var D=w.getItem(H);if(D.pathSegType===2)K=D;if(D.pathSegType===1){D=w.getItem(H-1);if(D.x!=K.x||D.y!=K.y){w=o.createSVGPathSegLinetoAbs(K.x,K.y);svgedit.path.insertItemBefore(o,w,H);ra.fixEnd(o);break}}}svgedit.browser.isWebkit()&&
o.setAttribute("d",ra.convertPath(o))},convertPath:function(o,w){var B,H=o.pathSegList,K=H.numberOfItems,D=0,N=0,S="",U=null;for(B=0;B<K;++B){var X=H.getItem(B),da=X.x||0,R=X.y||0,L=X.x1||0,I=X.y1||0,M=X.x2||0,Q=X.y2||0,aa=X.pathSegType,ga=gc[aa]["to"+(w?"Lower":"Upper")+"Case"](),oa=function(za,ca,ta){ca=ca?" "+ca.join(" "):"";ta=ta?" "+svgedit.units.shortFloat(ta):"";$.each(za,function(Aa,ab){za[Aa]=svgedit.units.shortFloat(ab)});S+=ga+za.join(" ")+ca+ta};switch(aa){case 1:S+="z";break;case 12:da-=
D;case 13:if(w){D+=da;ga="l"}else{da+=D;D=da;ga="L"}oa([[da,N]]);break;case 14:R-=N;case 15:if(w){N+=R;ga="l"}else{R+=N;N=R;ga="L"}oa([[D,R]]);break;case 2:case 4:case 18:da-=D;R-=N;case 5:case 3:if(U&&H.getItem(B-1).pathSegType===1&&!w){D=U[0];N=U[1]}case 19:if(w){D+=da;N+=R}else{da+=D;R+=N;D=da;N=R}if(aa===3)U=[D,N];oa([[da,R]]);break;case 6:da-=D;L-=D;M-=D;R-=N;I-=N;Q-=N;case 7:if(w){D+=da;N+=R}else{da+=D;L+=D;M+=D;R+=N;I+=N;Q+=N;D=da;N=R}oa([[L,I],[M,Q],[da,R]]);break;case 8:da-=D;L-=D;R-=N;I-=
N;case 9:if(w){D+=da;N+=R}else{da+=D;L+=D;R+=N;I+=N;D=da;N=R}oa([[L,I],[da,R]]);break;case 10:da-=D;R-=N;case 11:if(w){D+=da;N+=R}else{da+=D;R+=N;D=da;N=R}oa([[X.r1,X.r2]],[X.angle,X.largeArcFlag?1:0,X.sweepFlag?1:0],[da,R]);break;case 16:da-=D;M-=D;R-=N;Q-=N;case 17:if(w){D+=da;N+=R}else{da+=D;M+=D;R+=N;Q+=N;D=da;N=R}oa([[M,Q],[da,R]])}}return S}}}();var Pb=this.removeUnusedDefElems=function(){var b=s.getElementsByTagNameNS(f.SVG,"defs");if(!b||!b.length)return 0;var e=[],d=0,q=["fill","stroke",
"filter","marker-start","marker-mid","marker-end"],j=q.length,C=s.getElementsByTagNameNS(f.SVG,"*"),o=C.length,w,B;for(w=0;w<o;w++){var H=C[w];for(B=0;B<j;B++){var K=svgedit.utilities.getUrlFromAttr(H.getAttribute(q[B]));K&&e.push(K.substr(1))}(B=Ca(H))&&B.indexOf("#")===0&&e.push(B.substr(1))}b=$(b).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(w=b.length;w--;){q=b[w];j=q.id;if(e.indexOf(j)<0){Bb[j]=q;q.parentNode.removeChild(q);d++}}return d};this.svgCanvasToString=function(){for(;Pb()>
0;);ra.clear(true);$.each(s.childNodes,function(d,q){d&&q.nodeType===8&&q.data.indexOf("Created with")>=0&&s.insertBefore(q,s.firstChild)});if(u){Ob();$a([u])}var b=[];$(s).find("g:data(gsvg)").each(function(){var d=this.attributes,q=d.length,j;for(j=0;j<q;j++)if(d[j].nodeName=="id"||d[j].nodeName=="style")q--;if(q<=0){d=this.firstChild;b.push(d);$(this).replaceWith(d)}});var e=this.svgToString(s,0);b.length&&$(b).each(function(){Lb(this)});return e};this.svgToString=function(b,e){var d=[],q=svgedit.utilities.toXml,
j=n.baseUnit,C=RegExp("^-?[\\d\\.]+"+j+"$");if(b){ua(b);var o=b.attributes,w,B,H=b.childNodes;for(B=0;B<e;B++)d.push(" ");d.push("<");d.push(b.nodeName);if(b.id==="svgcontent"){B=sb();if(j!=="px"){B.w=svgedit.units.convertUnit(B.w,j)+j;B.h=svgedit.units.convertUnit(B.h,j)+j}d.push(' width="'+B.w+'" height="'+B.h+'" xmlns="'+f.SVG+'"');var K={};$(b).find("*").andSelf().each(function(){var U=this.namespaceURI;if(U&&!K[U]&&bb[U]&&bb[U]!=="xmlns"&&bb[U]!=="xml"){K[U]=true;d.push(" xmlns:"+bb[U]+'="'+
U+'"')}$.each(this.attributes,function(X,da){var R=da.namespaceURI;if(R&&!K[R]&&bb[R]!=="xmlns"&&bb[R]!=="xml"){K[R]=true;d.push(" xmlns:"+bb[R]+'="'+R+'"')}})});B=o.length;for(j=["width","height","xmlns","x","y","viewBox","id","overflow"];B--;){w=o.item(B);var D=q(w.value);if(w.nodeName.indexOf("xmlns:")!==0)if(D!=""&&j.indexOf(w.localName)==-1)if(!w.namespaceURI||bb[w.namespaceURI]){d.push(" ");d.push(w.nodeName);d.push('="');d.push(D);d.push('"')}}}else{if(b.nodeName==="defs"&&!b.firstChild)return;
var N=["-moz-math-font-style","_moz-math-font-style"];for(B=o.length-1;B>=0;B--){w=o.item(B);D=q(w.value);if(!(N.indexOf(w.localName)>=0))if(D!="")if(D.indexOf("pointer-events")!==0)if(!(w.localName==="class"&&D.indexOf("se_")===0)){d.push(" ");if(w.localName==="d")D=ra.convertPath(b,true);if(isNaN(D)){if(C.test(D))D=svgedit.units.shortFloat(D)+j}else D=svgedit.units.shortFloat(D);if(Xa.apply&&b.nodeName==="image"&&w.localName==="href"&&Xa.images&&Xa.images==="embed"){var S=jb[D];if(S)D=S}if(!w.namespaceURI||
w.namespaceURI==f.SVG||bb[w.namespaceURI]){d.push(w.nodeName);d.push('="');d.push(D);d.push('"')}}}}if(b.hasChildNodes()){d.push(">");e++;o=false;for(B=0;B<H.length;B++){j=H.item(B);switch(j.nodeType){case 1:d.push("\n");d.push(this.svgToString(H.item(B),e));break;case 3:j=j.nodeValue.replace(/^\s+|\s+$/g,"");if(j!=""){o=true;d.push(String(q(j)))}break;case 4:d.push("\n");d.push(Array(e+1).join(" "));d.push("<![CDATA[");d.push(j.nodeValue);d.push("]]\>");break;case 8:d.push("\n");d.push(Array(e+1).join(" "));
d.push("<!--");d.push(j.data);d.push("--\>")}}e--;if(!o){d.push("\n");for(B=0;B<e;B++)d.push(" ")}d.push("</");d.push(b.nodeName);d.push(">")}else d.push("/>")}return d.join("")};this.embedImage=function(b,e){$(new Image).load(function(){var d=document.createElement("canvas");d.width=this.width;d.height=this.height;d.getContext("2d").drawImage(this,0,0);try{var q=";svgedit_url="+encodeURIComponent(b);q=d.toDataURL().replace(";base64",q+";base64");jb[b]=q}catch(j){jb[b]=false}na=b;e&&e(jb[b])}).attr("src",
b)};this.setGoodImage=function(b){na=b};this.open=function(){};this.save=function(b){xa();b&&$.extend(Xa,b);Xa.apply=true;b=this.svgCanvasToString();W("saved",b)};this.rasterExport=function(b,e,d){var q="image/"+b.toLowerCase(),j=p(),C=this.svgCanvasToString();svgedit.utilities.buildCanvgCallback(function(){var o=b||"PNG";$("#export_canvas").length||$("<canvas>",{id:"export_canvas"}).hide().appendTo("body");var w=$("#export_canvas")[0];w.width=svgCanvas.contentW;w.height=svgCanvas.contentH;canvg(w,
C,{renderCallback:function(){var B=(o==="ICO"?"BMP":o).toLowerCase();B=e?w.toDataURL("image/"+B,e):w.toDataURL("image/"+B);W("exported",{datauri:B,svg:C,issues:j,type:b,mimeType:q,quality:e,exportWindowName:d})}})})()};this.exportPDF=function(b,e){var d=this;svgedit.utilities.buildJSPDFCallback(function(){var q=sb();q=jsPDF({orientation:q.w>q.h?"landscape":"portrait",unit:"pt",format:[q.w,q.h]});var j=ic();q.setProperties({title:j});j=p();var C=d.svgCanvasToString();q.addSVG(C,0,0);j={svg:C,issues:j,
exportWindowName:b};C=e||"dataurlstring";j[C]=q.output(C);W("exportedPDF",j)})()};this.getSvgString=function(){Xa.apply=false;return this.svgCanvasToString()};this.randomizeIds=function(b){arguments.length>0&&b==false?svgedit.draw.randomizeIds(false,A()):svgedit.draw.randomizeIds(true,A())};var Qb=this.uniquifyElems=function(b){var e={},d=["filter","linearGradient","pattern","radialGradient","symbol","textPath","use"];svgedit.utilities.walkTree(b,function(w){if(w.nodeType==1){if(w.id){w.id in e||
(e[w.id]={elem:null,attrs:[],hrefs:[]});e[w.id].elem=w}$.each(Tb,function(H,K){var D=w.getAttributeNode(K);if(D){var N=svgedit.utilities.getUrlFromAttr(D.value);if(N=N?N.substr(1):null){N in e||(e[N]={elem:null,attrs:[],hrefs:[]});e[N].attrs.push(D)}}});var B=svgedit.utilities.getHref(w);if(B&&d.indexOf(w.nodeName)>=0)if(B=B.substr(1)){B in e||(e[B]={elem:null,attrs:[],hrefs:[]});e[B].hrefs.push(w)}}});for(var q in e)if(q){var j=e[q].elem;if(j){b=Ha();j.id=b;j=e[q].attrs;for(var C=j.length;C--;){var o=
j[C];o.ownerElement.setAttribute(o.name,"url(#"+b+")")}j=e[q].hrefs;for(C=j.length;C--;)svgedit.utilities.setHref(j[C],"#"+b)}}},zb=this.setUseData=function(b){var e=$(b);if(b.tagName!=="use")e=e.find("use");e.each(function(){var d=Ca(this).substr(1);if(d=svgedit.utilities.getElem(d)){$(this).data("ref",d);if(d.tagName=="symbol"||d.tagName=="svg")$(this).data("symbol",d).data("ref",d)}})},Wb=this.convertGradients=function(b){var e=$(b).find("linearGradient, radialGradient");if(!e.length&&svgedit.browser.isWebkit())e=
$(b).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0});e.each(function(){if($(this).attr("gradientUnits")==="userSpaceOnUse"){var d=$(s).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(d.length)if(d=svgedit.utilities.getBBox(d[0]))if(this.tagName==="linearGradient"){var q=$(this).attr(["x1","y1","x2","y2"]),j=this.gradientTransform.baseVal;if(j&&j.numberOfItems>0){var C=svgedit.math.transformListToTransform(j).matrix;j=svgedit.math.transformPoint(q.x1,q.y1,
C);C=svgedit.math.transformPoint(q.x2,q.y2,C);q.x1=j.x;q.y1=j.y;q.x2=C.x;q.y2=C.y;this.removeAttribute("gradientTransform")}$(this).attr({x1:(q.x1-d.x)/d.width,y1:(q.y1-d.y)/d.height,x2:(q.x2-d.x)/d.width,y2:(q.y2-d.y)/d.height});this.removeAttribute("gradientUnits")}}})},Zb=this.convertToGroup=function(b){b||(b=r[0]);var e=$(b),d=new svgedit.history.BatchCommand,q;if(e.data("gsvg")){d=$(b.firstChild).attr(["x","y"]);$(b.firstChild.firstChild).unwrap();$(b).removeData("gsvg");q=svgedit.transformlist.getTransformList(b);
var j=z.createSVGTransform();j.setTranslate(d.x,d.y);q.appendItem(j);svgedit.recalculate.recalculateDimensions(b);W("selected",[b])}else if(e.data("symbol")){b=e.data("symbol");q=e.attr("transform");j=e.attr(["x","y"]);var C=b.getAttribute("viewBox");if(C){C=C.split(" ");j.x-=+C[0];j.y-=+C[1]}q+=" translate("+(j.x||0)+","+(j.y||0)+")";j=e.prev();d.addSubCommand(new svgedit.history.RemoveElementCommand(e[0],e[0].nextSibling,e[0].parentNode));e.remove();C=$(s).find("use:data(symbol)").length;e=k.createElementNS(f.SVG,
"g");var o=b.childNodes,w;for(w=0;w<o.length;w++)e.appendChild(o[w].cloneNode(true));if(svgedit.browser.isGecko()){o=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone();$(e).append(o)}q&&e.setAttribute("transform",q);q=b.parentNode;Qb(e);svgedit.browser.isGecko()&&$(ia()).append($(e).find("linearGradient,radialGradient,pattern"));e.id=Ha();j.after(e);if(q){if(!C){j=b.nextSibling;q.removeChild(b);d.addSubCommand(new svgedit.history.RemoveElementCommand(b,j,q))}d.addSubCommand(new svgedit.history.InsertElementCommand(e))}zb(e);
svgedit.browser.isGecko()?Wb(svgedit.utilities.findDefs()):Wb(e);svgedit.utilities.walkTreePost(e,function(B){try{svgedit.recalculate.recalculateDimensions(B)}catch(H){console.log(H)}});$(e).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=Ha()});$a([e]);(b=Vb(e,true))&&d.addSubCommand(b);pa(d)}else console.log("Unexpected element to ungroup:",b)};this.setSvgString=function(b){try{var e=svgedit.utilities.text2xml(b);
this.prepareSvg(e);var d=new svgedit.history.BatchCommand("Change Source"),q=s.nextSibling,j=z.removeChild(s);d.addSubCommand(new svgedit.history.RemoveElementCommand(j,q,z));s=k.adoptNode?k.adoptNode(e.documentElement):k.importNode(e.documentElement,true);z.appendChild(s);var C=$(s);m.current_drawing_=new svgedit.draw.Drawing(s,E);var o=A().getNonce();o?W("setnonce",o):W("unsetnonce");C.find("image").each(function(){var S=this;vb(S);var U=Ca(this);if(U){if(U.indexOf("data:")===0){var X=U.match(/svgedit_url=(.*?);/);
if(X){var da=decodeURIComponent(X[1]);$(new Image).load(function(){S.setAttributeNS(f.XLINK,"xlink:href",da)}).attr("src",da)}}m.embedImage(U)}});C.find("svg").each(function(){if(!$(this).closest("defs").length){Qb(this);var S=this.parentNode;if(S.childNodes.length===1&&S.nodeName==="g"){$(S).data("gsvg",this);S.id=S.id||Ha()}else Lb(this)}});svgedit.browser.isGecko()&&C.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs());zb(C);Wb(C[0]);svgedit.utilities.walkTreePost(s,
function(S){try{svgedit.recalculate.recalculateDimensions(S)}catch(U){console.log(U)}});var w={id:"svgcontent",overflow:n.show_outside_canvas?"visible":"hidden"},B=false;if(C.attr("viewBox")){var H=C.attr("viewBox").split(" ");w.width=H[2];w.height=H[3]}else $.each(["width","height"],function(S,U){var X=C.attr(U);X||(X="100%");if(String(X).substr(-1)==="%")B=true;else w[U]=svgedit.units.convertToNum(U,X)});wb();C.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=
Ha()});if(B){var K=getStrokedBBox();w.width=K.width+K.x;w.height=K.height+K.y}if(w.width<=0)w.width=100;if(w.height<=0)w.height=100;C.attr(w);this.contentW=w.width;this.contentH=w.height;d.addSubCommand(new svgedit.history.InsertElementCommand(s));var D=C.attr(["width","height"]);d.addSubCommand(new svgedit.history.ChangeElementCommand(z,D));h=1;svgedit.transformlist.resetListMap();xa();svgedit.path.clearData();z.appendChild(qa.selectorParentGroup);pa(d);W("changed",[s])}catch(N){console.log(N);return false}return true};
this.importSvgString=function(b){var e,d;try{var q=svgedit.utilities.encode64(b.length+b).substr(0,32),j=false;if(lb[q])if($(lb[q].symbol).parents("#svgroot").length)j=true;var C=new svgedit.history.BatchCommand("Import Image"),o;if(j){o=lb[q].symbol;d=lb[q].xform}else{var w=svgedit.utilities.text2xml(b);this.prepareSvg(w);var B;B=k.adoptNode?k.adoptNode(w.documentElement):k.importNode(w.documentElement,true);Qb(B);var H=svgedit.units.convertToNum("width",B.getAttribute("width")),K=svgedit.units.convertToNum("height",
B.getAttribute("height")),D=B.getAttribute("viewBox"),N=D?D.split(" "):[0,0,H,K];for(e=0;e<4;++e)N[e]=+N[e];s.getAttribute("width");var S=+s.getAttribute("height");d=K>H?"scale("+S/3/N[3]+")":"scale("+S/3/N[2]+")";d="translate(0) "+d+" translate(0)";o=k.createElementNS(f.SVG,"symbol");var U=svgedit.utilities.findDefs();for(svgedit.browser.isGecko()&&$(B).find("linearGradient, radialGradient, pattern").appendTo(U);B.firstChild;)o.appendChild(B.firstChild);var X=B.attributes,da;for(da=0;da<X.length;da++){var R=
X[da];o.setAttribute(R.nodeName,R.value)}o.id=Ha();lb[q]={symbol:o,xform:d};svgedit.utilities.findDefs().appendChild(o);C.addSubCommand(new svgedit.history.InsertElementCommand(o))}var L=k.createElementNS(f.SVG,"use");L.id=Ha();eb(L,"#"+o.id);(u||A().getCurrentLayer()).appendChild(L);C.addSubCommand(new svgedit.history.InsertElementCommand(L));xa();L.setAttribute("transform",d);svgedit.recalculate.recalculateDimensions(L);$(L).data("symbol",o).data("ref",o);gb([L]);pa(C);W("changed",[s])}catch(I){console.log(I);
return false}return true};var wb=m.identifyLayers=function(){Ob();A().identifyLayers()};this.createLayer=function(b){var e=new svgedit.history.BatchCommand("Create Layer");b=A().createLayer(b);e.addSubCommand(new svgedit.history.InsertElementCommand(b));pa(e);xa();W("changed",[b])};this.cloneLayer=function(b){var e=new svgedit.history.BatchCommand("Duplicate Layer"),d=k.createElementNS(f.SVG,"g"),q=k.createElementNS(f.SVG,"title");q.textContent=b;d.appendChild(q);q=A().getCurrentLayer();$(q).after(d);
q=q.childNodes;var j;for(j=0;j<q.length;j++){var C=q[j];C.localName!="title"&&d.appendChild(ob(C))}xa();wb();e.addSubCommand(new svgedit.history.InsertElementCommand(d));pa(e);m.setCurrentLayer(b);W("changed",[d])};this.deleteCurrentLayer=function(){var b=A().getCurrentLayer(),e=b.nextSibling,d=b.parentNode;if(b=A().deleteCurrentLayer()){var q=new svgedit.history.BatchCommand("Delete Layer");q.addSubCommand(new svgedit.history.RemoveElementCommand(b,e,d));pa(q);xa();W("changed",[d]);return true}return false};
this.setCurrentLayer=function(b){(b=A().setCurrentLayer(svgedit.utilities.toXml(b)))&&xa();return b};this.renameCurrentLayer=function(b){var e,d=A();if(d.current_layer){var q=d.current_layer;if(!m.setCurrentLayer(b)){var j=new svgedit.history.BatchCommand("Rename Layer");for(e=0;e<d.getNumLayers();++e)if(d.all_layers[e][1]==q)break;var C=d.getLayerName(e);d.all_layers[e][0]=svgedit.utilities.toXml(b);var o=q.childNodes.length;for(e=0;e<o;++e){var w=q.childNodes.item(e);if(w&&w.tagName=="title"){for(;w.firstChild;)w.removeChild(w.firstChild);
w.textContent=b;j.addSubCommand(new svgedit.history.ChangeElementCommand(w,{"#text":C}));pa(j);W("changed",[q]);return true}}}d.current_layer=q}return false};this.setCurrentLayerPosition=function(b){var e,d=A();if(d.current_layer&&b>=0&&b<d.getNumLayers()){for(e=0;e<d.getNumLayers();++e)if(d.all_layers[e][1]==d.current_layer)break;if(e==d.getNumLayers())return false;if(e!=b){var q=null,j=d.current_layer.nextSibling;if(b>e){if(b<d.getNumLayers()-1)q=d.all_layers[b+1][1]}else q=d.all_layers[b][1];s.insertBefore(d.current_layer,
q);pa(new svgedit.history.MoveElementCommand(d.current_layer,j,s));wb();m.setCurrentLayer(d.getLayerName(b));return true}}return false};this.setLayerVisibility=function(b,e){var d=A(),q=d.getLayerVisibility(b),j=d.setLayerVisibility(b,e);if(j)pa(new svgedit.history.ChangeElementCommand(j,{display:q?"inline":"none"},"Layer Visibility"));else return false;if(j==d.getCurrentLayer()){xa();ra.clear()}return true};this.moveSelectedToLayer=function(b){var e,d=null,q=A();for(e=0;e<q.getNumLayers();++e)if(q.getLayerName(e)==
b){d=q.all_layers[e][1];break}if(!d)return false;b=new svgedit.history.BatchCommand("Move Elements to Layer");q=r;for(e=q.length;e--;){var j=q[e];if(j){var C=j.nextSibling,o=j.parentNode;d.appendChild(j);b.addSubCommand(new svgedit.history.MoveElementCommand(j,C,o))}}pa(b);return true};this.mergeLayer=function(b){var e=new svgedit.history.BatchCommand("Merge Layer"),d=A(),q=$(d.current_layer).prev()[0];if(q){for(e.addSubCommand(new svgedit.history.RemoveElementCommand(d.current_layer,d.current_layer.nextSibling,
s));d.current_layer.firstChild;){var j=d.current_layer.firstChild;if(j.localName=="title"){e.addSubCommand(new svgedit.history.RemoveElementCommand(j,j.nextSibling,d.current_layer));d.current_layer.removeChild(j)}else{var C=j.nextSibling;q.appendChild(j);e.addSubCommand(new svgedit.history.MoveElementCommand(j,C,d.current_layer))}}s.removeChild(d.current_layer);if(!b){xa();wb();W("changed",[s]);pa(e)}d.current_layer=q;return e}};this.mergeAllLayers=function(){var b=new svgedit.history.BatchCommand("Merge all Layers"),
e=A();for(e.current_layer=e.all_layers[e.getNumLayers()-1][1];$(s).children("g").length>1;)b.addSubCommand(m.mergeLayer(true));xa();wb();W("changed",[s]);pa(b)};var Ob=this.leaveContext=function(){var b,e=Qa.length;if(e){for(b=0;b<e;b++){var d=Qa[b],q=rb(d,"orig_opac");q!==1?d.setAttribute("opacity",q):d.removeAttribute("opacity");d.setAttribute("style","pointer-events: inherit")}Qa=[];xa(true);W("contextset",null)}u=null},hc=this.setContext=function(b){Ob();if(typeof b==="string")b=svgedit.utilities.getElem(b);
u=b;$(b).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var e=this.getAttribute("opacity")||1;rb(this,"orig_opac",e);this.setAttribute("opacity",e*0.33);this.setAttribute("style","pointer-events: none");Qa.push(this)});xa();W("contextset",u)};this.clear=function(){ra.clear();xa();m.clearSvgContentElement();m.current_drawing_=new svgedit.draw.Drawing(s);m.createLayer("Layer 1");m.undoMgr.resetUndoStack();qa.initGroup();Da=qa.getRubberBandBox();W("cleared")};this.linkControlPoints=
ra.linkControlPoints;this.getContentElem=function(){return s};this.getRootElem=function(){return z};this.getSelectedElems=function(){return r};var sb=this.getResolution=function(){var b=s.getAttribute("width")/h,e=s.getAttribute("height")/h;return{w:b,h:e,zoom:h}};this.getZoom=function(){return h};this.getVersion=function(){return"svgcanvas.js ($Rev: 2875 $)"};this.setUiStrings=function(b){$.extend(qb,b.notification)};this.setConfig=function(b){$.extend(n,b)};this.getTitle=function(b){if(b=b||r[0]){b=
$(b).data("gsvg")||$(b).data("symbol")||b;var e=b.childNodes;for(b=0;b<e.length;b++)if(e[b].nodeName=="title")return e[b].textContent;return""}};this.setGroupTitle=function(b){var e=r[0];e=$(e).data("gsvg")||e;var d=$(e).children("title"),q=new svgedit.history.BatchCommand("Set Label");if(b.length)if(d.length){d=d[0];q.addSubCommand(new svgedit.history.ChangeElementCommand(d,{"#text":d.textContent}));d.textContent=b}else{d=k.createElementNS(f.SVG,"title");d.textContent=b;$(e).prepend(d);q.addSubCommand(new svgedit.history.InsertElementCommand(d))}else{q.addSubCommand(new svgedit.history.RemoveElementCommand(d[0],
d.nextSibling,e));d.remove()}pa(q)};var ic=this.getDocumentTitle=function(){return m.getTitle(s)};this.setDocumentTitle=function(b){var e,d=s.childNodes,q=false,j="",C=new svgedit.history.BatchCommand("Change Image Title");for(e=0;e<d.length;e++)if(d[e].nodeName=="title"){q=d[e];j=q.textContent;break}if(!q){q=k.createElementNS(f.SVG,"title");s.insertBefore(q,s.firstChild)}if(b.length)q.textContent=b;else q.parentNode.removeChild(q);C.addSubCommand(new svgedit.history.ChangeElementCommand(q,{"#text":j}));
pa(C)};this.getEditorNS=function(b){b&&s.setAttribute("xmlns:se",f.SE);return f.SE};this.setResolution=function(b,e){var d=sb(),q=d.w;d=d.h;var j;if(b=="fit"){var C=getStrokedBBox();if(C){j=new svgedit.history.BatchCommand("Fit Canvas to Content");var o=Ta();gb(o);var w=[],B=[];$.each(o,function(){w.push(C.x*-1);B.push(C.y*-1)});o=m.moveSelectedElements(w,B,true);j.addSubCommand(o);xa();b=Math.round(C.width);e=Math.round(C.height)}else return false}if(b!=q||e!=d){o=z.suspendRedraw(1E3);j||(j=new svgedit.history.BatchCommand("Change Image Dimensions"));
b=svgedit.units.convertToNum("width",b);e=svgedit.units.convertToNum("height",e);s.setAttribute("width",b);s.setAttribute("height",e);this.contentW=b;this.contentH=e;j.addSubCommand(new svgedit.history.ChangeElementCommand(s,{width:q,height:d}));s.setAttribute("viewBox",[0,0,b/h,e/h].join(" "));j.addSubCommand(new svgedit.history.ChangeElementCommand(s,{viewBox:["0 0",q,d].join(" ")}));pa(j);z.unsuspendRedraw(o);W("changed",[s])}return true};this.getOffset=function(){return $(s).attr(["x","y"])};
this.setBBoxZoom=function(b,e,d){var q=0.85,j=function(C){if(!C)return false;var o=Math.min(Math.round(e/C.width*100*q)/100,Math.round(d/C.height*100*q)/100);m.setZoom(o);return{zoom:o,bbox:C}};if(typeof b=="object"){b=b;if(b.width==0||b.height==0){m.setZoom(b.zoom?b.zoom:h*b.factor);return{zoom:h,bbox:b}}return j(b)}switch(b){case "selection":if(!r[0])return;b=$.map(r,function(C){if(C)return C});b=getStrokedBBox(b);break;case "canvas":b=sb();q=0.95;b={width:b.w,height:b.h,x:0,y:0};break;case "content":b=
getStrokedBBox();break;case "layer":b=getStrokedBBox(Ta(A().getCurrentLayer()));break;default:return}return j(b)};this.setZoom=function(b){var e=sb();s.setAttribute("viewBox","0 0 "+e.w/b+" "+e.h/b);h=b;$.each(r,function(d,q){q&&qa.requestSelector(q).resize()});ra.zoomChange();tb("zoomChanged",b)};this.getMode=function(){return va};this.setMode=function(b){ra.clear(true);Ka.clear();ya=r[0]&&r[0].nodeName=="text"?Va:v;va=b};this.getColor=function(b){return ya[b]};this.setColor=function(b,e,d){function q(w){w.nodeName!=
"g"&&j.push(w)}v[b]=e;ya[b+"_paint"]={type:"solidColor"};for(var j=[],C=r.length;C--;){var o=r[C];if(o)if(o.tagName=="g")svgedit.utilities.walkTree(o,q);else if(b=="fill")o.tagName!="polyline"&&o.tagName!="line"&&j.push(o);else j.push(o)}if(j.length>0)if(d)xb(b,e,j);else{Ma(b,e,j);W("changed",j)}};var ac=this.setGradient=function(b){if(!(!ya[b+"_paint"]||ya[b+"_paint"].type=="solidColor")){var e=m[b+"Grad"],d=$b(e),q=svgedit.utilities.findDefs();if(d)e=d;else{e=q.appendChild(k.importNode(e,true));
e.id=Ha()}m.setColor(b,"url(#"+e.id+")")}},$b=function(b){var e=svgedit.utilities.findDefs();e=$(e).find("linearGradient, radialGradient");for(var d=e.length,q=["r","cx","cy","fx","fy"];d--;){var j=e[d];if(b.tagName=="linearGradient"){if(b.getAttribute("x1")!=j.getAttribute("x1")||b.getAttribute("y1")!=j.getAttribute("y1")||b.getAttribute("x2")!=j.getAttribute("x2")||b.getAttribute("y2")!=j.getAttribute("y2"))continue}else{var C=$(b).attr(q),o=$(j).attr(q),w=false;$.each(q,function(S,U){if(C[U]!=
o[U])w=true});if(w)continue}var B=b.getElementsByTagNameNS(f.SVG,"stop"),H=j.getElementsByTagNameNS(f.SVG,"stop");if(B.length==H.length){for(var K=B.length;K--;){var D=B[K],N=H[K];if(D.getAttribute("offset")!=N.getAttribute("offset")||D.getAttribute("stop-opacity")!=N.getAttribute("stop-opacity")||D.getAttribute("stop-color")!=N.getAttribute("stop-color"))break}if(K==-1)return j}}return null};this.setPaint=function(b,e){var d=new $.jGraduate.Paint(e);this.setPaintOpacity(b,d.alpha/100,true);ya[b+
"_paint"]=d;switch(d.type){case "solidColor":this.setColor(b,d.solidColor!="none"?"#"+d.solidColor:"none");break;case "linearGradient":case "radialGradient":m[b+"Grad"]=d[d.type];ac(b)}};this.setStrokePaint=function(b){this.setPaint("stroke",b)};this.setFillPaint=function(b){this.setPaint("fill",b)};this.getStrokeWidth=function(){return ya.stroke_width};this.setStrokeWidth=function(b){function e(C){C.nodeName!="g"&&d.push(C)}if(b==0&&["line","path"].indexOf(va)>=0)m.setStrokeWidth(1);else{ya.stroke_width=
b;for(var d=[],q=r.length;q--;){var j=r[q];if(j)j.tagName=="g"?svgedit.utilities.walkTree(j,e):d.push(j)}if(d.length>0){Ma("stroke-width",b,d);W("changed",r)}}};this.setStrokeAttr=function(b,e){v[b.replace("-","_")]=e;for(var d=[],q=r.length;q--;){var j=r[q];if(j)j.tagName=="g"?svgedit.utilities.walkTree(j,function(C){C.nodeName!="g"&&d.push(C)}):d.push(j)}if(d.length>0){Ma(b,e,d);W("changed",r)}};this.getStyle=function(){return v};this.getOpacity=function(){return v.opacity};this.setOpacity=function(b){v.opacity=
b;Ma("opacity",b)};this.getFillOpacity=function(){return v.fill_opacity};this.getStrokeOpacity=function(){return v.stroke_opacity};this.setPaintOpacity=function(b,e,d){v[b+"_opacity"]=e;d?xb(b+"-opacity",e):Ma(b+"-opacity",e)};this.getPaintOpacity=function(b){return b==="fill"?this.getFillOpacity():this.getStrokeOpacity()};this.getBlur=function(b){var e=0;if(b)if(b.getAttribute("filter"))if(b=svgedit.utilities.getElem(b.id+"_blur"))e=b.firstChild.getAttribute("stdDeviation");return e};(function(){function b(){var j=
m.undoMgr.finishUndoableChange();e.addSubCommand(j);pa(e);d=e=null}var e=null,d=null,q=false;m.setBlurNoUndo=function(j){if(d)if(j===0){xb("filter","");q=true}else{var C=r[0];q&&xb("filter","url(#"+C.id+"_blur)");if(svgedit.browser.isWebkit()){console.log("e",C);C.removeAttribute("filter");C.setAttribute("filter","url(#"+C.id+"_blur)")}xb("stdDeviation",j,[d.firstChild]);m.setBlurOffsets(d,j)}else m.setBlur(j)};m.setBlurOffsets=function(j,C){if(C>3)svgedit.utilities.assignAttributes(j,{x:"-50%",y:"-50%",
width:"200%",height:"200%"},100);else if(!svgedit.browser.isWebkit()){j.removeAttribute("x");j.removeAttribute("y");j.removeAttribute("width");j.removeAttribute("height")}};m.setBlur=function(j,C){if(e)b();else{var o=r[0],w=o.id;d=svgedit.utilities.getElem(w+"_blur");j-=0;var B=new svgedit.history.BatchCommand;if(d){if(j===0)d=null}else{var H=O({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:j}});d=O({element:"filter",attr:{id:w+"_blur"}});d.appendChild(H);svgedit.utilities.findDefs().appendChild(d);
B.addSubCommand(new svgedit.history.InsertElementCommand(d))}H={filter:o.getAttribute("filter")};if(j===0){o.removeAttribute("filter");B.addSubCommand(new svgedit.history.ChangeElementCommand(o,H))}else{Ma("filter","url(#"+w+"_blur)");B.addSubCommand(new svgedit.history.ChangeElementCommand(o,H));m.setBlurOffsets(d,j);e=B;m.undoMgr.beginUndoableChange("stdDeviation",[d?d.firstChild:null]);if(C){m.setBlurNoUndo(j);b()}}}}})();this.getBold=function(){var b=r[0];if(b!=null&&b.tagName=="text"&&r[1]==
null)return b.getAttribute("font-weight")=="bold";return false};this.setBold=function(b){var e=r[0];if(e!=null&&e.tagName=="text"&&r[1]==null)Ma("font-weight",b?"bold":"normal");r[0].textContent||Ka.setCursor()};this.getItalic=function(){var b=r[0];if(b!=null&&b.tagName=="text"&&r[1]==null)return b.getAttribute("font-style")=="italic";return false};this.setItalic=function(b){var e=r[0];if(e!=null&&e.tagName=="text"&&r[1]==null)Ma("font-style",b?"italic":"normal");r[0].textContent||Ka.setCursor()};
this.getFontFamily=function(){return Va.font_family};this.setFontFamily=function(b){Va.font_family=b;Ma("font-family",b);r[0]&&!r[0].textContent&&Ka.setCursor()};this.setFontColor=function(b){Va.fill=b;Ma("fill",b)};this.getFontColor=function(){return Va.fill};this.getFontSize=function(){return Va.font_size};this.setFontSize=function(b){Va.font_size=b;Ma("font-size",b);r[0].textContent||Ka.setCursor()};this.getText=function(){var b=r[0];if(b==null)return"";return b.textContent};this.setTextContent=
function(b){Ma("#text",b);Ka.init(b);Ka.setCursor()};this.setImageURL=function(b){var e=r[0];if(e){var d=$(e).attr(["width","height"]);d=!d.width||!d.height;var q=Ca(e);if(q!==b)d=true;else if(!d)return;var j=new svgedit.history.BatchCommand("Change Image URL");eb(e,b);j.addSubCommand(new svgedit.history.ChangeElementCommand(e,{"#href":q}));d?$(new Image).load(function(){var C=$(e).attr(["width","height"]);$(e).attr({width:this.width,height:this.height});qa.requestSelector(e).resize();j.addSubCommand(new svgedit.history.ChangeElementCommand(e,
C));pa(j);W("changed",[e])}).attr("src",b):pa(j)}};this.setLinkURL=function(b){var e=r[0];if(e){if(e.tagName!=="a"){e=$(e).parents("a");if(e.length)e=e[0];else return}var d=Ca(e);if(d!==b){var q=new svgedit.history.BatchCommand("Change Link URL");eb(e,b);q.addSubCommand(new svgedit.history.ChangeElementCommand(e,{"#href":d}));pa(q)}}};this.setRectRadius=function(b){var e=r[0];if(e!=null&&e.tagName=="rect"){var d=e.getAttribute("rx");if(d!=b){e.setAttribute("rx",b);e.setAttribute("ry",b);pa(new svgedit.history.ChangeElementCommand(e,
{rx:d,ry:d},"Radius"));W("changed",[e])}}};this.makeHyperlink=function(b){m.groupSelectedElements("a",b)};this.removeHyperlink=function(){m.ungroupSelectedElement()};this.setSegType=function(b){ra.setSegType(b)};this.convertToPath=function(b,e){if(b==null)$.each(r,function(R,L){L&&m.convertToPath(L)});else{if(!e)var d=new svgedit.history.BatchCommand("Convert element to Path");var q=e?{}:{fill:v.fill,"fill-opacity":v.fill_opacity,stroke:v.stroke,"stroke-width":v.stroke_width,"stroke-dasharray":v.stroke_dasharray,
"stroke-linejoin":v.stroke_linejoin,"stroke-linecap":v.stroke_linecap,"stroke-opacity":v.stroke_opacity,opacity:v.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){if(b.getAttribute(this))q[this]=b.getAttribute(this)});var j=O({element:"path",attr:q}),C=b.getAttribute("transform");C&&j.setAttribute("transform",C);var o=b.id,w=b.parentNode;b.nextSibling?w.insertBefore(j,b):w.appendChild(j);var B="",H=function(R){$.each(R,function(L,I){var M,
Q=I[1];B+=I[0];for(M=0;M<Q.length;M+=2)B+=Q[M]+","+Q[M+1]+" "})},K=1.81,D,N;switch(b.tagName){case "ellipse":case "circle":D=$(b).attr(["rx","ry","cx","cy"]);var S=D.cx,U=D.cy;N=D.rx;ry=D.ry;if(b.tagName=="circle")N=ry=$(b).attr("r");H([["M",[S-N,U]],["C",[S-N,U-ry/K,S-N/K,U-ry,S,U-ry]],["C",[S+N/K,U-ry,S+N,U-ry/K,S+N,U]],["C",[S+N,U+ry/K,S+N/K,U+ry,S,U+ry]],["C",[S-N/K,U+ry,S-N,U+ry/K,S-N,U]],["Z",[]]]);break;case "path":B=b.getAttribute("d");break;case "line":D=$(b).attr(["x1","y1","x2","y2"]);
B="M"+D.x1+","+D.y1+"L"+D.x2+","+D.y2;break;case "polyline":case "polygon":B="M"+b.getAttribute("points");break;case "rect":D=$(b).attr(["rx","ry"]);N=D.rx;ry=D.ry;var X=b.getBBox();D=X.x;S=X.y;U=X.width;X=X.height;K=4-K;!N&&!ry?H([["M",[D,S]],["L",[D+U,S]],["L",[D+U,S+X]],["L",[D,S+X]],["L",[D,S]],["Z",[]]]):H([["M",[D,S+ry]],["C",[D,S+ry/K,D+N/K,S,D+N,S]],["L",[D+U-N,S]],["C",[D+U-N/K,S,D+U,S+ry/K,D+U,S+ry]],["L",[D+U,S+X-ry]],["C",[D+U,S+X-ry/K,D+U-N/K,S+X,D+U-N,S+X]],["L",[D+N,S+X]],["C",[D+N/
K,S+X,D,S+X-ry/K,D,S+X-ry]],["L",[D,S+ry]],["Z",[]]]);break;default:j.parentNode.removeChild(j)}B&&j.setAttribute("d",B);if(e){ra.resetOrientation(j);d=false;try{d=j.getBBox()}catch(da){}j.parentNode.removeChild(j);return d}else{if(C){C=svgedit.transformlist.getTransformList(j);svgedit.math.hasMatrixTransform(C)&&ra.resetOrientation(j)}d.addSubCommand(new svgedit.history.RemoveElementCommand(b,b.nextSibling,w));d.addSubCommand(new svgedit.history.InsertElementCommand(j));xa();b.parentNode.removeChild(b);
j.setAttribute("id",o);j.removeAttribute("visibility");gb([j],true);pa(d)}}};var xb=function(b,e,d){var q=z.suspendRedraw(1E3);va=="pathedit"&&ra.moveNode(b,e);d=d||r;for(var j=d.length,C=["g","polyline","path"],o=["transform","opacity","filter"];j--;){var w=d[j];if(w!=null)if((b==="x"||b==="y")&&C.indexOf(w.tagName)>=0){var B=getStrokedBBox([w]);m.moveSelectedElements((b==="x"?e-B.x:0)*h,(b==="y"?e-B.y:0)*h,true)}else{w.tagName==="g"&&o.indexOf(b);B=b==="#text"?w.textContent:w.getAttribute(b);if(B==
null)B="";if(B!==String(e)){if(b=="#text"){svgedit.utilities.getBBox(w);w.textContent=e;if(/rotate/.test(w.getAttribute("transform")))w=Db(w)}else b=="#href"?eb(w,e):w.setAttribute(b,e);va==="textedit"&&b!=="#text"&&w.textContent.length&&Ka.toSelectMode(w);if(svgedit.browser.isGecko()&&w.nodeName==="text"&&/rotate/.test(w.getAttribute("transform")))if(String(e).indexOf("url")===0||["font-size","font-family","x","y"].indexOf(b)>=0&&w.textContent)w=Db(w);r.indexOf(w)>=0&&setTimeout(function(){w.parentNode&&
qa.requestSelector(w).resize()},0);B=svgedit.utilities.getRotationAngle(w);if(B!=0&&b!="transform")for(var H=svgedit.transformlist.getTransformList(w),K=H.numberOfItems;K--;)if(H.getItem(K).type==4){H.removeItem(K);var D=svgedit.utilities.getBBox(w),N=svgedit.math.transformPoint(D.x+D.width/2,D.y+D.height/2,svgedit.math.transformListToTransform(H).matrix);D=N.x;N=N.y;var S=z.createSVGTransform();S.setRotate(B,D,N);H.insertItemBefore(S,K);break}}}}z.unsuspendRedraw(q)},Ma=this.changeSelectedAttribute=
function(b,e,d){d=d||r;m.undoMgr.beginUndoableChange(b,d);xb(b,e,d);b=m.undoMgr.finishUndoableChange();b.isEmpty()||pa(b)};this.deleteSelectedElements=function(){var b,e=new svgedit.history.BatchCommand("Delete Elements"),d=r.length,q=[];for(b=0;b<d;++b){var j=r[b];if(j==null)break;var C=j.parentNode,o=j;qa.releaseSelector(o);svgedit.path.removePath_(o.id);if(C.tagName==="a"&&C.childNodes.length===1){o=C;C=C.parentNode}var w=o.nextSibling;o=C.removeChild(o);q.push(j);r[b]=null;e.addSubCommand(new Ua(o,
w,C))}e.isEmpty()||pa(e);W("changed",q);xa()};this.cutSelectedElements=function(){var b,e=new svgedit.history.BatchCommand("Cut Elements"),d=r.length,q=[];for(b=0;b<d;++b){var j=r[b];if(j==null)break;var C=j.parentNode,o=j;qa.releaseSelector(o);svgedit.path.removePath_(o.id);var w=o.nextSibling;o=C.removeChild(o);q.push(j);r[b]=null;e.addSubCommand(new Ua(o,w,C))}e.isEmpty()||pa(e);W("changed",q);xa();m.clipBoard=q};this.copySelectedElements=function(){m.clipBoard=$.merge([],r)};this.pasteElements=
function(b,e,d){var q=m.clipBoard,j=q.length;if(j){for(var C=[],o=new svgedit.history.BatchCommand("Paste elements");j--;){var w=q[j];if(w){var B=ob(w);if(!svgedit.utilities.getElem(w.id))B.id=w.id;C.push(B);(u||A().getCurrentLayer()).appendChild(B);o.addSubCommand(new svgedit.history.InsertElementCommand(B))}}$a(C);if(b!=="in_place"){var H,K;if(b){if(b==="point"){H=e;K=d}}else{H=Cb.x;K=Cb.y}b=getStrokedBBox(C);var D=H-(b.x+b.width/2),N=K-(b.y+b.height/2),S=[],U=[];$.each(C,function(){S.push(D);U.push(N)});
H=m.moveSelectedElements(S,U,false);o.addSubCommand(H)}pa(o);W("changed",C)}};this.groupSelectedElements=function(b,e){b||(b="g");var d="";switch(b){case "a":d="Make hyperlink";var q="";if(arguments.length>1)q=e;break;default:b="g";d="Group Elements"}d=new svgedit.history.BatchCommand(d);var j=O({element:b,attr:{id:Ha()}});b==="a"&&eb(j,q);d.addSubCommand(new svgedit.history.InsertElementCommand(j));for(q=r.length;q--;){var C=r[q];if(C!=null){if(C.parentNode.tagName==="a"&&C.parentNode.childNodes.length===
1)C=C.parentNode;var o=C.nextSibling,w=C.parentNode;j.appendChild(C);d.addSubCommand(new svgedit.history.MoveElementCommand(C,o,w))}}d.isEmpty()||pa(d);$a([j],true)};var Vb=this.pushGroupProperties=function(b,e){var d=b.childNodes,q=d.length,j=b.getAttribute("transform"),C=svgedit.transformlist.getTransformList(b),o=svgedit.math.transformListToTransform(C).matrix,w=new svgedit.history.BatchCommand("Push group properties"),B=0,H=svgedit.utilities.getRotationAngle(b),K=$(b).attr(["filter","opacity"]),
D,N,S;for(B=0;B<q;B++){var U=d[B];if(U.nodeType===1){if(K.opacity!==null&&K.opacity!==1){U.getAttribute("opacity");var X=Math.round((U.getAttribute("opacity")||1)*K.opacity*100)/100;Ma("opacity",X,[U])}if(K.filter){S=X=this.getBlur(U);N||(N=this.getBlur(b));if(X)X=Number(N)+Number(X);else if(X===0)X=N;if(S)D=svgedit.utilities.getRefElem(U.getAttribute("filter"));else if(D){D=ob(D);svgedit.utilities.findDefs().appendChild(D)}else D=svgedit.utilities.getRefElem(K.filter);D.id=U.id+"_"+(D.firstChild.tagName===
"feGaussianBlur"?"blur":"filter");Ma("filter","url(#"+D.id+")",[U]);if(X){Ma("stdDeviation",X,[D.firstChild]);m.setBlurOffsets(D,X)}}X=svgedit.transformlist.getTransformList(U);if(~U.tagName.indexOf("Gradient"))X=null;if(X)if(U.tagName!=="defs")if(C.numberOfItems){if(H&&C.numberOfItems==1){var da=C.getItem(0).matrix,R=z.createSVGMatrix();if(S=svgedit.utilities.getRotationAngle(U))R=X.getItem(0).matrix;var L=svgedit.utilities.getBBox(U),I=svgedit.math.transformListToTransform(X).matrix,M=svgedit.math.transformPoint(L.x+
L.width/2,L.y+L.height/2,I);L=H+S;I=z.createSVGTransform();I.setRotate(L,M.x,M.y);da=svgedit.math.matrixMultiply(da,R,I.matrix.inverse());S&&X.removeItem(0);if(L)X.numberOfItems?X.insertItemBefore(I,0):X.appendItem(I);if(da.e||da.f){S=z.createSVGTransform();S.setTranslate(da.e,da.f);X.numberOfItems?X.insertItemBefore(S,0):X.appendItem(S)}}else{da=U.getAttribute("transform");S={};S.transform=da||"";S=z.createSVGTransform();da=svgedit.math.transformListToTransform(X).matrix;R=da.inverse();da=svgedit.math.matrixMultiply(R,
o,da);S.setMatrix(da);X.appendItem(S)}(U=svgedit.recalculate.recalculateDimensions(U))&&w.addSubCommand(U)}}}if(j){S={};S.transform=j;b.setAttribute("transform","");b.removeAttribute("transform");w.addSubCommand(new svgedit.history.ChangeElementCommand(b,S))}if(e&&!w.isEmpty())return w};this.ungroupSelectedElement=function(){var b=r[0];if(b)if($(b).data("gsvg")||$(b).data("symbol"))Zb(b);else if(b.tagName==="use"){var e=svgedit.utilities.getElem(Ca(b).substr(1));$(b).data("symbol",e).data("ref",e);
Zb(b)}else{e=$(b).parents("a");if(e.length)b=e[0];if(b.tagName==="g"||b.tagName==="a"){e=new svgedit.history.BatchCommand("Ungroup Elements");var d=Vb(b,true);d&&e.addSubCommand(d);d=b.parentNode;for(var q=b.nextSibling,j=Array(b.childNodes.length),C=0;b.firstChild;){var o=b.firstChild,w=o.nextSibling,B=o.parentNode;if(o.tagName==="title"){e.addSubCommand(new svgedit.history.RemoveElementCommand(o,o.nextSibling,B));B.removeChild(o)}else{j[C++]=o=d.insertBefore(o,q);e.addSubCommand(new svgedit.history.MoveElementCommand(o,
w,B))}}xa();q=b.nextSibling;b=d.removeChild(b);e.addSubCommand(new svgedit.history.RemoveElementCommand(b,q,d));e.isEmpty()||pa(e);gb(j)}}};this.moveToTopSelectedElement=function(){var b=r[0];if(b!=null){b=b;var e=b.parentNode,d=b.nextSibling;b=b.parentNode.appendChild(b);if(d!=b.nextSibling){pa(new svgedit.history.MoveElementCommand(b,d,e,"top"));W("changed",[b])}}};this.moveToBottomSelectedElement=function(){var b=r[0];if(b!=null){b=b;var e=b.parentNode,d=b.nextSibling,q=b.parentNode.firstChild;
if(q.tagName=="title")q=q.nextSibling;if(q.tagName=="defs")q=q.nextSibling;b=b.parentNode.insertBefore(b,q);if(d!=b.nextSibling){pa(new svgedit.history.MoveElementCommand(b,d,e,"bottom"));W("changed",[b])}}};this.moveUpDownSelected=function(b){var e=r[0];if(e){hb=[];var d,q,j=$(ub(getStrokedBBox([e]))).toArray();b=="Down"&&j.reverse();$.each(j,function(){if(q){d=this;return false}else if(this==e)q=true});if(d){j=e.parentNode;var C=e.nextSibling;$(d)[b=="Down"?"before":"after"](e);if(C!=e.nextSibling){pa(new svgedit.history.MoveElementCommand(e,
C,j,"Move "+b));W("changed",[e])}}}};this.moveSelectedElements=function(b,e,d){if(b.constructor!=Array){b/=h;e/=h}d=d||true;for(var q=new svgedit.history.BatchCommand("position"),j=r.length;j--;){var C=r[j];if(C!=null){var o=z.createSVGTransform(),w=svgedit.transformlist.getTransformList(C);b.constructor==Array?o.setTranslate(b[j],e[j]):o.setTranslate(b,e);w.numberOfItems?w.insertItemBefore(o,0):w.appendItem(o);(o=svgedit.recalculate.recalculateDimensions(C))&&q.addSubCommand(o);qa.requestSelector(C).resize()}}if(!q.isEmpty()){d&&
pa(q);W("changed",r);return q}};this.cloneSelectedElements=function(b,e){var d,q,j=new svgedit.history.BatchCommand("Clone Elements"),C=r.length;r.sort(function(o,w){return $(w).index()-$(o).index()});for(d=0;d<C;++d){q=r[d];if(q==null)break}C=r.slice(0,d);this.clearSelection(true);for(d=C.length;d--;){q=C[d]=ob(C[d]);(u||A().getCurrentLayer()).appendChild(q);j.addSubCommand(new svgedit.history.InsertElementCommand(q))}if(!j.isEmpty()){gb(C.reverse());this.moveSelectedElements(b,e,false);pa(j)}};
this.alignSelectedElements=function(b,e){var d,q,j=[],C=Number.MAX_VALUE,o=Number.MIN_VALUE,w=Number.MAX_VALUE,B=Number.MIN_VALUE,H=Number.MIN_VALUE,K=Number.MIN_VALUE,D=r.length;if(D){for(d=0;d<D;++d){if(r[d]==null)break;q=r[d];j[d]=getStrokedBBox([q]);switch(e){case "smallest":if((b=="l"||b=="c"||b=="r")&&(H==Number.MIN_VALUE||H>j[d].width)||(b=="t"||b=="m"||b=="b")&&(K==Number.MIN_VALUE||K>j[d].height)){C=j[d].x;w=j[d].y;o=j[d].x+j[d].width;B=j[d].y+j[d].height;H=j[d].width;K=j[d].height}break;
case "largest":if((b=="l"||b=="c"||b=="r")&&(H==Number.MIN_VALUE||H<j[d].width)||(b=="t"||b=="m"||b=="b")&&(K==Number.MIN_VALUE||K<j[d].height)){C=j[d].x;w=j[d].y;o=j[d].x+j[d].width;B=j[d].y+j[d].height;H=j[d].width;K=j[d].height}break;default:if(j[d].x<C)C=j[d].x;if(j[d].y<w)w=j[d].y;if(j[d].x+j[d].width>o)o=j[d].x+j[d].width;if(j[d].y+j[d].height>B)B=j[d].y+j[d].height}}if(e=="page"){w=C=0;o=m.contentW;B=m.contentH}q=Array(D);H=Array(D);for(d=0;d<D;++d){if(r[d]==null)break;K=j[d];q[d]=0;H[d]=0;
switch(b){case "l":q[d]=C-K.x;break;case "c":q[d]=(C+o)/2-(K.x+K.width/2);break;case "r":q[d]=o-(K.x+K.width);break;case "t":H[d]=w-K.y;break;case "m":H[d]=(w+B)/2-(K.y+K.height/2);break;case "b":H[d]=B-(K.y+K.height)}}this.moveSelectedElements(q,H)}};this.contentW=sb().w;this.contentH=sb().h;this.updateCanvas=function(b,e){z.setAttribute("width",b);z.setAttribute("height",e);var d=$("#canvasBackground")[0],q=s.getAttribute("x"),j=s.getAttribute("y"),C=b/2-this.contentW*h/2,o=e/2-this.contentH*h/
2;svgedit.utilities.assignAttributes(s,{width:this.contentW*h,height:this.contentH*h,x:C,y:o,viewBox:"0 0 "+this.contentW+" "+this.contentH});svgedit.utilities.assignAttributes(d,{width:s.getAttribute("width"),height:s.getAttribute("height"),x:C,y:o});(d=svgedit.utilities.getElem("background_image"))&&svgedit.utilities.assignAttributes(d,{width:"100%",height:"100%"});qa.selectorParentGroup.setAttribute("transform","translate("+C+","+o+")");tb("canvasUpdated",{new_x:C,new_y:o,old_x:q,old_y:j,d_x:C-
q,d_y:o-j});return{x:C,y:o,old_x:q,old_y:j,d_x:C-q,d_y:o-j}};this.setBackground=function(b,e){var d=svgedit.utilities.getElem("canvasBackground"),q=$(d).find("rect")[0],j=svgedit.utilities.getElem("background_image");q.setAttribute("fill",b);if(e){if(!j){j=k.createElementNS(f.SVG,"image");svgedit.utilities.assignAttributes(j,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}eb(j,e);d.appendChild(j)}else j&&j.parentNode.removeChild(j)};this.cycleElement=
function(b){var e=r[0],d=false,q=Ta(u||A().getCurrentLayer());if(q.length){if(e==null){b=b?q.length-1:0;d=q[b]}else for(var j=q.length;j--;)if(q[j]==e){b=b?j-1:j+1;if(b>=q.length)b=0;else if(b<0)b=q.length-1;d=q[b];break}$a([d],true);W("selected",r)}};this.clear();this.getPrivateMethods=function(){return{addCommandToHistory:pa,setGradient:ac,addSvgElementFromJson:O,assignAttributes:db,BatchCommand:Xb,call:W,ChangeElementCommand:ib,copyElem:ob,ffClone:Db,findDefs:ia,findDuplicateGradient:$b,getElem:mb,
getId:Za,getIntersectionList:ub,getMouseTarget:Eb,getNextId:Ha,getPathBBox:Hb,getUrlFromAttr:Pa,hasMatrixTransform:ea,identifyLayers:wb,InsertElementCommand:cb,isIdentity:svgedit.math.isIdentity,logMatrix:Yb,matrixMultiply:ka,MoveElementCommand:yb,preventClickDefault:vb,recalculateAllSelectedDimensions:Mb,recalculateDimensions:Ib,remapElement:Sb,RemoveElementCommand:Ua,removeUnusedDefElems:Pb,round:Ya,runExtensions:tb,sanitizeSvg:Jb,SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,
transformBox:svgedit.math.transformBox,transformListToTransform:ba,transformPoint:Z,walkTree:svgedit.utilities.walkTree}}};(function(){if(!window.svgEditor){window.svgEditor=function(a){function J(v,r){var O=c.setSvgString(v)!==false;r=r||a.noop;O?r(true):a.alert(t.notification.errorLoadingSVG,function(){r(false)})}var p={};p.tool_scale=1;p.exportWindowCt=0;p.langChanged=false;p.showSaveWarning=false;p.storagePromptClosed=false;var c,f,n=svgedit.utilities,i=false,m=false,k=false,z=[],s={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:false,export_notice_done:false},E={},A={extensions:[],
allowedOrigins:[]},h=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-star.js","ext-panning.js","ext-storage.js"],u={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},initOpacity:1,colorPickerCSS:null,initTool:"select",exportWindowType:"new",wireframe:false,showlayers:false,no_save_warning:false,imgPath:"images/",langPath:"locale/",
extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:false,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:true,preventAllURLConfig:false,preventURLContentLoading:false,lockExtensions:false,noDefaultExtensions:false,showGrid:false,noStorageOnLoad:false,forceStorage:false,emptyStorageOnDecline:false},t=p.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",
noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",
QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",
enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}};a.pref=function(v,r){if(r){E[v]=r;p.curPrefs=E}else return v in E?E[v]:s[v]};p.loadContentAndPrefs=function(){if(!(!A.forceStorage&&(A.noStorageOnLoad||!document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)))){if(p.storage&&(A.forceStorage||!A.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var v=
p.storage.getItem("svgedit-"+A.canvasName);v&&p.loadFromString(v)}for(var r in s)if(s.hasOwnProperty(r)){v="svg-edit-"+r;if(p.storage){if(v=p.storage.getItem(v))s[r]=String(v)}else if(window.widget)s[r]=widget.preferenceForKey(v);else{v=document.cookie.match(RegExp("(?:^|;\\s*)"+n.preg_quote(encodeURIComponent(v))+"=([^;]+)"));s[r]=v?decodeURIComponent(v[1]):""}}}};p.setConfig=function(v,r){function O(Z,ka,ea){if(Z[ka]&&typeof Z[ka]==="object")a.extend(true,Z[ka],ea);else Z[ka]=ea}r=r||{};a.each(v,
function(Z,ka){if(v.hasOwnProperty(Z))if(s.hasOwnProperty(Z)){if(!(r.overwrite===false&&(A.preventAllURLConfig||E.hasOwnProperty(Z))))if(r.allowInitialUserOverride===true)s[Z]=ka;else a.pref(Z,ka)}else if(["extensions","allowedOrigins"].indexOf(Z)>-1)r.overwrite===false&&(A.preventAllURLConfig||Z==="allowedOrigins"||Z==="extensions"&&A.lockExtensions)||(A[Z]=A[Z].concat(ka));else if(u.hasOwnProperty(Z))if(!(r.overwrite===false&&(A.preventAllURLConfig||A.hasOwnProperty(Z))))if(A.hasOwnProperty(Z))r.overwrite!==
false&&O(A,Z,ka);else if(r.allowInitialUserOverride===true)O(u,Z,ka);else if(u[Z]&&typeof u[Z]==="object"){A[Z]={};a.extend(true,A[Z],ka)}else A[Z]=ka});p.curConfig=A};p.setCustomHandlers=function(v){p.ready(function(){if(v.open){a('#tool_open > input[type="file"]').remove();a("#tool_open").show();c.open=v.open}if(v.save){p.showSaveWarning=false;c.bind("saved",v.save)}if(v.exportImage){m=v.exportImage;c.bind("exported",m)}if(v.exportPDF){k=v.exportPDF;c.bind("exportedPDF",k)}})};p.randomizeIds=function(){c.randomizeIds(arguments)};
p.init=function(){function v(){A=a.extend(true,{},u,A);if(!A.noDefaultExtensions)A.extensions=A.extensions.concat(h);a.each(["extensions","allowedOrigins"],function(g,l){A[l]=a.grep(A[l],function(F,G){return G===A[l].indexOf(F)})});p.curConfig=A}function r(g,l){var F=g.id,G=F.split("_"),P=G[0];G=G[1];l&&c.setStrokeAttr("stroke-"+P,G);hb();db("#cur_"+P,F,20);a(g).addClass("current").siblings().removeClass("current")}function O(g,l){a.pref("bkgd_color",g);a.pref("bkgd_url",l);c.setBackground(g,l)}function Z(){var g=
c.getHref(na);g=g.indexOf("data:")===0?"":g;a.prompt(t.notification.enterNewImgURL,g,function(l){l&&Bb(l)})}function ka(g,l){l||(l=c.getZoom());g||(g=a("#svgcanvas"));var F,G,P=c.getContentElem(),T=svgedit.units.getTypeMap()[A.baseUnit];for(F=0;F<2;F++){var Y=F===0,fa=Y?"x":"y",ja=Y?"width":"height",la=Number(P.getAttribute(fa));fa=a("#ruler_"+fa+" canvas:first");var ha=fa.clone();fa.replaceWith(ha);var ma=ha[0];var sa=fa=g[ja]();ma.parentNode.style[ja]=sa+"px";var Ga=0,V=ma.getContext("2d"),Ea,wa,
Ia;V.fillStyle="rgb(200,0,0)";V.fillRect(0,0,ma.width,ma.height);ha.siblings().remove();if(fa>=3E4){Ia=parseInt(fa/3E4,10)+1;Ea=[];Ea[0]=V;var Ra;for(G=1;G<Ia;G++){ma[ja]=3E4;Ra=ma.cloneNode(true);ma.parentNode.appendChild(Ra);Ea[G]=Ra.getContext("2d")}Ra[ja]=fa%3E4;fa=3E4}ma[ja]=fa;ja=T*l;ma=50/ja;ha=1;for(G=0;G<lb.length;G++){ha=wa=lb[G];if(ma<=wa)break}ma=ha*ja;V.font="9px sans-serif";for(var Fa=la/ja%ha*ja,Sa=Fa-ma;Fa<sa;){Sa+=ma;G=Math.round(Fa)+0.5;if(Y){V.moveTo(G,15);V.lineTo(G,0)}else{V.moveTo(15,
G);V.lineTo(0,G)}wa=(Sa-la)/ja;if(ha>=1)G=Math.round(wa);else{G=String(ha).split(".")[1].length;G=wa.toFixed(G)}if(G!==0&&G!==1E3&&G%1E3===0)G=G/1E3+"K";if(Y)V.fillText(G,Fa+2,8);else{wa=String(G).split("");for(G=0;G<wa.length;G++)V.fillText(wa[G],1,Fa+9+G*9)}wa=ma/10;for(G=1;G<10;G++){var Oa=Math.round(Fa+wa*G)+0.5;if(Ea&&Oa>fa){Ga++;V.stroke();if(Ga>=Ia){G=10;Fa=sa;continue}V=Ea[Ga];Fa-=3E4;Oa=Math.round(Fa+wa*G)+0.5}var Ja=G%2?12:10;if(Y){V.moveTo(Oa,15);V.lineTo(Oa,Ja)}else{V.moveTo(15,Oa);V.lineTo(Ja,
Oa)}}Fa+=ma}V.strokeStyle="#000";V.stroke()}}function ea(){if(c.deleteCurrentLayer()){Ta();ya();a("#layerlist tr.layer").removeClass("layersel");a("#layerlist tr.layer:first").addClass("layersel")}}function ba(){var g=c.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(t.notification.enterUniqueLayerName,g,function(l){if(l)if(c.getCurrentDrawing().hasLayer(l))a.alert(t.notification.dupeLayerName);else{c.cloneLayer(l);Ta();ya()}})}function ia(g){var l=a("#layerlist tr.layersel").index(),F=
c.getCurrentDrawing().getNumLayers();if(l>0||l<F-1){l+=g;c.setCurrentLayerPosition(F-l-1);ya()}}function Pa(g){g.stopPropagation();g.preventDefault()}function Ca(g){g.stopPropagation();g.preventDefault()}function eb(g){g.stopPropagation();g.preventDefault()}try{if("localStorage"in window)p.storage=localStorage}catch(Hb){}var mb=[];a("#lang_select option").each(function(){mb.push(this.value)});(function(){var g,l;f=a.deparam.querystring(true);if(a.isEmptyObject(f)){v();p.loadContentAndPrefs()}else{if(f.dimensions)f.dimensions=
f.dimensions.split(",");if(f.bkgd_color)f.bkgd_color="#"+f.bkgd_color;if(f.extensions)f.extensions=f.extensions.match(/[:\/\\]/)?"":f.extensions.split(",");a.each(["extPath","imgPath","langPath","jGraduatePath"],function(F){f[F]&&delete f[F]});p.setConfig(f,{overwrite:false});v();if(!A.preventURLContentLoading){g=f.source;l=a.param.querystring();if(!g)if(l.indexOf("source=data:")>=0)g=l.match(/source=(data:[^&]*)/)[1];if(g){g.indexOf("data:")===0?p.loadFromDataURI(g):p.loadFromString(g);return}if(f.url){p.loadFromURL(f.url);
return}}if(!f.noStorageOnLoad||A.forceStorage)p.loadContentAndPrefs()}E=a.extend(true,{},s,E);p.curPrefs=E})();(function(){var g,l=window.opener;if(l)try{g=l.document.createEvent("Event");g.initEvent("svgEditorReady",true,true);l.document.documentElement.dispatchEvent(g)}catch(F){}})();var db=p.setIcon=function(g,l){var F=typeof l==="string"?a.getSvgIcon(l,true):l.clone();F?a(g).empty().append(F):console.log("NOTE: Icon image missing: "+l)},ua=function(){a.each(A.extensions,function(){var g=this;
g.match(/^ext-.*\.js/)&&a.getScript(A.extPath+g,function(l){if(!l){l=document.createElement("script");l.src=A.extPath+g;document.querySelector("head").appendChild(l)}})});p.putLocale(null,mb)};document.location.protocol==="file:"?setTimeout(ua,100):ua();a.svgIcons(A.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback_path:A.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",
undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",group:"shape_group_elements.png",ungroup:"shape_ungroup.png",move_top:"move_top.png",
move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image","#tool_save div":"save",
"#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_source":"source","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text",
"#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone","#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group_elements":"group_elements","#tool_ungroup":"ungroup","#tool_unlink_use":"unlink_use",
"#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round",
"#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link",
"#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity","#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,
".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var g,l=a("#tools_left");if(l.length!==0)g=l.offset().top+l.outerHeight();l=a.pref("iconsize");p.setIconSize(l||(a(window).height()<g?"s":"m"));a(".tools_flyout").each(function(){var F=
a("#"+this.id+"_show"),G=F.attr("data-curopt");if(!F.children("svg, img").length){G=a(G).children().clone();if(G.length){G[0].removeAttribute("style");F.append(G)}}});p.runCallbacks();setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}});p.canvas=c=new a.SvgCanvas(document.getElementById("svgcanvas"),A);var Sb,Ib,bb,Jb,yb,cb=svgedit.browser.isMac()?"meta+":"ctrl+",Ua=c.pathActions,ib=c.undoMgr,Xb=A.imgPath+"logo.png",
W=a("#workarea"),pa=a("#cmenu_canvas"),qa=null,qb="crosshair",Tb="crosshair",rb="toolbars",Ab="",Na={fill:null,stroke:null};(function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var g=a("#dialog_box"),l=a("#dialog_buttons"),F=a("#dialog_content"),G=function(P,T,Y,fa,ja,la,ha){var ma,sa,Ga;F.html("<p>"+T.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt",P=="prompt");l.empty();ma=a('<input type="button" value="'+t.common.ok+'">').appendTo(l);
P!=="alert"&&a('<input type="button" value="'+t.common.cancel+'">').appendTo(l).click(function(){g.hide();Y&&Y(false)});if(P==="prompt"){sa=a('<input type="text">').prependTo(l);sa.val(fa||"");sa.bind("keydown","return",function(){ma.click()})}else if(P==="select"){T=a('<div style="text-align:center;">');sa=a("<select>").appendTo(T);if(ha){var V=a("<label>").text(ha.label);Ga=a('<input type="checkbox">').appendTo(V);Ga.val(ha.value);ha.tooltip&&V.attr("title",ha.tooltip);Ga.prop("checked",!!ha.checked);
T.append(a("<div>").append(V))}a.each(ja||[],function(Ea,wa){typeof wa==="object"?sa.append(a("<option>").val(wa.value).html(wa.text)):sa.append(a("<option>").html(wa))});F.append(T);fa&&sa.val(fa);la&&sa.bind("change","return",la);sa.bind("keydown","return",function(){ma.click()})}else P==="process"&&ma.hide();g.show();ma.click(function(){g.hide();var Ea=P==="prompt"||P==="select"?sa.val():true;if(Y)Ga?Y(Ea,Ga.prop("checked")):Y(Ea)}).focus();if(P==="prompt"||P==="select")sa.focus()};a.alert=function(P,
T){G("alert",P,T)};a.confirm=function(P,T){G("confirm",P,T)};a.process_cancel=function(P,T){G("process",P,T)};a.prompt=function(P,T,Y){G("prompt",P,Y,T)};a.select=function(P,T,Y,fa,ja,la){G("select",P,Y,ja,T,fa,la)}})();var jb=function(){var g=a(".tool_button_current");if(g.length&&g[0].id!=="tool_select"){g.removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")}c.setMode("select");
W.css("cursor","auto")},na=null,Qa=false,Xa=false,Ba=false,nb=false,va="",kb=a("title:first").text(),lb=[];for(ua=0.1;ua<1E5;ua*=10){lb.push(ua);lb.push(2*ua);lb.push(5*ua)}var Va=function(g){var l,F=[],G=c.getCurrentDrawing().getNumLayers();for(l=0;l<G;l++)F[l]=c.getCurrentDrawing().getLayerName(l);if(g)for(l=0;l<G;++l)F[l]!=g&&c.getCurrentDrawing().setLayerOpacity(F[l],0.5);else for(l=0;l<G;++l)c.getCurrentDrawing().setLayerOpacity(F[l],1)},ya=function(){c.clearSelection();for(var g=a("#layerlist tbody").empty(),
l=a("#selLayerNames").empty(),F=c.getCurrentDrawing(),G=F.getCurrentLayerName(),P=c.getCurrentDrawing().getNumLayers(),T=a.getSvgIcon("eye");P--;){var Y=F.getLayerName(P),fa=a('<tr class="layer">').toggleClass("layersel",Y===G),ja=a('<td class="layervis">').toggleClass("layerinvis",!F.getLayerVisibility(Y)),la=a('<td class="layername">'+Y+"</td>");g.append(fa.append(ja,la));l.append('<option value="'+Y+'">'+Y+"</option>")}if(T!==undefined){l=T.clone();a("td.layervis",g).append(l);a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(ha){a("#layerlist tr.layer").removeClass("layersel");
a(this.parentNode).addClass("layersel");c.setCurrentLayer(this.textContent);ha.preventDefault()}).mouseover(function(){Va(this.textContent)}).mouseout(function(){Va()});a("#layerlist td.layervis").click(function(){var ha=a(this.parentNode).prevAll().length;ha=a("#layerlist tr.layer:eq("+ha+") td.layername").text();var ma=a(this).hasClass("layerinvis");c.setLayerVisibility(ha,ma);a(this).toggleClass("layerinvis")});for(l=5-a("#layerlist tr.layer").size();l-- >0;)g.append('<tr><td style="color:white">_</td><td/></tr>')},
Kb=function(g,l){if(!Xa){Xa=true;Ab=c.getSvgString();a("#save_output_btns").toggle(!!l);a("#tool_source_back").toggle(!l);a("#svg_source_textarea").val(Ab);a("#svg_source_editor").fadeIn();a("#svg_source_textarea").focus()}},Da=function(g,l){a("#path_node_panel").toggle(g);a("#tools_bottom_2,#tools_bottom_3").toggle(!g);if(g){a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");db("#tool_select",
"select_node");Qa=false;if(l.length)na=l[0]}else setTimeout(function(){db("#tool_select","select")},1E3)},hb=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()},La=p.toolButtonClick=function(g,l){if(a(g).hasClass("disabled"))return false;if(a(g).parent().hasClass("tools_flyout"))return true;l||a(".tools_flyout").fadeOut("normal");a("#styleoverrides").text("");W.css("cursor","auto");a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a(g).addClass("tool_button_current").removeClass("tool_button");
return true},Cb=p.clickSelect=function(){if(La("#tool_select")){c.setMode("select");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}")}},Bb=p.setImageURL=function(g){g||(g=Xb);c.setImageURL(g);a("#image_url").val(g);if(g.indexOf("data:")===0){a("#image_url").hide();a("#change_image_url").show()}else{c.embedImage(g,function(l){a("#url_notice").toggle(!l);Xb=g});a("#image_url").show();a("#change_image_url").hide()}},tb=function(g){var l=Math.min(Math.max(12+
g.value.length*6,50),300);a(g).width(l)},Ya=p.updateCanvas=function(g,l){var F=W.width(),G=W.height(),P=F,T=G,Y=c.getZoom(),fa=a("#svgcanvas"),ja={x:W[0].scrollLeft+P/2,y:W[0].scrollTop+T/2},la=A.canvas_expansion;F=Math.max(P,c.contentW*Y*la);G=Math.max(T,c.contentH*Y*la);F==P&&G==T?W.css("overflow","hidden"):W.css("overflow","scroll");la=fa.height()/2;var ha=fa.width()/2;fa.width(F).height(G);var ma=G/2,sa=F/2,Ga=c.updateCanvas(F,G),V=sa/ha;F=F/2-P/2;G=G/2-T/2;if(l){l.x+=Ga.x;l.y+=Ga.y}else l={x:sa+
(ja.x-ha)*V,y:ma+(ja.y-la)*V};if(g)if(c.contentW>W.width()){W[0].scrollLeft=Ga.x-10;W[0].scrollTop=Ga.y-10}else{W[0].scrollLeft=F;W[0].scrollTop=G}else{W[0].scrollLeft=l.x-P/2;W[0].scrollTop=l.y-T/2}if(A.showRulers){ka(fa,Y);W.scroll()}f.storagePrompt!==true&&!p.storagePromptClosed&&a("#dialog_box").hide()},ub=function(){var g,l,F=c.getColor("fill")=="none",G=c.getColor("stroke")=="none",P=["#tool_fhpath","#tool_line"],T=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];
if(G)for(g in P){l=P[g];a(l).hasClass("tool_button_current")&&Cb();a(l).addClass("disabled")}else for(g in P){l=P[g];a(l).removeClass("disabled")}if(G&&F)for(g in T){l=T[g];a(l).hasClass("tool_button_current")&&Cb();a(l).addClass("disabled")}else for(g in T){l=T[g];a(l).removeClass("disabled")}c.runExtensions("toolButtonStateUpdate",{nofill:F,nostroke:G});a(".tools_flyout").each(function(){var Y=a("#"+this.id+"_show"),fa=false;a(this).children().each(function(){a(this).hasClass("disabled")||(fa=true)});
Y.toggleClass("disabled",!fa)});hb()},Ta=function(){var g=na;if(g!=null&&!g.parentNode)g=null;var l=c.getCurrentDrawing().getCurrentLayerName(),F=c.getMode(),G=A.baseUnit!=="px"?A.baseUnit:null,P=F=="pathedit",T=a("#cmenu_canvas li");a("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide();if(g!=null){var Y=g.nodeName,fa=c.getRotationAngle(g);a("#angle").val(fa);var ja=c.getBlur(g);
a("#blur").val(ja);a("#blur_slider").slider("option","value",ja);c.addedNew&&Y==="image"&&c.getHref(g).indexOf("data:")!==0&&Z();if(!P&&F!="pathedit"){a("#selected_panel").show();if(["line","circle","ellipse"].indexOf(Y)>=0)a("#xy_panel").hide();else{var la,ha;if(["g","polyline","path"].indexOf(Y)>=0){if(F=c.getStrokedBBox([g])){la=F.x;ha=F.y}}else{la=g.getAttribute("x");ha=g.getAttribute("y")}if(G){la=svgedit.units.convertUnit(la);ha=svgedit.units.convertUnit(ha)}a("#selected_x").val(la||0);a("#selected_y").val(ha||
0);a("#xy_panel").show()}G=["image","text","path","g","use"].indexOf(Y)==-1;a("#tool_topath").toggle(G);a("#tool_reorient").toggle(Y==="path");a("#tool_reorient").toggleClass("disabled",fa===0)}else{l=Ua.getNodePoint();a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button");a("#tool_node_delete").toggleClass("disabled",!Ua.canDeleteNodes);db("#tool_openclose_path",Ua.closed_subpath?"open_path":"close_path");if(l){P=a("#seg_type");if(G){l.x=svgedit.units.convertUnit(l.x);
l.y=svgedit.units.convertUnit(l.y)}a("#path_node_x").val(l.x);a("#path_node_y").val(l.y);l.type?P.val(l.type).removeAttr("disabled"):P.val(4).attr("disabled","disabled")}return}G={g:[],a:[],rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]};var ma=g.tagName;Y=null;if(ma==="a"){Y=c.getHref(g);a("#g_panel").show()}if(g.parentNode.tagName==="a")if(!a(g).siblings().length){a("#a_panel").show();Y=c.getHref(g.parentNode)}a("#tool_make_link, #tool_make_link").toggle(!Y);
Y&&a("#link_url").val(Y);if(G[ma]){G=G[ma];a("#"+ma+"_panel").show();a.each(G,function(sa,Ga){var V=g.getAttribute(Ga);if(A.baseUnit!=="px"&&g[Ga])V=svgedit.units.convertUnit(g[Ga].baseVal.value);a("#"+ma+"_"+Ga).val(V||0)});if(ma=="text"){a("#text_panel").css("display","inline");c.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button");c.getBold()?a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):
a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button");a("#font_family").val(g.getAttribute("font-family"));a("#font_size").val(g.getAttribute("font-size"));a("#text").val(g.textContent);c.addedNew&&setTimeout(function(){a("#text").focus().select()},100)}else if(ma=="image")Bb(c.getHref(g));else if(ma==="g"||ma==="use"){a("#container_panel").show();G=c.getTitle();Y=a("#g_title")[0];Y.value=G;tb(Y);a("#g_title").prop("disabled",ma=="use")}}T[(ma==="g"?"en":"dis")+"ableContextMenuItems"]("#ungroup");
T[(ma==="g"||!Qa?"dis":"en")+"ableContextMenuItems"]("#group")}else if(Qa){a("#multiselected_panel").show();T.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")}else T.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");a("#tool_undo").toggleClass("disabled",ib.getUndoStackSize()===0);a("#tool_redo").toggleClass("disabled",ib.getRedoStackSize()===0);c.addedNew=false;if(g&&!P||Qa){a("#selLayerNames").removeAttr("disabled").val(l);
pa.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")}else a("#selLayerNames").attr("disabled","disabled")},Ub=function(){if(!Sb){var g="#workarea.wireframe #svgcontent * { stroke-width: "+1/c.getZoom()+"px; }";a("#wireframe_rules").text(W.hasClass("wireframe")?g:"")}},Lb=function(g){g=g||c.getDocumentTitle();g=kb+(g?": "+g:"");a("title:first").text(g)},ob=c.zoomChanged=function(g,l,F){if(l=c.setBBoxZoom(l,W.width()-15,W.height()-15)){g=l.zoom;l=l.bbox;if(g<0.0010)bb({value:0.1});
else{a("#zoom").val((g*100).toFixed(1));F?Ya():Ya(false,{x:l.x*g+l.width*g/2,y:l.y*g+l.height*g/2});c.getMode()=="zoom"&&l.width&&jb();Ub()}}};bb=function(g){var l=g.value/100;if(l<0.0010)g.value=0.1;else{g=c.getZoom();ob(window,{width:0,height:0,x:(W[0].scrollLeft+W.width()/2)/g,y:(W[0].scrollTop+W.height()/2)/g,zoom:l},true)}};a("#cur_context_panel").delegate("a","click",function(){var g=a(this);g.attr("data-root")?c.leaveContext():c.setContext(g.text());c.clearSelection();return false});var Za=
{},Ha=function(){a(".tools_flyout").each(function(){var g=a("#"+this.id+"_show");if(!g.data("isLibrary")){var l=[];a(this).children().each(function(){l.push(this.title)});g[0].title=l.join(" / ")}})},Ka=function(){a(".tools_flyout").each(function(){var g=a("#"+this.id+"_show"),l=g.offset();g=g.outerWidth();a(this).css({left:(l.left+g)*p.tool_scale,top:l.top})})},ra=function(g){a.each(g,function(l,F){var G=a(l).children(),P=l+"_show",T=a(P),Y=false;G.addClass("tool_button").unbind("click mousedown mouseup").each(function(la){var ha=
F[la];Za[ha.sel]=ha.fn;if(ha.isDefault)Y=la;la=function(ma){var sa=ha;if(ma.type==="keydown"){var Ga=a(sa.parent+"_show").hasClass("tool_button_current"),V=a(sa.parent+"_show").attr("data-curopt");a.each(g[ha.parent],function(wa,Ia){if(Ia.sel==V)sa=!ma.shiftKey||!Ga?Ia:g[ha.parent][wa+1]||g[ha.parent][0]})}if(a(this).hasClass("disabled"))return false;La(P)&&sa.fn();var Ea;Ea=sa.icon?a.getSvgIcon(sa.icon,true):a(sa.sel).children().eq(0).clone();Ea[0].setAttribute("width",T.width());Ea[0].setAttribute("height",
T.height());T.children(":not(.flyout_arrow_horiz)").remove();T.append(Ea).attr("data-curopt",sa.sel)};a(this).mouseup(la);ha.key&&a(document).bind("keydown",ha.key[0]+" shift+"+ha.key[0],la)});if(Y)T.attr("data-curopt",F[Y].sel);else T.attr("data-curopt")||T.attr("data-curopt",F[0].sel);var fa,ja=a(P).position();T.mousedown(function(la){if(T.hasClass("disabled"))return false;var ha=a(l),ma=ja.left+34,sa=ha.width()*-1,Ga=ha.data("shown_popop")?200:0;fa=setTimeout(function(){T.data("isLibrary")?ha.css("left",
ma).show():ha.css("left",sa).show().animate({left:ma},150);ha.data("shown_popop",true)},Ga);la.preventDefault()}).mouseup(function(){clearTimeout(fa);var la=a(this).attr("data-curopt");if(T.data("isLibrary")&&a(P.replace("_show","")).is(":visible"))La(P,true);else La(P)&&Za[la]&&Za[la]()})});Ha();Ka()},Db=function(g,l){return a("<div>",{"class":"tools_flyout",id:g}).appendTo("#svg_editor").append(l)},Mb=function(){var g,l=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,F=document.getElementsByTagName("script")[0];
for(g in F.style)if(l.test(g))return g.match(l)[0];if("WebkitOpacity"in F.style)return"Webkit";if("KhtmlOpacity"in F.style)return"Khtml";return""}(),gc=function(g,l){var F=["top","left","bottom","right"];g.each(function(){var G,P=a(this),T=P.outerWidth()*(l-1),Y=P.outerHeight()*(l-1);for(G=0;G<4;G++){var fa=F[G],ja=P.data("orig_margin-"+fa);if(ja==null){ja=parseInt(P.css("margin-"+fa),10);P.data("orig_margin-"+fa,ja)}ja=ja*l;if(fa==="right")ja+=T;else if(fa==="bottom")ja+=Y;P.css("margin-"+fa,ja)}})},
Yb=p.setIconSize=function(g){var l=a("#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout"),F=1;F=typeof g==="number"?g:{s:0.75,m:1,l:1.25,xl:1.5}[g];p.tool_scale=F;Ka();var G=l.parents(":hidden");G.css("visibility","hidden").show();gc(l,F);G.css("visibility","visible").hide();a.pref("iconsize",g);a("#iconsize").val(g);G={"#tools_top":{left:50+a("#main_button").width(),
height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}};l=a("#tool_size_rules");if(l.length)l.empty();else l=a('<style id="tool_size_rules"></style>').appendTo("head");if(g!=="m"){var P="";a.each(G,function(T,Y){T="#svg_editor "+T.replace(/,/g,", #svg_editor");P+=T+"{";a.each(Y,function(fa,ja){var la;if(typeof ja==="number")la=ja*F+"px";else if(ja[g]||ja.all)la=ja[g]||ja.all;P+=fa+":"+la+";"});P+="}"});G="-"+Mb.toLowerCase()+"-";P+="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout{"+
G+"transform: scale("+F+");} #svg_editor div.toolset .toolset {"+G+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+G+"transform: scale("+1/F+");}";l.text(P)}Ka()},fb=function(g,l,F,G){var P=a(g);l=a(l);var T=false,Y=G.dropUp;Y&&a(g).addClass("dropup");l.find("li").bind("mouseup",function(){if(G.seticon){db("#cur_"+P[0].id,a(this).children());a(this).addClass("current").siblings().removeClass("current")}F.apply(this,arguments)});a(window).mouseup(function(){if(!T){P.removeClass("down");
l.hide();l.css({top:0,left:0})}T=false});P.bind("mousedown",function(){var fa=P.offset();if(Y){fa.top-=l.height();fa.left+=8}else fa.top+=P.height();l.offset(fa);if(P.hasClass("down")){l.hide();l.css({top:0,left:0})}else{l.show();T=true}P.toggleClass("down")}).hover(function(){T=true}).mouseout(function(){T=false});G.multiclick&&l.mousedown(function(){T=true})},xa=[],gb=function(g,l,F){l={alpha:l};if(g.indexOf("url(#")===0){g=(g=c.getRefElem(g))?g.cloneNode(true):a("#"+F+"_color defs *")[0];l[g.tagName]=
g}else l.solidColor=g.indexOf("#")===0?g.substr(1):"none";return new a.jGraduate.Paint(l)};a("#text").focus(function(){});a("#text").blur(function(){});c.bind("selected",function(g,l){var F=c.getMode();F==="select"&&jb();F=F=="pathedit";na=l.length===1||l[1]==null?l[0]:null;Qa=l.length>=2&&l[1]!=null;if(na!=null)if(!F){var G,P;if(na!=null)switch(na.tagName){case "use":case "image":case "foreignObject":break;case "g":case "a":var T=null,Y=na.getElementsByTagName("*");G=0;for(P=Y.length;G<P;G++){var fa=
Y[G].getAttribute("stroke-width");if(G===0)T=fa;else if(T!==fa)T=null}a("#stroke_width").val(T===null?"":T);Na.fill.update(true);Na.stroke.update(true);break;default:Na.fill.update(true);Na.stroke.update(true);a("#stroke_width").val(na.getAttribute("stroke-width")||1);a("#stroke_style").val(na.getAttribute("stroke-dasharray")||"none");G=na.getAttribute("stroke-linejoin")||"miter";a("#linejoin_"+G).length!=0&&r(a("#linejoin_"+G)[0]);G=na.getAttribute("stroke-linecap")||"butt";a("#linecap_"+G).length!=
0&&r(a("#linecap_"+G)[0])}if(na!=null){G=(na.getAttribute("opacity")||1)*100;a("#group_opacity").val(G);a("#opac_slider").slider("option","value",G);a("#elem_id").val(na.id)}ub()}Da(F,l);Ta();c.runExtensions("selectedChanged",{elems:l,selectedElement:na,multiselected:Qa})});c.bind("transition",function(g,l){var F=c.getMode(),G=l[0];if(G){Qa=l.length>=2&&l[1]!=null;if(!Qa)switch(F){case "rotate":F=c.getRotationAngle(G);a("#angle").val(F);a("#tool_reorient").toggleClass("disabled",F===0)}c.runExtensions("elementTransition",
{elems:l})}});c.bind("changed",function(g,l){var F,G=c.getMode();G==="select"&&jb();for(F=0;F<l.length;++F){var P=l[F];if(P&&P.tagName==="svg"){ya();Ya()}else if(P&&na&&na.parentNode==null)na=P}p.showSaveWarning=true;Ta();if(na&&G==="select"){Na.fill.update();Na.stroke.update()}c.runExtensions("elementChanged",{elems:l})});c.bind("saved",function(g,l){p.showSaveWarning=false;l='<?xml version="1.0"?>\n'+l;if(svgedit.browser.isIE())Kb(0,true);else{var F=g.open("data:image/svg+xml;base64,"+n.encode64(l)),
G=a.pref("save_notice_done");if(G!=="all"){var P=t.notification.saveFromBrowser.replace("%s","SVG");if(svgedit.browser.isGecko())if(l.indexOf("<defs")!==-1){P+="\n\n"+t.notification.defsFailOnSave;a.pref("save_notice_done","all");G="all"}else a.pref("save_notice_done","part");else a.pref("save_notice_done","all");G!=="part"&&F.alert(P)}}});c.bind("exported",function(g,l){var F=l.issues,G=l.exportWindowName;if(G)qa=window.open("",G);qa.location.href=l.datauri;if(a.pref("export_notice_done")!=="all"){G=
t.notification.saveFromBrowser.replace("%s",l.type);if(F.length)G+="\n\n"+t.notification.noteTheseIssues+"\n \u2022 "+F.join("\n \u2022 ");a.pref("export_notice_done","all");qa.alert(G)}});c.bind("exportedPDF",function(g,l){var F=l.exportWindowName;if(F)qa=window.open("",F);qa.location.href=l.dataurlstring});c.bind("zoomed",ob);c.bind("contextset",function(g,l){var F="";if(l){var G="";F='<a href="#" data-root="y">'+c.getCurrentDrawing().getCurrentLayerName()+"</a>";a(l).parentsUntil("#svgcontent > g").andSelf().each(function(){if(this.id){G+=
" > "+this.id;F+=this!==l?' > <a href="#">'+this.id+"</a>":" > "+this.id}});va=G}else va=null;a("#cur_context_panel").toggle(!!l).html(F);Lb()});c.bind("extension_added",function(g,l){function F(){if(Ib){clearTimeout(Ib);Ib=null}P||(Ib=setTimeout(function(){P=true;Yb(a.pref("iconsize"))},50))}if(l){var G=false,P=false,T=true;if(l.langReady)if(p.langChanged){var Y=a.pref("lang");l.langReady({lang:Y,uiStrings:t})}else xa.push(l);var fa=function(){if(l.callback&&!G&&T){G=true;l.callback()}},ja=[];l.context_tools&&
a.each(l.context_tools,function(Ga,V){var Ea,wa=V.container_id?' id="'+V.container_id+'"':"",Ia=a("#"+V.panel);Ia.length||(Ia=a("<div>",{id:V.panel}).appendTo("#tools_top"));switch(V.type){case "tool_button":Ea='<div class="tool_button">'+V.id+"</div>";var Ra=a(Ea).appendTo(Ia);V.events&&a.each(V.events,function(Oa,Ja){a(Ra).bind(Oa,Ja)});break;case "select":Ea="<label"+wa+'><select id="'+V.id+'">';a.each(V.options,function(Oa,Ja){Ea+='<option value="'+Oa+'"'+(Oa==V.defval?" selected":"")+">"+Ja+
"</option>"});Ea+="</select></label>";var Fa=a(Ea).appendTo(Ia).find("select");a.each(V.events,function(Oa,Ja){a(Fa).bind(Oa,Ja)});break;case "button-select":Ea='<div id="'+V.id+'" class="dropdown toolset" title="'+V.title+'"><div id="cur_'+V.id+'" class="icon_label"></div><button></button></div>';wa=a('<ul id="'+V.id+'_opts"></ul>').appendTo("#option_lists");V.colnum&&wa.addClass("optcols"+V.colnum);a(Ea).appendTo(Ia).children();ja.push({elem:"#"+V.id,list:"#"+V.id+"_opts",title:V.title,callback:V.events.change,
cur:"#cur_"+V.id});break;case "input":Ea="<label"+wa+'><span id="'+V.id+'_label">'+V.label+':</span><input id="'+V.id+'" title="'+V.title+'" size="'+(V.size||"4")+'" value="'+(V.defval||"")+'" type="text"/></label>';var Sa=a(Ea).appendTo(Ia).find("input");V.spindata&&Sa.SpinButton(V.spindata);V.events&&a.each(V.events,function(Oa,Ja){Sa.bind(Oa,Ja)})}});if(l.buttons){var la={},ha={},ma=l.svgicons,sa={};a.each(l.buttons,function(Ga,V){var Ea,wa,Ia,Ra=V.id;for(wa=Ga;a("#"+Ra).length;)Ra=V.id+"_"+ ++wa;
if(ma){la[Ra]=V.icon;wa=V.svgicon||V.id;if(V.type=="app_menu")ha["#"+Ra+" > div"]=wa;else ha["#"+Ra]=wa}else Ea=a('<img src="'+V.icon+'">');var Fa,Sa;switch(V.type){case "mode_flyout":case "mode":Fa="tool_button";Sa="#tools_left";break;case "context":Fa="tool_button";Sa="#"+V.panel;a(Sa).length||a("<div>",{id:V.panel}).appendTo("#tools_top");break;case "app_menu":Fa="";Sa="#main_menu ul"}var Oa,Ja,Wa=a(V.list||V.type=="app_menu"?"<li/>":"<div/>").attr("id",Ra).attr("title",V.title).addClass(Fa);if(!V.includeWith&&
!V.list){if("position"in V)a(Sa).children().eq(V.position).length?a(Sa).children().eq(V.position).before(Wa):a(Sa).children().last().before(Wa);else Wa.appendTo(Sa);if(V.type=="mode_flyout"){Ja=a(Wa);Fa=Ja.parent();if(!Ja.parent().hasClass("tools_flyout")){Ia=Ja[0].id.replace("tool_","tools_");wa=Ja.clone().attr("id",Ia+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ja.before(wa);Fa=Db(Ia,Ja);Fa.data("isLibrary",true);wa.data("isLibrary",true)}ha["#"+Ia+"_show"]=V.id;Ia=sa["#"+Fa[0].id]=
[{sel:"#"+Ra,fn:V.events.click,icon:V.id,isDefault:true},Oa]}else V.type=="app_menu"&&Wa.append("<div>").append(V.title)}else if(V.list){Wa.addClass("push_button");a("#"+V.list+"_opts").append(Wa);if(V.isDefault){a("#cur_"+V.list).append(Wa.children().clone());wa=V.svgicon||V.id;ha["#cur_"+V.list]=wa}}else if(V.includeWith){Sa=V.includeWith;Ja=a(Sa.button);Fa=Ja.parent();if(!Ja.parent().hasClass("tools_flyout")){Ia=Ja[0].id.replace("tool_","tools_");wa=Ja.clone().attr("id",Ia+"_show").append(a("<div>",
{"class":"flyout_arrow_horiz"}));Ja.before(wa);Fa=Db(Ia,Ja)}Oa=Jb.getButtonData(Sa.button);if(Sa.isDefault)ha["#"+Ia+"_show"]=V.id;Ia=sa["#"+Fa[0].id]=[{sel:"#"+Ra,fn:V.events.click,icon:V.id,key:V.key,isDefault:V.includeWith?V.includeWith.isDefault:0},Oa];Ra="position"in Sa?Sa.position:"last";Oa=Fa.children().length;if(!isNaN(Ra)&&Ra>=0&&Ra<Oa)Fa.children().eq(Ra).before(Wa);else{Fa.append(Wa);Ia.reverse()}}ma||Wa.append(Ea);V.list||a.each(V.events,function(bc,cc){if(bc=="click"&&V.type=="mode"){V.includeWith?
Wa.bind(bc,cc):Wa.bind(bc,function(){La(Wa)&&cc()});if(V.key){a(document).bind("keydown",V.key,cc);V.title&&Wa.attr("title",V.title+" ["+V.key+"]")}}else Wa.bind(bc,cc)});ra(sa)});a.each(ja,function(){fb(this.elem,this.list,this.callback,{seticon:true})});if(ma)T=false;a.svgIcons(ma,{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback:la,placement:ha,callback:function(){a.pref("iconsize")!=="m"&&F();T=true;fa()}})}fa()}});c.textActions.setInputElem(a("#text")[0]);var $a='<div class="palette_item" data-rgb="none"></div>';
a.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff","#aaaaff","#d4aaff","#ffaaff","#ffaad4"],function(g,l){$a+='<div class="palette_item" style="background-color: '+l+';" data-rgb="'+
l+'"></div>'});a("#palette").append($a);$a="";a.each(["#FFF","#888","#000"],function(){$a+='<div class="color_block" style="background-color:'+this+';"></div>'});a("#bg_blocks").append($a);var Eb=a("#bg_blocks div");Eb.each(function(){a(this).click(function(){Eb.removeClass("cur_background");a(this).addClass("cur_background")})});O(a.pref("bkgd_color"),a.pref("bkgd_url"));a("#image_save_opts input").val([a.pref("img_save")]);var vb=function(g,l){if(l==null)l=g.value;a("#group_opacity").val(l);if(!g||
!g.handle)a("#opac_slider").slider("option","value",l);c.setOpacity(l/100)},Pb=function(g,l,F){if(l==null)l=g.value;a("#blur").val(l);var G=false;if(!g||!g.handle){a("#blur_slider").slider("option","value",l);G=true}F?c.setBlurNoUndo(l):c.setBlur(l,G)};a("#stroke_style").change(function(){c.setStrokeAttr("stroke-dasharray",a(this).val());hb()});a("#stroke_linejoin").change(function(){c.setStrokeAttr("stroke-linejoin",a(this).val());hb()});a("select").change(function(){a(this).blur()});var Qb=false;
a("#selLayerNames").change(function(){var g=this.options[this.selectedIndex].value,l=t.notification.QmoveElemsToLayer.replace("%s",g),F=function(G){if(G){Qb=true;c.moveSelectedToLayer(g);c.clearSelection();ya()}};if(g)Qb?F(true):a.confirm(l,F)});a("#font_family").change(function(){c.setFontFamily(this.value)});a("#seg_type").change(function(){c.setSegType(a(this).val())});a("#text").keyup(function(){c.setTextContent(this.value)});a("#image_url").change(function(){Bb(this.value)});a("#link_url").change(function(){this.value.length?
c.setLinkURL(this.value):c.removeHyperlink()});a("#g_title").change(function(){c.setGroupTitle(this.value)});a(".attr_changer").change(function(){var g=this.getAttribute("data-attr"),l=this.value;if(!svgedit.units.isValidUnit(g,l,na)){a.alert(t.notification.invalidAttrValGiven);this.value=na.getAttribute(g);return false}if(g!=="id")if(isNaN(l))l=c.convertToNum(g,l);else if(A.baseUnit!=="px"){var F=svgedit.units.getTypeMap();if(na[g]||c.getMode()==="pathedit"||g==="x"||g==="y")l*=F[A.baseUnit]}if(g===
"id"){g=na;c.clearSelection();g.id=l;c.addToSelection([g],true)}else c.changeSelectedAttribute(g,l);this.blur()});a("#palette").mouseover(function(){var g=a('<input type="hidden">');a(this).append(g);g.focus().remove()});a(".palette_item").mousedown(function(g){g=g.shiftKey||g.button===2?"stroke":"fill";var l=a(this).data("rgb"),F;if(l==="none"||l==="transparent"||l==="initial"){l="none";F=new a.jGraduate.Paint}else F=new a.jGraduate.Paint({alpha:100,solidColor:l.substr(1)});Na[g].setPaint(F);c.setColor(g,
l);l!=="none"&&c.getPaintOpacity(g)!==1&&c.setPaintOpacity(g,1);ub()}).bind("contextmenu",function(g){g.preventDefault()});a("#toggle_stroke_tools").on("click",function(){a("#tools_bottom").toggleClass("expanded")});(function(){var g=null,l=null,F=W[0],G=false,P=false;a("#svgcanvas").bind("mousemove mouseup",function(T){if(G!==false){F.scrollLeft-=T.clientX-g;F.scrollTop-=T.clientY-l;g=T.clientX;l=T.clientY;if(T.type==="mouseup")G=false;return false}}).mousedown(function(T){if(T.button===1||P===true){G=
true;g=T.clientX;l=T.clientY;return false}});a(window).mouseup(function(){G=false});a(document).bind("keydown","space",function(T){c.spaceKey=P=true;T.preventDefault()}).bind("keyup","space",function(T){T.preventDefault();c.spaceKey=P=false}).bind("keydown","shift",function(){c.getMode()==="zoom"&&W.css("cursor",Tb)}).bind("keyup","shift",function(){c.getMode()==="zoom"&&W.css("cursor",qb)});p.setPanning=function(T){c.spaceKey=P=T}})();(function(){var g=a("#main_icon"),l=a("#main_icon span"),F=a("#main_menu"),
G=false,P=0,T=true,Y=false;a(window).mouseup(function(ja){if(!G){g.removeClass("buttondown");if(ja.target.tagName!="INPUT")F.fadeOut(200);else if(!Y){Y=true;a(ja.target).click(function(){F.css("margin-left","-9999px").show()})}}G=false}).mousedown(function(ja){a(ja.target).closest("div.tools_flyout, .contextMenu").length||a(".tools_flyout:visible,.contextMenu").fadeOut(250)});l.bind("mousedown",function(){if(g.hasClass("buttondown"))F.fadeOut(200);else{F.css("margin-left",0).show();P||(P=F.height());
F.css("height",0).animate({height:P},200);G=true}g.toggleClass("buttondown buttonup")}).hover(function(){G=true}).mouseout(function(){G=false});var fa=a("#main_menu li");fa.mouseover(function(){T=a(this).css("background-color")=="rgba(0, 0, 0, 0)";fa.unbind("mouseover");T&&fa.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){this.style.backgroundColor="transparent";return true})})})();p.addDropDown=function(g,l,F){if(a(g).length!=0){var G=a(g).find("button"),P=a(g).find("ul").attr("id",
a(g)[0].id+"-list"),T=false;F?a(g).addClass("dropup"):a("#option_lists").append(P);P.find("li").bind("mouseup",l);a(window).mouseup(function(){if(!T){G.removeClass("down");P.hide()}T=false});G.bind("mousedown",function(){if(G.hasClass("down"))P.hide();else{if(!F){var Y=a(g).position();P.css({top:Y.top+24,left:Y.left-10})}P.show();T=true}G.toggleClass("down")}).hover(function(){T=true}).mouseout(function(){T=false})}};p.addDropDown("#font_family_dropdown",function(){a("#font_family").val(a(this).text()).change()});
p.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var g=parseInt(a(this).text().split("%")[0],10);vb(false,g)}},true);a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},stop:function(){a("#opacity_dropdown li").show();a(window).mouseup()},slide:function(g,l){vb(l)}});p.addDropDown("#blur_dropdown",a.noop);var zb=false;a("#blur_slider").slider({max:10,step:0.1,stop:function(g,l){zb=false;Pb(l);a("#blur_dropdown li").show();a(window).mouseup()},
start:function(){zb=true},slide:function(g,l){Pb(l,null,zb)}});p.addDropDown("#zoom_dropdown",function(){var g=a(this),l=g.data("val");l?ob(window,l):bb({value:parseFloat(g.text())})},true);fb("#stroke_linecap","#linecap_opts",function(){r(this,true)},{dropUp:true});fb("#stroke_linejoin","#linejoin_opts",function(){r(this,true)},{dropUp:true});fb("#tool_position","#position_opts",function(){var g=this.id.replace("tool_pos","").charAt(0);c.alignSelectedElements(g,"page")},{multiclick:true});(function(){var g,
l=function(){a(g).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){g=this;rb="toolbars";W.mousedown(l)}).blur(function(){rb="canvas";W.unbind("mousedown",l);c.getMode()=="textedit"&&a("#text").focus()})})();var Wb=function(){La("#tool_fhpath")&&c.setMode("fhpath")},Zb=function(){La("#tool_line")&&c.setMode("line")},wb=function(){La("#tool_square")&&c.setMode("square")},Ob=function(){La("#tool_rect")&&c.setMode("rect")},hc=function(){La("#tool_fhrect")&&c.setMode("fhrect")},
sb=function(){La("#tool_circle")&&c.setMode("circle")},ic=function(){La("#tool_ellipse")&&c.setMode("ellipse")},ac=function(){La("#tool_fhellipse")&&c.setMode("fhellipse")},$b=function(){La("#tool_image")&&c.setMode("image")},xb=function(){if(La("#tool_zoom")){c.setMode("zoom");W.css("cursor",qb)}},Ma=function(g){var l=c.getResolution();g=g?l.zoom*g:1;a("#zoom").val(g*100);c.setZoom(g);Ub();Ya(true)},Vb=function(){if(La("#tool_zoom")){Ma();jb()}},b=function(){La("#tool_text")&&c.setMode("text")},
e=function(){La("#tool_path")&&c.setMode("path")},d=function(){if(na!=null||Qa)c.deleteSelectedElements()},q=function(){if(na!=null||Qa)c.cutSelectedElements()},j=function(){if(na!=null||Qa)c.copySelectedElements()},C=function(){var g=c.getZoom(),l=(W[0].scrollLeft+W.width()/2)/g-c.contentW;g=(W[0].scrollTop+W.height()/2)/g-c.contentH;c.pasteElements("point",l,g)},o=function(){na!=null&&c.moveToTopSelectedElement()},w=function(){na!=null&&c.moveToBottomSelectedElement()},B=function(g){na!=null&&c.moveUpDownSelected(g)},
H=function(){na!=null&&c.convertToPath()},K=function(){na!=null&&Ua.reorient()},D=function(){if(na!=null||Qa)a.prompt(t.notification.enterNewLinkURL,"http://",function(g){g&&c.makeHyperlink(g)})},N=function(g,l){if(na!=null||Qa){if(A.gridSnapping){var F=c.getZoom()*A.snappingStep;g*=F;l*=F}c.moveSelectedElements(g,l)}},S=function(){a("#tool_node_link").toggleClass("push_button_pressed tool_button");var g=a("#tool_node_link").hasClass("push_button_pressed");Ua.linkControlPoints(g)},U=function(){Ua.getNodePoint()&&
Ua.clonePathNode()},X=function(){Ua.getNodePoint()&&Ua.deletePathNode()},da=function(){var g=a("#tool_add_subpath"),l=!g.hasClass("push_button_pressed");g.toggleClass("push_button_pressed tool_button");Ua.addSubPath(l)},R=function(){Ua.opencloseSubPath()},L=function(){c.cycleElement(1)},I=function(){c.cycleElement(0)},M=function(g,l){if(!(na==null||Qa)){g||(l*=-1);var F=parseFloat(a("#angle").val())+l;c.setRotationAngle(F);Ta()}},Q=function(){var g=A.dimensions;a.confirm(t.notification.QwantToClear,
function(l){if(l){jb();c.clear();c.setResolution(g[0],g[1]);Ya(true);Ma();ya();Ta();Na.fill.prep();Na.stroke.prep();c.runExtensions("onNewDocument")}})},aa=function(){c.setBold(!c.getBold());Ta();return false},ga=function(){c.setItalic(!c.getItalic());Ta();return false},oa=function(){a.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP","PDF"],function(g){function l(){var P=t.notification.loadingImage;A.exportWindowType==="new"&&p.exportWindowCt++;F=A.canvasName+p.exportWindowCt;
qa=window.open("data:text/html;charset=utf-8,"+encodeURIComponent("<title>"+P+"</title><h1>"+P+"</h1>"),F)}if(g){var F;if(g==="PDF"){k||l();c.exportPDF(F)}else{m||l();var G=parseInt(a("#image-slider").val(),10)/100;c.rasterExport(g,G,F)}}},function(){var g=a(this);if(g.val()==="JPEG"||g.val()==="WEBP")a("#image-slider").length||a('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(g.parent());else a("#image-slider").parent().remove()})},
za=function(){c.open()},ca=function(){},ta=function(){if(ib.getUndoStackSize()>0){ib.undo();ya()}},Aa=function(){if(ib.getRedoStackSize()>0){ib.redo();ya()}},ab=function(){if(Qa)c.groupSelectedElements();else na&&c.ungroupSelectedElement()},pb=function(){c.cloneSelectedElements(20,20)},Fb=function(){var g=this.id.replace("tool_align","").charAt(0);c.alignSelectedElements(g,a("#align_relative_to").val())},Nb=function(){a("#tool_wireframe").toggleClass("push_button_pressed tool_button");W.toggleClass("wireframe");
if(!Sb){var g=a("#wireframe_rules");g.length?g.empty():a('<style id="wireframe_rules"></style>').appendTo("head");Ub()}};a("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var Gb=function(){if(!Ba){Ba=true;a("#image_save_opts input").val([a.pref("img_save")]);var g=c.getResolution();if(A.baseUnit!=="px"){g.w=svgedit.units.convertUnit(g.w)+A.baseUnit;g.h=svgedit.units.convertUnit(g.h)+A.baseUnit}a("#canvas_width").val(g.w);a("#canvas_height").val(g.h);
a("#canvas_title").val(c.getDocumentTitle());a("#svg_docprops").show()}},xc=function(){if(!nb){nb=true;a("#main_menu").hide();var g=a("#bg_blocks div"),l=E.bkgd_color,F=a.pref("bkgd_url");g.each(function(){var G=a(this),P=G.css("background-color")==l;G.toggleClass("cur_background",P);P&&a("#canvas_bg_url").removeClass("cur_background")});l||g.eq(0).addClass("cur_background");F&&a("#canvas_bg_url").val(F);a("#grid_snapping_on").prop("checked",A.gridSnapping);a("#grid_snapping_step").attr("value",A.snappingStep);
a("#grid_color").attr("value",A.gridColor);a("#svg_prefs").show()}},jc=function(){a("#svg_source_editor").hide();Xa=false;a("#svg_source_textarea").blur()},oc=function(){if(Xa){var g=function(){c.clearSelection();jc();Ma();ya();Lb();Na.fill.prep();Na.stroke.prep()};c.setSvgString(a("#svg_source_textarea").val())?g():a.confirm(t.notification.QerrorsRevertToSource,function(l){if(!l)return false;g()});jb()}},pc=function(){a("#svg_docprops").hide();a("#canvas_width,#canvas_height").removeAttr("disabled");
a("#resolution")[0].selectedIndex=0;a("#image_save_opts input").val([a.pref("img_save")]);Ba=false},qc=function(){a("#svg_prefs").hide();nb=false},yc=function(){var g=a("#canvas_title").val();Lb(g);c.setDocumentTitle(g);g=a("#canvas_width");var l=g.val(),F=a("#canvas_height"),G=F.val();if(l!="fit"&&!svgedit.units.isValidUnit("width",l)){a.alert(t.notification.invalidAttrValGiven);g.parent().addClass("error");return false}g.parent().removeClass("error");if(G!="fit"&&!svgedit.units.isValidUnit("height",
G)){a.alert(t.notification.invalidAttrValGiven);F.parent().addClass("error");return false}F.parent().removeClass("error");if(!c.setResolution(l,G)){a.alert(t.notification.noContentToFitTo);return false}a.pref("img_save",a("#image_save_opts :checked").val());Ya();pc()},zc=p.savePreferences=function(){var g=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";O(g,a("#canvas_bg_url").val());g=a("#lang_select").val();g!==a.pref("lang")&&p.putLocale(g,mb);Yb(a("#iconsize").val());A.gridSnapping=
a("#grid_snapping_on")[0].checked;A.snappingStep=a("#grid_snapping_step").val();A.gridColor=a("#grid_color").val();A.showRulers=a("#show_rulers")[0].checked;a("#rulers").toggle(A.showRulers);A.showRulers&&ka();A.baseUnit=a("#base_unit").val();c.setConfig(A);Ya();qc()},dc=a.noop,rc=function(){a("#dialog_box").hide();if(!Xa&&!Ba&&!nb)va&&c.leaveContext();else{if(Xa)Ab!==a("#svg_source_textarea").val()?a.confirm(t.notification.QignoreSourceChanges,function(g){g&&jc()}):jc();else if(Ba)pc();else nb&&
qc();dc()}},sc={width:a(window).width(),height:a(window).height()};svgedit.browser.isIE()&&function(){dc=function(){if(W[0].scrollLeft===0&&W[0].scrollTop===0){W[0].scrollLeft=yb.left;W[0].scrollTop=yb.top}};yb={left:W[0].scrollLeft,top:W[0].scrollTop};a(window).resize(dc);p.ready(function(){setTimeout(function(){dc()},500)});W.scroll(function(){yb={left:W[0].scrollLeft,top:W[0].scrollTop}})}();a(window).resize(function(){a.each(sc,function(g,l){var F=a(window)[g]();W[0]["scroll"+(g==="width"?"Left":
"Top")]-=(F-l)/2;sc[g]=F});Ka()});(function(){W.scroll(function(){if(a("#ruler_x").length!=0)a("#ruler_x")[0].scrollLeft=W[0].scrollLeft;if(a("#ruler_y").length!=0)a("#ruler_y")[0].scrollTop=W[0].scrollTop})})();a("#url_notice").click(function(){a.alert(this.title)});a("#change_image_url").click(Z);(function(){var g="";a.each(["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],function(l,F){g+=(l?",":"")+"#tool_"+F});a(g).mousedown(function(){a(this).addClass("tool_button_current")}).bind("mousedown mouseout",
function(){a(this).removeClass("tool_button_current")});a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")})})();if(svgedit.browser.isMac()&&!window.opera){var ec=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(ua=ec.length;ua--;){var kc=document.getElementById(ec[ua]);if(kc){var lc=kc.title,tc=lc.indexOf("Ctrl+");kc.title=
[lc.substr(0,tc),"Cmd+",lc.substr(tc+5)].join("")}}}var uc=function(g){var l=g.attr("id")=="stroke_color"?"stroke":"fill",F=Na[l].paint,G=l=="stroke"?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity";g=g.offset();a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(A.colorPickerCSS||{left:g.left-140,bottom:40}).jGraduate({paint:F,window:{pickerTitle:G},images:{clientPath:A.jGraduatePath},newstop:"inverse"},
function(P){F=new a.jGraduate.Paint(P);Na[l].setPaint(F);c.setPaint(l,F);a("#color_picker").hide()},function(){a("#color_picker").hide()})};ua=function(g,l){var F,G,P=A[l==="fill"?"initFill":"initStroke"],T=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"\t\t\t\t\tfill="#'+P.color+'" opacity="'+P.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml").documentElement;T=a(g)[0].appendChild(document.importNode(T,
true));T.setAttribute("width",16.5);this.rect=T.firstChild;this.defs=T.getElementsByTagName("defs")[0];this.grad=this.defs.firstChild;this.paint=new a.jGraduate.Paint({solidColor:P.color});this.type=l;this.setPaint=function(Y,fa){this.paint=Y;var ja="none",la=Y.type,ha=Y.alpha/100;switch(la){case "solidColor":ja=Y[la]!="none"?"#"+Y[la]:Y[la];break;case "linearGradient":case "radialGradient":this.defs.removeChild(this.grad);this.grad=this.defs.appendChild(Y[la]);ja="url(#"+(this.grad.id="gradbox_"+
this.type)+")"}this.rect.setAttribute("fill",ja);this.rect.setAttribute("opacity",ha);if(fa){c.setColor(this.type,F,true);c.setPaintOpacity(this.type,G,true)}};this.update=function(Y){if(na){var fa,ja,la=this.type;switch(na.tagName){case "use":case "image":case "foreignObject":return;case "g":case "a":var ha=null,ma=na.getElementsByTagName("*");fa=0;for(ja=ma.length;fa<ja;fa++){var sa=ma[fa].getAttribute(la);if(fa===0)ha=sa;else if(ha!==sa){ha=null;break}}if(ha===null){F=null;return}F=ha;G=1;break;
default:G=parseFloat(na.getAttribute(la+"-opacity"));if(isNaN(G))G=1;fa=la==="fill"?"black":"none";F=na.getAttribute(la)||fa}if(Y){c.setColor(la,F,true);c.setPaintOpacity(la,G,true)}G*=100;this.setPaint(gb(F,G,la))}};this.prep=function(){switch(this.paint.type){case "linearGradient":case "radialGradient":var Y=new a.jGraduate.Paint({copy:this.paint});c.setPaint(l,Y)}}};Na.fill=new ua("#fill_color","fill");Na.stroke=new ua("#stroke_color","stroke");a("#stroke_width").val(A.initStroke.width);a("#group_opacity").val(A.initOpacity*
100);ua=Na.fill.rect.cloneNode(false);ua.setAttribute("style","vector-effect:non-scaling-stroke");Sb=ua.style.vectorEffect==="non-scaling-stroke";ua.removeAttribute("style");ua=Na.fill.rect.ownerDocument.createElementNS(svgedit.NS.SVG,"feGaussianBlur");ua.stdDeviationX===undefined&&a("#tool_blur").hide();a(ua).remove();(function(){var g="-"+Mb.toLowerCase()+"-zoom-",l=g+"in";W.css("cursor",l);if(W.css("cursor")===l){qb=l;Tb=g+"out"}W.css("cursor","auto")})();setTimeout(function(){c.embedImage("images/logo.png",
function(g){if(!g){a("#image_save_opts [value=embed]").attr("disabled","disabled");a("#image_save_opts input").val(["ref"]);a.pref("img_save","ref");a("#image_opt_embed").css("color","#666").attr("title",t.notification.featNotSupported)}})},1E3);a("#fill_color, #tool_fill .icon_label").click(function(){uc(a("#fill_color"));ub()});a("#stroke_color, #tool_stroke .icon_label").click(function(){uc(a("#stroke_color"));ub()});a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown();
a(window).mouseup()});a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown();a(window).mouseup()});a("#tool_move_top").mousedown(function(g){a("#tools_stacking").show();g.preventDefault()});a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")});a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")});
a("#layer_new").click(function(){var g,l=c.getCurrentDrawing().getNumLayers();do g=t.layers.layer+" "+ ++l;while(c.getCurrentDrawing().hasLayer(g));a.prompt(t.notification.enterUniqueLayerName,g,function(F){if(F)if(c.getCurrentDrawing().hasLayer(F))a.alert(t.notification.dupeLayerName);else{c.createLayer(F);Ta();ya()}})});a("#layer_delete").click(ea);a("#layer_up").click(function(){ia(-1)});a("#layer_down").click(function(){ia(1)});a("#layer_rename").click(function(){var g=a("#layerlist tr.layersel td.layername").text();
a.prompt(t.notification.enterNewLayerName,"",function(l){if(l)if(g==l||c.getCurrentDrawing().hasLayer(l))a.alert(t.notification.layerHasThatName);else{c.renameCurrentLayer(l);ya()}})});var Rb=-1,fc=false,mc=false,vc=function(g){var l=a("#ruler_x");a("#sidepanels").width("+="+g);a("#layerpanel").width("+="+g);l.css("right",parseInt(l.css("right"),10)+g);W.css("right",parseInt(W.css("right"),10)+g);c.runExtensions("workareaResized")},wc=function(g){if(mc)if(Rb!=-1){fc=true;g=Rb-g.pageX;var l=a("#sidepanels").width();
if(l+g>300)g=300-l;else if(l+g<2)g=2-l;if(g!=0){Rb-=g;vc(g)}}},nc=function(g){var l=a("#sidepanels").width();vc((l>2||g?2:150)-l)};a("#sidepanel_handle").mousedown(function(g){Rb=g.pageX;a(window).mousemove(wc);mc=false;setTimeout(function(){mc=true},20)}).mouseup(function(){fc||nc();Rb=-1;fc=false});a(window).mouseup(function(){Rb=-1;fc=false;a("#svg_editor").unbind("mousemove",wc)});ya();a(window).bind("load resize",function(){W.css("line-height",W.height()+"px")});a("#resolution").change(function(){var g=
a("#canvas_width,#canvas_height");if(this.selectedIndex)if(this.value=="content")g.val("fit").attr("disabled","disabled");else{var l=this.value.split("x");a("#canvas_width").val(l[0]);a("#canvas_height").val(l[1]);g.removeAttr("disabled")}else a("#canvas_width").val()=="fit"&&g.removeAttr("disabled").val(100)});a("input,select").attr("autocomplete","off");Jb=function(){var g=[{sel:"#tool_select",fn:Cb,evt:"click",key:["V",true]},{sel:"#tool_fhpath",fn:Wb,evt:"click",key:["Q",true]},{sel:"#tool_line",
fn:Zb,evt:"click",key:["L",true]},{sel:"#tool_rect",fn:Ob,evt:"mouseup",key:["R",true],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:wb,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:hc,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:ic,evt:"mouseup",key:["E",true],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:sb,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:ac,evt:"mouseup",parent:"#tools_ellipse",
icon:"fh_ellipse"},{sel:"#tool_path",fn:e,evt:"click",key:["P",true]},{sel:"#tool_text",fn:b,evt:"click",key:["T",true]},{sel:"#tool_image",fn:$b,evt:"mouseup"},{sel:"#tool_zoom",fn:xb,evt:"mouseup",key:["Z",true]},{sel:"#tool_clear",fn:Q,evt:"mouseup",key:["N",true]},{sel:"#tool_save",fn:function(){if(Xa)oc();else{var F={images:a.pref("img_save"),round_digits:6};c.save(F)}},evt:"mouseup",key:["S",true]},{sel:"#tool_export",fn:oa,evt:"mouseup"},{sel:"#tool_open",fn:za,evt:"mouseup",key:["O",true]},
{sel:"#tool_import",fn:ca,evt:"mouseup"},{sel:"#tool_source",fn:Kb,evt:"click",key:["U",true]},{sel:"#tool_wireframe",fn:Nb,evt:"click",key:["F",true]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:rc,evt:"click",key:["esc",false,false],hidekey:true},{sel:"#tool_source_save",fn:oc,evt:"click"},{sel:"#tool_docprops_save",fn:yc,evt:"click"},{sel:"#tool_docprops",fn:Gb,evt:"mouseup"},{sel:"#tool_prefs_save",fn:zc,evt:"click"},{sel:"#tool_prefs_option",fn:function(){xc();
return false},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:d,evt:"click",key:["del/backspace",true]},{sel:"#tool_reorient",fn:K,evt:"click"},{sel:"#tool_node_link",fn:S,evt:"click"},{sel:"#tool_node_clone",fn:U,evt:"click"},{sel:"#tool_node_delete",fn:X,evt:"click"},{sel:"#tool_openclose_path",fn:R,evt:"click"},{sel:"#tool_add_subpath",fn:da,evt:"click"},{sel:"#tool_move_top",fn:o,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:w,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",
fn:H,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:D,evt:"click"},{sel:"#tool_undo",fn:ta,evt:"click",key:["Z",true]},{sel:"#tool_redo",fn:Aa,evt:"click",key:["Y",true]},{sel:"#tool_clone,#tool_clone_multi",fn:pb,evt:"click",key:["D",true]},{sel:"#tool_group_elements",fn:ab,evt:"click",key:["G",true]},{sel:"#tool_ungroup",fn:ab,evt:"click"},{sel:"#tool_unlink_use",fn:ab,evt:"click"},{sel:"[id^=tool_align]",fn:Fb,evt:"click"},{sel:"#tool_bold",fn:aa,evt:"mousedown"},{sel:"#tool_italic",
fn:ga,evt:"mousedown"},{sel:"#sidepanel_handle",fn:nc,key:["X"]},{sel:"#copy_save_done",fn:rc,evt:"click"},{key:"ctrl+left",fn:function(){M(0,1)}},{key:"ctrl+right",fn:function(){M(1,1)}},{key:"ctrl+shift+left",fn:function(){M(0,5)}},{key:"ctrl+shift+right",fn:function(){M(1,5)}},{key:"shift+O",fn:I},{key:"shift+P",fn:L},{key:[cb+"up",true],fn:function(){Ma(2)}},{key:[cb+"down",true],fn:function(){Ma(0.5)}},{key:[cb+"]",true],fn:function(){B("Up")}},{key:[cb+"[",true],fn:function(){B("Down")}},{key:["up",
true],fn:function(){N(0,-1)}},{key:["down",true],fn:function(){N(0,1)}},{key:["left",true],fn:function(){N(-1,0)}},{key:["right",true],fn:function(){N(1,0)}},{key:"shift+up",fn:function(){N(0,-10)}},{key:"shift+down",fn:function(){N(0,10)}},{key:"shift+left",fn:function(){N(-10,0)}},{key:"shift+right",fn:function(){N(10,0)}},{key:["alt+up",true],fn:function(){c.cloneSelectedElements(0,-1)}},{key:["alt+down",true],fn:function(){c.cloneSelectedElements(0,1)}},{key:["alt+left",true],fn:function(){c.cloneSelectedElements(-1,
0)}},{key:["alt+right",true],fn:function(){c.cloneSelectedElements(1,0)}},{key:["alt+shift+up",true],fn:function(){c.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",true],fn:function(){c.cloneSelectedElements(0,10)}},{key:["alt+shift+left",true],fn:function(){c.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",true],fn:function(){c.cloneSelectedElements(10,0)}},{key:"A",fn:function(){c.selectAllInCurrentLayer()}},{key:cb+"z",fn:ta},{key:cb+"shift+z",fn:Aa},{key:cb+"y",fn:Aa},{key:cb+"x",
fn:q},{key:cb+"c",fn:j},{key:cb+"v",fn:C}],l={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var F={};a.each(g,function(G,P){var T;if(P.sel){T=a(P.sel);if(T.length==0)return true;if(P.evt){if(svgedit.browser.isTouch()&&P.evt==="click")P.evt="mousedown";T[P.evt](P.fn)}if(P.parent&&a(P.parent+"_show").length!=0){var Y=a(P.parent);Y.length||(Y=Db(P.parent.substr(1)));Y.append(T);a.isArray(F[P.parent])||(F[P.parent]=[]);F[P.parent].push(P)}}if(P.key){var fa=
P.fn,ja=false;if(a.isArray(P.key)){Y=P.key[0];if(P.key.length>1)ja=P.key[1]}else Y=P.key;Y+="";a.each(Y.split("/"),function(ha,ma){a(document).bind("keydown",ma,function(sa){fa();ja&&sa.preventDefault();return false})});if(P.sel&&!P.hidekey&&T.attr("title")){var la=T.attr("title").split("[")[0]+" ("+Y+")";l[Y]=P.sel;T.parents("#main_menu").length||T.attr("title",la)}}});ra(F);a(".attr_changer, #image_url").bind("keydown","return",function(G){a(this).change();G.preventDefault()});a(window).bind("keydown",
"tab",function(G){if(rb==="canvas"){G.preventDefault();L()}}).bind("keydown","shift+tab",function(G){if(rb==="canvas"){G.preventDefault();I()}});a("#tool_zoom").dblclick(Vb)},setTitles:function(){a.each(l,function(F,G){var P=a(G).parents("#main_menu").length;a(G).each(function(){var T;T=P?a(this).text().split(" [")[0]:this.title.split(" [")[0];var Y="";a.each(F.split("/"),function(fa,ja){var la=ja.split("+"),ha="";if(la.length>1){ha=la[0]+"+";ja=la[1]}Y+=(fa?"/":"")+ha+(t["key_"+ja]||ja)});if(P)this.lastChild.textContent=
T+" ["+Y+"]";else this.title=T+" ["+Y+"]"})})},getButtonData:function(F){var G;a.each(g,function(P,T){if(T.sel===F)G=T});return G}}}();Jb.setAll();p.ready(function(){var g=A.initTool,l=a("#tools_left, #svg_editor .tools_flyout"),F=l.find("#tool_"+g);g=l.find("#"+g);(F.length?F:g.length?g:a("#tool_select")).click().mouseup();A.wireframe&&a("#tool_wireframe").click();A.showlayers&&nc();a("#rulers").toggle(!!A.showRulers);if(A.showRulers)a("#show_rulers")[0].checked=true;A.baseUnit&&a("#base_unit").val(A.baseUnit);
if(A.gridSnapping)a("#grid_snapping_on")[0].checked=true;A.snappingStep&&a("#grid_snapping_step").val(A.snappingStep);A.gridColor&&a("#grid_color").val(A.gridColor)});a("#rect_rx").SpinButton({min:0,max:1E3,callback:function(g){c.setRectRadius(g.value)}});a("#stroke_width").SpinButton({min:0,max:99,smallStep:0.1,callback:function(g){var l=g.value;if(l==0&&na&&["line","polyline"].indexOf(na.nodeName)>=0)l=g.value=1;c.setStrokeWidth(l)}});a("#angle").SpinButton({min:-180,max:180,step:5,callback:function(g){c.setRotationAngle(g.value);
a("#tool_reorient").toggleClass("disabled",parseInt(g.value,10)===0)}});a("#font_size").SpinButton({min:0.0010,stepfunc:function(g,l){var F=Number(g.value),G=F+l,P=G>=F;if(l===0)return F;if(F>=24){if(P)return Math.round(F*1.1);return Math.round(F/1.1)}if(F<=1){if(P)return F*2;return F/2}return G},callback:function(g){c.setFontSize(g.value)}});a("#group_opacity").SpinButton({min:0,max:100,step:5,callback:vb});a("#blur").SpinButton({min:0,max:10,step:0.1,callback:Pb});a("#zoom").SpinButton({min:0.0010,
max:1E4,step:50,stepfunc:function(g,l){var F=Number(g.value);if(F===0)return 100;var G=F+l;if(l===0)return F;if(F>=100)return G;if(G>=F)return F*2;return F/2},callback:bb}).val(c.getZoom()*100);a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(g){switch(g){case "delete":d();break;case "cut":q();break;case "copy":j();break;case "paste":c.pasteElements();break;case "paste_in_place":c.pasteElements("in_place");break;case "group_elements":c.groupSelectedElements();break;case "ungroup":c.ungroupSelectedElement();
break;case "move_front":o();break;case "move_up":B("Up");break;case "move_down":B("Down");break;case "move_back":w();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(g)&&svgedit.contextmenu.getCustomHandler(g).call()}c.clipBoard.length&&pa.enableContextMenuItems("#paste,#paste_in_place")});ua=function(g){switch(g){case "dupe":ba();break;case "delete":ea();break;case "merge_down":if(a("#layerlist tr.layersel").index()!=c.getCurrentDrawing().getNumLayers()-1){c.mergeLayer();Ta();
ya()}break;case "merge_all":c.mergeAllLayers();Ta();ya()}};a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},ua);a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:true},ua);a(".contextMenu li").mousedown(function(g){g.preventDefault()});a("#cmenu_canvas li").disableContextMenu();pa.enableContextMenuItems("#delete,#cut,#copy");window.addEventListener("beforeunload",function(g){if(ib.getUndoStackSize()===0)p.showSaveWarning=false;if(!A.no_save_warning&&p.showSaveWarning)return g.returnValue=
t.notification.unsavedChanges},false);p.openPrep=function(g){a("#main_menu").hide();ib.getUndoStackSize()===0?g(true):a.confirm(t.notification.QwantToOpen,g)};if(window.FileReader){ua=function(g){a.process_cancel(t.notification.loadingImage);g.stopPropagation();g.preventDefault();a("#workarea").removeAttr("style");a("#main_menu").hide();if(g=g.type=="drop"?g.dataTransfer.files[0]:this.files[0]){if(g.type.indexOf("image")!=-1){var l;if(g.type.indexOf("svg")!=-1){l=new FileReader;l.onloadend=function(F){c.importSvgString(F.target.result,
true);c.ungroupSelectedElement();c.ungroupSelectedElement();c.groupSelectedElements();c.alignSelectedElements("m","page");c.alignSelectedElements("c","page");a("#dialog_box").hide()};l.readAsText(g)}else{l=new FileReader;l.onloadend=function(F){var G=100,P=100,T=new Image;T.src=F.target.result;T.style.opacity=0;T.onload=function(){G=T.offsetWidth;P=T.offsetHeight;var Y=c.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:G,height:P,id:c.getNextId(),style:"pointer-events:inherit"}});c.setHref(Y,
F.target.result);c.selectOnly([Y]);c.alignSelectedElements("m","page");c.alignSelectedElements("c","page");Ta();a("#dialog_box").hide()}};l.readAsDataURL(g)}}}else a("#dialog_box").hide()};W[0].addEventListener("dragenter",Pa,false);W[0].addEventListener("dragover",Ca,false);W[0].addEventListener("dragleave",eb,false);W[0].addEventListener("drop",ua,false);ec=a('<input type="file">').change(function(){var g=this;p.openPrep(function(l){if(l){c.clear();if(g.files.length===1){a.process_cancel(t.notification.loadingImage);
l=new FileReader;l.onloadend=function(F){J(F.target.result);Ya()};l.readAsText(g.files[0])}}})});a("#tool_open").show().prepend(ec);ua=a('<input type="file">').change(ua);a("#tool_import").show().prepend(ua)}Ya(true);a(function(){window.svgCanvas=c;c.ready=p.ready});p.setLang=function(g,l){p.langChanged=true;a.pref("lang",g);a("#lang_select").val(g);if(l){var F=a("#layerlist tr.layersel td.layername").text()==t.common.layer+" 1";a.extend(t,l);c.setUiStrings(l);Jb.setTitles();if(F){c.renameCurrentLayer(t.common.layer+
" 1");ya()}if(xa.length)for(;xa.length;)xa.shift().langReady({lang:g,uiStrings:t});else c.runExtensions("langReady",{lang:g,uiStrings:t});c.runExtensions("langChanged",g);Ha();a.each({"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},function(G,P){a(P).attr("title",a(G)[0].title)});a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+
this.id.substr(10))[0].title=this.title})}}};p.ready=function(v){i?v():z.push(v)};p.runCallbacks=function(){a.each(z,function(){this()});i=true};p.loadFromString=function(v){p.ready(function(){J(v)})};p.disableUI=function(){};p.loadFromURL=function(v,r){r||(r={});var O=r.cache,Z=r.callback;p.ready(function(){a.ajax({url:v,dataType:"text",cache:!!O,beforeSend:function(){a.process_cancel(t.notification.loadingImage)},success:function(ka){J(ka,Z)},error:function(ka,ea,ba){ka.status!=404&&ka.responseText?
J(ka.responseText,Z):a.alert(t.notification.URLloadFail+": \n"+ba,Z)},complete:function(){a("#dialog_box").hide()}})})};p.loadFromDataURI=function(v){p.ready(function(){var r=false,O=v.match(/^data:image\/svg\+xml;base64,/);if(O)r=true;else O=v.match(/^data:image\/svg\+xml(?:;(?:utf8)?)?,/);if(O)O=O[0];O=v.slice(O.length);J(r?n.decode64(O):decodeURIComponent(O))})};p.addExtension=function(){var v=arguments;a(function(){c&&c.addExtension.apply(this,v)})};return p}(jQuery);$(svgEditor.init)}})();var svgEditor=function(a,J){function p(f,n,i){var m,k,z,s,E,A=a("#svg_editor").parent();for(k in n){(z=n[k])||console.log(k);if(i)k="#"+k;m=A.find(k);if(m.length){s=A.find(k)[0];switch(f){case "content":for(m=0;m<s.childNodes.length;m++){E=s.childNodes[m];if(E.nodeType===3&&E.textContent.replace(/\s/g,"")){E.textContent=z;break}}break;case "title":s.title=z}}else console.log("Missing: "+k)}}var c;J.readLang=function(f){var n=J.canvas.runExtensions("addlangData",c,true);a.each(n,function(u,t){if(t.data)f=
a.merge(f,t.data)});if(f.tools){var i=f.tools;n=f.properties;var m=f.config,k=f.layers,z=f.common,s=f.ui;p("content",{curve_segments:n.curve_segments,fitToContent:i.fitToContent,fit_to_all:i.fit_to_all,fit_to_canvas:i.fit_to_canvas,fit_to_layer_content:i.fit_to_layer_content,fit_to_sel:i.fit_to_sel,icon_large:m.icon_large,icon_medium:m.icon_medium,icon_small:m.icon_small,icon_xlarge:m.icon_xlarge,image_opt_embed:m.image_opt_embed,image_opt_ref:m.image_opt_ref,includedImages:m.included_images,largest_object:i.largest_object,
layersLabel:k.layers,page:i.page,relativeToLabel:i.relativeTo,selLayerLabel:k.move_elems_to,selectedPredefined:m.select_predefined,selected_objects:i.selected_objects,smallest_object:i.smallest_object,straight_segments:n.straight_segments,svginfo_bg_url:m.editor_img_url+":",svginfo_bg_note:m.editor_bg_note,svginfo_change_background:m.background,svginfo_dim:m.doc_dims,svginfo_editor_prefs:m.editor_prefs,svginfo_height:z.height,svginfo_icons:m.icon_size,svginfo_image_props:m.image_props,svginfo_lang:m.language,
svginfo_title:m.doc_title,svginfo_width:z.width,tool_docprops_cancel:z.cancel,tool_docprops_save:z.ok,tool_source_cancel:z.cancel,tool_source_save:z.ok,tool_prefs_cancel:z.cancel,tool_prefs_save:z.ok,sidepanel_handle:k.layers.split("").join(" "),tool_clear:i.new_doc,tool_docprops:i.docprops,tool_export:i.export_img,tool_import:i.import_doc,tool_imagelib:i.imagelib,tool_open:i.open_doc,tool_save:i.save_doc,svginfo_units_rulers:m.units_and_rulers,svginfo_rulers_onoff:m.show_rulers,svginfo_unit:m.base_unit,
svginfo_grid_settings:m.grid,svginfo_snap_onoff:m.snapping_onoff,svginfo_snap_step:m.snapping_stepsize,svginfo_grid_color:m.grid_color},true);var E,A={};for(E in f.shape_cats)A['#shape_cats [data-cat="'+E+'"]']=f.shape_cats[E];setTimeout(function(){p("content",A)},2E3);var h={};a.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){h['#cmenu_canvas a[href="#'+this+'"]']=i[this]});a.each(["dupe","merge_down","merge_all"],
function(){h['#cmenu_layers a[href="#'+this+'"]']=k[this]});h['#cmenu_layers a[href="#delete"]']=k.del;p("content",h);p("title",{align_relative_to:i.align_relative_to,circle_cx:n.circle_cx,circle_cy:n.circle_cy,circle_r:n.circle_r,cornerRadiusLabel:n.corner_radius,ellipse_cx:n.ellipse_cx,ellipse_cy:n.ellipse_cy,ellipse_rx:n.ellipse_rx,ellipse_ry:n.ellipse_ry,fill_color:n.fill_color,font_family:n.font_family,idLabel:n.id,image_height:n.image_height,image_url:n.image_url,image_width:n.image_width,layer_delete:k.del,
layer_down:k.move_down,layer_new:k["new"],layer_rename:k.rename,layer_moreopts:z.more_opts,layer_up:k.move_up,line_x1:n.line_x1,line_x2:n.line_x2,line_y1:n.line_y1,line_y2:n.line_y2,linecap_butt:n.linecap_butt,linecap_round:n.linecap_round,linecap_square:n.linecap_square,linejoin_bevel:n.linejoin_bevel,linejoin_miter:n.linejoin_miter,linejoin_round:n.linejoin_round,main_icon:i.main_menu,mode_connect:i.mode_connect,tools_shapelib_show:i.mode_shapelib,palette:s.palette_info,zoom_panel:s.zoom_level,
path_node_x:n.node_x,path_node_y:n.node_y,rect_height_tool:n.rect_height,rect_width_tool:n.rect_width,seg_type:n.seg_type,selLayerNames:k.move_selected,selected_x:n.pos_x,selected_y:n.pos_y,stroke_color:n.stroke_color,stroke_style:n.stroke_style,stroke_width:n.stroke_width,svginfo_title:m.doc_title,text:n.text_contents,toggle_stroke_tools:s.toggle_stroke_tools,tool_add_subpath:i.add_subpath,tool_alignbottom:i.align_bottom,tool_aligncenter:i.align_center,tool_alignleft:i.align_left,tool_alignmiddle:i.align_middle,
tool_alignright:i.align_right,tool_aligntop:i.align_top,tool_angle:n.angle,tool_blur:n.blur,tool_bold:n.bold,tool_circle:i.mode_circle,tool_clone:i.clone,tool_clone_multi:i.clone,tool_delete:i.del,tool_delete_multi:i.del,tool_ellipse:i.mode_ellipse,tool_eyedropper:i.mode_eyedropper,tool_fhellipse:i.mode_fhellipse,tool_fhpath:i.mode_fhpath,tool_fhrect:i.mode_fhrect,tool_font_size:n.font_size,tool_group_elements:i.group_elements,tool_make_link:i.make_link,tool_link_url:i.set_link_url,tool_image:i.mode_image,
tool_italic:n.italic,tool_line:i.mode_line,tool_move_bottom:i.move_bottom,tool_move_top:i.move_top,tool_node_clone:i.node_clone,tool_node_delete:i.node_delete,tool_node_link:i.node_link,tool_opacity:n.opacity,tool_openclose_path:i.openclose_path,tool_path:i.mode_path,tool_position:i.align_to_page,tool_rect:i.mode_rect,tool_redo:i.redo,tool_reorient:i.reorient_path,tool_select:i.mode_select,tool_source:i.source_save,tool_square:i.mode_square,tool_text:i.mode_text,tool_topath:i.to_path,tool_undo:i.undo,
tool_ungroup:i.ungroup,tool_wireframe:i.wireframe_mode,view_grid:i.toggle_grid,tool_zoom:i.mode_zoom,url_notice:i.no_embed},true);J.setLang(c,f)}};J.putLocale=function(f,n){if(f)c=f;else{c=a.pref("lang");if(!c){if(navigator.userLanguage)c=navigator.userLanguage;else if(navigator.language)c=navigator.language;if(c==null)return}console.log("Lang: "+c);if(a.inArray(c,n)===-1&&c!=="test")c="en"}var i=J.curConfig.langPath+"lang."+c+".js";a.getScript(i,function(m){if(!m){m=document.createElement("script");
m.src=i;document.querySelector("head").appendChild(m)}})};return J}(jQuery,svgEditor);svgedit=svgedit||{};
(function(){var a=this;if(!svgedit.contextmenu)svgedit.contextmenu={};a.contextMenuExtensions={};svgEditor.ready(function(){for(var J in contextMenuExtensions){var p=contextMenuExtensions[J];Object.keys(a.contextMenuExtensions).length===0&&$("#cmenu_canvas").append("<li class='separator'>");var c=p.shortcut||"";$("#cmenu_canvas").append("<li class='disabled'><a href='#"+p.id+"'>"+p.label+"<span class='shortcut'>"+c+"</span></a></li>")}});svgedit.contextmenu.resetCustomMenus=function(){a.contextMenuExtensions={}};
svgedit.contextmenu.add=function(J){if(J&&J.id&&J.label&&J.action&&typeof J.action=="function")if(J.id in a.contextMenuExtensions)console.error('Cannot add extension "'+J.id+'", an extension by that name already exists"');else{console.log("Registed contextmenu item: {id:"+J.id+", label:"+J.label+"}");a.contextMenuExtensions[J.id]=J}else console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")};svgedit.contextmenu.hasCustomHandler=
function(J){return a.contextMenuExtensions[J]&&true};svgedit.contextmenu.getCustomHandler=function(J){return a.contextMenuExtensions[J].action}})();
